
<!doctype html>

<html lang="en">
<head>
	<meta charset="utf-8">

	<title>The Island Programming Language</title>
	<meta name="description" content="Multiparadigm general-purpose programming language, fusing aspects of imperative, functional, object-oriented, and logic programming.">
	<meta name="author" content="Rotem Dan">

	<link rel="stylesheet" href="styles/style.css">
	<!--<script src="reloader.js"></script>-->
</head>

<body>
<h1 class="main-header">The Island Programming Language</h1>
<p><strong>Island</strong> (<strong>I</strong>mmutable, <strong>s</strong>equentia<strong>l</strong> <strong>a</strong>nd <strong>n</strong>on-<strong>d</strong>estructive) is a multiparadigm general-purpose programming language fusing aspects of imperative, functional, object-oriented, and logic programming.</p>
<p>It primarily aims to serve as a pragmatic programming tool for real-world applications, and generally inclined towards the mainstream, sequential programming style.</p>
<p>However, the language cannot be formally classified as imperative (it has <strong>no mutable state</strong>), nor as truly functional (it does not promote an idiomatically functional style), nor as traditionally object-oriented language. It is not intended as a hybrid language, but represents a conceptually independent programming approach named <strong>stateless-sequential programming</strong>.</p>
<p>The language also embeds a statically-typed <strong>logic programming subsystem</strong>, that significantly deviates from the Prolog tradition - which mostly concentrates on the centrality of relations - and instead encourages tight interconnections between relations, functions and objects as complementary entities.</p>
<nav class="table-of-contents"><ol><li><a href="#introduction">Introduction</a><ol><li><a href="#design-goals-and-constraints">Design goals and constraints</a></li><li><a href="#main-innovations">Main innovations</a></li><li><a href="#implementation-state">Implementation state</a></li></ol></li><li><a href="#fundamentals">Fundamentals</a><ol><li><a href="#variables-and-assignment">Variables and assignment</a></li><li><a href="#variable-scoping">Variable scoping</a></li><li><a href="#deferred-initialization">Deferred initialization</a></li><li><a href="#primitive-data-types">Primitive data types</a></li><li><a href="#collection-types%3A-lists%2C-tuples%2C-dictionaries-and-sets">Collection types: lists, tuples, dictionaries and sets</a></li><li><a href="#unpacking">Unpacking</a></li></ol></li><li><a href="#subroutines">Subroutines</a><ol><li><a href="#functions%2C-actions-and-computed-variables">Functions, actions and computed variables</a></li><li><a href="#named-and-default-arguments">Named and default arguments</a></li><li><a href="#first-class-methods-and-lexical-closures">First-class methods and lexical closures</a></li><li><a href="#anonymous-methods">Anonymous methods</a></li><li><a href="#method-overloading">Method overloading</a></li><li><a href="#function-and-action-types">Function and action types</a></li><li><a href="#rest-parameters">Rest parameters</a></li><li><a href="#arguments-collection">Arguments collection</a></li><li><a href="#partial-application">Partial application</a></li><li><a href="#abstract-method-types">Abstract method types</a></li><li><a href="#strong-and-weak-side-effect-scopes">Strong and weak side-effect scopes</a></li></ol></li><li><a href="#control-flow">Control flow</a><ol><li><a href="#conditionals">Conditionals</a></li><li><a href="#pattern-matching">Pattern matching</a></li><li><a href="#matched-parameters">Matched parameters</a></li><li><a href="#exhaustiveness-checking">Exhaustiveness checking</a></li><li><a href="#single-pattern-matching">Single pattern matching</a></li><li><a href="#loops">Loops</a></li><li><a href="#shorthand-with-expressions-in-continue-and-break-statements">Shorthand with expressions in continue and break statements</a></li></ol></li><li><a href="#data-streams">Data streams</a><ol><li><a href="#stream-methods">Stream methods</a></li><li><a href="#accumulative-streams-and-named-return-variables">Accumulative streams and named return variables</a></li><li><a href="#list-and-stream-comprehensions">List and stream comprehensions</a></li><li><a href="#for-loops-as-methods">For-loops as methods</a></li></ol></li><li><a href="#compound-and-polymorphic-data-types">Compound and polymorphic data types</a><ol><li><a href="#classes-and-objects">Classes and objects</a></li><li><a href="#extension">Extension</a></li><li><a href="#abstract-classes">Abstract classes</a></li><li><a href="#fixed-fields-and-partially-constructed-objects">Fixed fields and partially constructed objects</a></li><li><a href="#type-objects">Type objects</a></li><li><a href="#traits">Traits</a></li><li><a href="#expansion">Expansion</a></li><li><a href="#generics">Generics</a></li><li><a href="#type-traits">Type traits</a></li><li><a href="#polymorphic-subtyping-rules-(covariance-and-contravariance)">Polymorphic subtyping rules (covariance and contravariance)</a></li></ol></li><li><a href="#concurrency%2C-parallelism-and-lazy-evaluation">Concurrency, parallelism and lazy evaluation</a><ol><li><a href="#computed-variables-and-values">Computed variables and values</a></li><li><a href="#concurrent-and-parallel-execution-with-the-spawn-keyword">Concurrent and parallel execution with the spawn keyword</a></li></ol></li><li><a href="#contracts">Contracts</a><ol><li><a href="#contracts-2">Contracts</a></li></ol></li><li><a href="#type-abstractions">Type abstractions</a><ol><li><a href="#refinement-and-assertion-types">Refinement and assertion types</a></li><li><a href="#type-aliases">Type aliases</a></li><li><a href="#choice-types">Choice types</a></li><li><a href="#variant-types">Variant types</a></li><li><a href="#enumerations">Enumerations</a></li><li><a href="#the-nothing-type-and-the-%3F-operator">The nothing type and the ? operator</a></li><li><a href="#the-any-type">The any type</a></li><li><a href="#the-never-type">The never type</a></li><li><a href="#join-types">Join types</a></li><li><a href="#member-type-references">Member type references</a></li><li><a href="#higher-kinded-traits">Higher-kinded traits</a></li></ol></li><li><a href="#reactive-programming">Reactive programming</a><ol><li><a href="#reactive-values">Reactive values</a></li></ol></li><li><a href="#exception-handling">Exception handling</a><ol><li><a href="#failure-types">Failure types</a></li><li><a href="#returning-the-failure-type-from-a-method">Returning the failure type from a method</a></li><li><a href="#using-check..detect-(action-scopes-only)">Using check..detect (action scopes only)</a></li></ol></li><li><a href="#logic-programming">Logic programming</a><ol><li><a href="#relations%2C-facts-and-rules">Relations, facts and rules</a></li><li><a href="#relation-predicates%2C-functions-and-streams">Relation predicates, functions and streams</a></li><li><a href="#higher-order-relations">Higher-order relations</a></li><li><a href="#immutability-and-determinism-in-the-logic-programming-subsystem">Immutability and determinism in the logic programming subsystem</a></li></ol></li><li><a href="#patterns-and-parsers">Patterns and parsers</a><ol><li><a href="#pattern-methods">Pattern methods</a></li><li><a href="#unpacking-through-a-pattern-method">Unpacking through a pattern method</a></li></ol></li><li><a href="#symbolic-data-structures">Symbolic data structures</a><ol><li><a href="#symbolic-structures">Symbolic structures</a></li></ol></li><li><a href="#misc.-topics">Misc. topics</a><ol><li><a href="#lists-and-streams-as-indices-for-array-slicing">Lists and streams as indices for array slicing</a></li><li><a href="#recursion-sugar-and-the-param-modifier">Recursion sugar and the param modifier</a></li><li><a href="#deep-comparison">Deep comparison</a></li></ol></li><li><a href="#todo">TODO</a><ol><li><a href="#namespaces">Namespaces</a></li><li><a href="#modules">Modules</a></li><li><a href="#attributes">Attributes</a></li><li><a href="#infix-functions">Infix functions</a></li><li><a href="#reflection">Reflection</a></li><li><a href="#memoization">Memoization</a></li><li><a href="#compile-time-execution">Compile-time execution</a></li></ol></li><li><a href="#closing-chapter">Closing chapter</a><ol><li><a href="#influences">Influences</a></li><li><a href="#who-wrote-this%3F">Who wrote this?</a></li><li><a href="#feedback-for-this-document">Feedback for this document</a></li><li><a href="#copyrights">Copyrights</a></li></ol></li></ol></nav><h1 id="introduction"><a class="header-anchor" href="#introduction">ยง</a>Introduction</h1>
<h2 id="design-goals-and-constraints"><a class="header-anchor" href="#design-goals-and-constraints">ยง</a>Design goals and constraints</h2>
<ul>
<li><strong>All variables and values should be strictly immutable</strong>. I.e. both variables (locally and globally scoped) and values (primitive and compound objects, including any of their fields) must maintain their initial value, forever.</li>
<li>Adapt common imperative constructs like loops, objects and generators, while maintaining strict adherence to full immutability.</li>
<li>Maintain a strict separation between pure and side-effect scopes (e.g. <code>function</code> vs <code>action</code>).</li>
<li>Maintain a look-and-feel roughly resembling popular imperative languages (e.g Python, Swift, C#, TypeScript).</li>
<li>Aim for maximum simplicity and readability (good syntax does make a difference!). Aim for low-ambiguity syntax that reads like plain English (but don't overdo it for its own sake).</li>
<li>Clean syntax: avoid unnecessary punctuation like <code>;</code>, <code>:</code>, <code>{</code>, <code>}</code>, <code>(</code>, <code>)</code> and cryptic-looking symbols like <code>$</code>, <code>*</code>, <code>#</code>, <code>^</code> etc..</li>
<li>Expressive, rather than minimalist, syntax. No special emphasis on cutting down on special keywords (use context-sensitive awareness to allow identifier names to be used even if they conflict with a keyword that's reserved elsewhere).</li>
<li>Types should be inferred whenever possible.</li>
<li>Allow for strong static analysis (static and strong typing, advanced type inference, flow analysis, generics and type classes, non-nullable, algebraic, refinement and assertion types, compile-time contracts).</li>
<li>Allow for easy concurrency (lightweight threads, deterministic dataflows, asynchronous generators).</li>
</ul>
<h2 id="main-innovations"><a class="header-anchor" href="#main-innovations">ยง</a>Main innovations</h2>
<ul>
<li><strong><a href="#loops">Stateless loops</a></strong> (or alternatively <strong>structured loops</strong>) represent a novel approach to iterative control flow that attempts to synthesize the best of both the imperative and functional idioms.</li>
<li><strong><a href="#accumulative-streams-and-named-return-variables">Accumulative generators</a></strong>, as well as <strong>accumulative generator comprehensions</strong> enhance the declarative expressiveness the language by abstracting over the notion of the &quot;prior&quot; output of a generator.</li>
<li><strong><a href="#logic-programming">Relation classes</a></strong> encapsulate logic-programming style relations within immutable container objects. Relation classes are defined using a diverse mixture of programming approaches: rules, predicates, functions and generators.</li>
<li><strong><a href="#patterns-and-parsers">Abstract pattern recognizers</a></strong> are function-like methods that generalize over the basic pattern matching syntax, as well as traditional regular expressions, by allowing to recognize and capture arbitrary patterns within any type of input stream.</li>
</ul>
<h2 id="implementation-state"><a class="header-anchor" href="#implementation-state">ยง</a>Implementation state</h2>
<p>The language is currently at an early, design-only stage. A basic parser and compiler have been developed, mostly for the purpose of validating a limited subset of its features (in particular its parsing complexity and the practical efficiency of its looping constructs).</p>
<h1 id="fundamentals"><a class="header-anchor" href="#fundamentals">ยง</a>Fundamentals</h1>
<h2 id="variables-and-assignment"><a class="header-anchor" href="#variables-and-assignment">ยง</a>Variables and assignment</h2>
<p>Variables are defined using the <code>let</code> keyword:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">24</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hello</span><span style="color: #5B5B5B">"</span></code></pre>
<p>Types will be inferred using the values provided, but can also be annotated explicitly:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> x: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">24</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> greeting: </span><span style="color: #0057E6">string</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hello</span><span style="color: #5B5B5B">"</span></code></pre>
<p><strong>Variables can only be assigned once</strong>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">24</span>
<span style="color: #5B5B5B">x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">25</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error: invalid reassignment of 'x'</span></code></pre>
<h2 id="variable-scoping"><a class="header-anchor" href="#variable-scoping">ยง</a>Variable scoping</h2>
<p>Variables are accessible from within both their declared scope and any of its nested scopes:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hello</span><span style="color: #5B5B5B">"</span>

<span style="color: #0057E6">if</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">greeting</span><span style="color: #B338FF">)</span></code></pre>
<p>Variables redeclared using an existing name in an inner scope will shadow the ones in the outer scope:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hello</span><span style="color: #5B5B5B">"</span>

<span style="color: #0057E6">if</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hi</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">greeting</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Prints "Hi"</span>

<span style="color: #5B5B5B">print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">greeting</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Prints "Hello"</span></code></pre>
<p>Newly declared variable reusing an existing name will replace the previous one if redeclared in the same scope:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hello</span><span style="color: #5B5B5B">"</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hi</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// This is permitted since the previous binding of `greeting` is not reachable anymore</span>

<span style="color: #5B5B5B">print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">greeting</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Prints "Hi"</span></code></pre>
<p>Shadowing and redeclared variables must receive a type consistent with the previous one:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hello</span><span style="color: #5B5B5B">"</span>

<span style="color: #0057E6">if</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">25</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error: shadowing inner variable must be of same type as outer variable</span></code></pre>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hello</span><span style="color: #5B5B5B">"</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">25</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error: redeclared variable must be of same type as its previous binding</span></code></pre>
<h2 id="deferred-initialization"><a class="header-anchor" href="#deferred-initialization">ยง</a>Deferred initialization</h2>
<p>Initialization can be deferred to a later code position, as long as all branches assign a value:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> greeting: </span><span style="color: #0057E6">string</span>

<span style="color: #0057E6">if</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span>
<span style="color: #5B5B5B">	greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hello</span><span style="color: #5B5B5B">"</span>
<span style="color: #0057E6">else</span>
<span style="color: #5B5B5B">	greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hi</span><span style="color: #5B5B5B">"</span></code></pre>
<p>If a type is not specified, it would be automatically inferred as long as the assigned values share the same underlying type:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> greeting</span>

<span style="color: #0057E6">if</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span>
<span style="color: #5B5B5B">	greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hello</span><span style="color: #5B5B5B">"</span>
<span style="color: #0057E6">else</span>
<span style="color: #5B5B5B">	greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hi</span><span style="color: #5B5B5B">"</span>

<span style="color: #A1A1A1">// Type inferred as string</span></code></pre>
<p>This would not work:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> greeting</span>

<span style="color: #0057E6">if</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span>
<span style="color: #5B5B5B">	greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hello</span><span style="color: #5B5B5B">"</span>
<span style="color: #0057E6">else</span>
<span style="color: #5B5B5B">	greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">24</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error: incompatible types</span></code></pre>
<h2 id="primitive-data-types"><a class="header-anchor" href="#primitive-data-types">ยง</a>Primitive data types</h2>
<p>Island is a <strong>statically typed</strong> language, meaning that every one of its values must be associated with a type that can be determined at compile-time.</p>
<p>Island has a few primitive data types:</p>
<ul>
<li><code>integer</code>: arbitrary precision integer number.</li>
<li><code>decimal</code>: 64-bit floating-point number (IEEE 754).</li>
<li><code>boolean</code>: Boolean value (<code>true</code> or <code>false</code>).</li>
<li><code>string</code>: Unicode character sequence.</li>
</ul>
<h2 id="collection-types%3A-lists%2C-tuples%2C-dictionaries-and-sets"><a class="header-anchor" href="#collection-types%3A-lists%2C-tuples%2C-dictionaries-and-sets">ยง</a>Collection types: lists, tuples, dictionaries and sets</h2>
<p><strong>Lists</strong> are ordered collections of values, in which every element has the same type. They are defined within square brackets and have 1-based indexes:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> numbers: List</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">]</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> listOfLists: List</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">List</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">string</span><span style="color: #000000">&gt;&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [[</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">a</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">b</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">], [</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">c</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">d</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">e</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">], [</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">f</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">]]</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> m1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> numbers[</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// m1 is 2</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> m2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> listOfLists[</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">][</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// m2 is 'b'</span>

<span style="color: #A1A1A1">// Two ways of defining empty lists:</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> emptyList: List</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">Integer</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> []</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> emptyList </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> List</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">Integer</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> []</span></code></pre>
<p>Lists can be extended and concatenated using the spread (<code>...</code>) syntax or the <code>+</code> operator:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> l1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">]</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> l2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">]</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> l3 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [...l2, </span><span style="color: #E65C00">6</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// l3 is [3, 4, 5, 6]</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> l4 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [...l1, ...l2]  </span><span style="color: #A1A1A1">// l4 is [1, 2, 3, 4, 5, 6]</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> l5 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">11</span><span style="color: #5B5B5B">] </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> l1 </span><span style="color: #A1A1A1">// l5 is [10, 11, 1, 2]</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> l6 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> l5 </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">100</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// l6 is [10, 11, 1, 2, 100]</span></code></pre>
<p>List members can be non-destructively altered using the <code>with</code> operator:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> l1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">100</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">200</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">300</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">400</span><span style="color: #5B5B5B">]</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> l2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> l1 </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">] </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// l2 is [99, 200, 300, 400]</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> l3 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> l2 </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">] </span><span style="color: #000000">=+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, [</span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">] </span><span style="color: #000000">-=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">no</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">]  </span><span style="color: #A1A1A1">// l3 is [99, 201, 299]</span></code></pre>
<p>The spread syntax can naturally embed <code>with</code> expressions:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> l1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">100</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">200</span><span style="color: #5B5B5B">]</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> l2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">300</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">400</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">500</span><span style="color: #5B5B5B">]</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> l3 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [...</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">l1 </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">] </span><span style="color: #000000">-=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">, ...</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">l2 </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">] </span><span style="color: #000000">*=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">3</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">6</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// l3 is [90, 200, 900, 400, 500, 600]</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> l4 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [...</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">l3 </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">no</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">], [</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">] </span><span style="color: #000000">*=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">4</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">, </span><span style="color: #000000">-</span><span style="color: #E65C00">200</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">300</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// l4 is [800, 900, 400, 500, 600, -200, 300]</span></code></pre>
<p>Lists can be sliced:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> l1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">100</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">200</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">300</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">400</span><span style="color: #5B5B5B">]</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> l2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> l1[</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// l2 is [200, 300, 400]</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> l3 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> l1[</span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">..] </span><span style="color: #A1A1A1">// l3 is [300, 400]</span></code></pre>
<p><strong>Tuples</strong> are ordered collections of fixed length in which each member may have a different type:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> myTuple: </span><span style="color: #B338FF">(</span><span style="color: #0057E6">string</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hi</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">24</span><span style="color: #B338FF">)</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> alteredTuple </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> myTuple </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">] </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">42</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// myTuple is ("Hi", 42)</span></code></pre>
<p>Tuple members can be named:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> myTuple: </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">greeting: </span><span style="color: #0057E6">string</span><span style="color: #5B5B5B">, someNumber: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hi</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">24</span><span style="color: #B338FF">)</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> alteredTuple </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> myTuple </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> someNumber </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">42</span></code></pre>
<p>Island doesn't support 1 or 0 arity tuples:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #E65C00">5</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// `x` gets the plain type `integer`, there's no single member tuple `(integer)` in Island</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// syntax error, `()` doesn't mean anything in Island</span></code></pre>
<p><strong>Dictionaries</strong> are unordered collections where the indexing keys can have any type:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> fruits: Dictionary</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">string</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">{</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">apple</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">: </span><span style="color: #E65C00">55</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">lemon</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">: </span><span style="color: #E65C00">95</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">orange</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B"> : </span><span style="color: #E65C00">31</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">banana</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">: </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">}</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> fruitValue </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> fruits[</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">orange</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// fruitValue is 31</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> alteredFruits </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> fruits </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> [</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">apple</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">] </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">12</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">no</span><span style="color: #5B5B5B"> [</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">orange</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">]</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> extendedFruits </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">{</span><span style="color: #5B5B5B"> ...alteredFruits, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">mango</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">: </span><span style="color: #E65C00">76</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">}</span>

<span style="color: #A1A1A1">// Two ways of defining empty dictionaries:</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> emptyDictionary: Dictionary</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">string</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">{}</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> emptyDictionary </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Dictionary</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">string</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">{}</span></code></pre>
<p><strong>Sets</strong> are unordered collections containing only unique elements:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> fruits: Set</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">string</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">{</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">apple</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">lemon</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">orange</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">banana</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">}</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> fruitValue </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> fruits[</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">orange</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// fruitValue is 31</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> alteredFruits </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> fruits </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> [</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">berries</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">], </span><span style="color: #0057E6">no</span><span style="color: #5B5B5B"> [</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">orange</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">]</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> extendedFruits </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">{</span><span style="color: #5B5B5B"> ...alteredFruits, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">mango</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">}</span>

<span style="color: #A1A1A1">// Two ways of defining empty sets:</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> emptySet: Set</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">{}</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> emptySet </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Set</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">{}</span></code></pre>
<h2 id="unpacking"><a class="header-anchor" href="#unpacking">ยง</a>Unpacking</h2>
<p><strong>Unpacking</strong> (also called <strong>destructuring</strong> in other languages) allows extracting elements from data structures into individual variables:</p>
<p>Unpack a list:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> getList</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">]</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> [n1, n2, n3, n4] </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> getList</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// n1 = 1, n2 = 2, n3 = 3, n4 = 4</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> [x1, x2, ...] </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> getList</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// n1 = 1, x2 = 2</span></code></pre>
<p>Unpack a tuple:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> getTuple</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a, b, c</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> getTuple</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// a = 1, b = 2, c = 3</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x, _, z</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> getTuple</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// x = 1, z = 3</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">n, ...</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> getTuple</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B">  </span><span style="color: #A1A1A1">// n = 1</span></code></pre>
<p>Objects (introduced in a future chapter) are unpacked based on the order of declared members:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Person</span>
<span style="color: #5B5B5B">	firstName: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	lastName: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	age: </span><span style="color: #0057E6">integer</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> person </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Person</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">John</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Doe</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">25</span><span style="color: #B338FF">)</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">f, _, a</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> person </span><span style="color: #A1A1A1">// f = "John", a = 25</span></code></pre>
<p>Lists allow for some additional unpacking patterns:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> values </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">]</span>

<span style="color: #A1A1A1">// Capture head and tail of a list:</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> [head, ...tail] </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> values </span><span style="color: #A1A1A1">// head = 1, tail = [2, 3, 4, 5]</span>

<span style="color: #A1A1A1">// Capture first, second, and all the rest elements of the list:</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> [first, second, ...rest] </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> values </span><span style="color: #A1A1A1">// first = 1, second = 2, rest = [3, 4, 5]</span>

<span style="color: #A1A1A1">// Capture first and last elements:</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> [firstElement, ..., lastElement] </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> values </span><span style="color: #A1A1A1">// firstElement = 1, lastElement = 5</span></code></pre>
<h1 id="subroutines"><a class="header-anchor" href="#subroutines">ยง</a>Subroutines</h1>
<h2 id="functions%2C-actions-and-computed-variables"><a class="header-anchor" href="#functions%2C-actions-and-computed-variables">ยง</a>Functions, actions and computed variables</h2>
<p>The Island language has two main subroutine types: functions and actions.</p>
<p><strong>Functions</strong> are &quot;pure&quot;, in the sense they do not have side effects (no hidden change of state) and maintain referential transparency (given the same set of arguments, they would always return the same value).</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> sum2</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, y: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> y </span><span style="color: #A1A1A1">// Short syntax</span>

<span style="color: #0057E6">function</span><span style="color: #5B5B5B"> sum3</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, y: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, z: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Long syntax</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> z</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> sum3</span><span style="color: #B338FF">(</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Result: </span><span style="color: #B338FF">{</span><span style="color: #AA6631">result</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span></code></pre>
<p><strong>Actions</strong> extend functions and allow for <em>external</em> side-effects. Actions can return values but can only be called from other actions (or the topmost scope):</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> printNameAndAge</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">name: </span><span style="color: #0057E6">string</span><span style="color: #5B5B5B">, age: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Name: </span><span style="color: #B338FF">{</span><span style="color: #AA6631">name</span><span style="color: #B338FF">}</span><span style="color: #AA6631">, Age: </span><span style="color: #B338FF">{</span><span style="color: #AA6631">age</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">OK</span><span style="color: #5B5B5B">"</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> status </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> printNameAndAge</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">John Smith</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">35</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Prints "Name: John Smith, Age: 35" and returns "OK"</span></code></pre>
<p>Despite allowing for &quot;impure&quot; operations like writing or reading from a file, actions do not allow for side-effects <em>internal</em> to the program itself, since all variables and values are always guaranteed to be immutable. This doesn't prevent, however, mutable state to be weakly &quot;emulated&quot; through, say, reading and writing to external memory:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> readMutableState</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> readFile</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">myFile.state</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>
<span style="color: #0057E6">action</span><span style="color: #5B5B5B"> writeMutableState</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">data: </span><span style="color: #0057E6">string</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> writeFile</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">myFile.state</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, data</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> initialData </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> readMutableState</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">writeMutableState</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">initialData </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631"> changed!</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> modifiedData </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> readMutableState</span><span style="color: #B338FF">()</span></code></pre>
<p>The program can read and write to external mutable state. However, the data must be read into a new variable (here <code>modifiedData</code>) so the <em>internal</em> state of the program (its variables and values) is never altered.</p>
<p><strong>Computed variables</strong> are functions that are referenced as if they were plain variables. They are only evaluated when first used:</p>
<p>Short form:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> a </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">5</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> b </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">3</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> c </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> a </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> b </span><span style="color: #A1A1A1">// computed variable `c` is not evaluated at this point</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> c </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// `c` is now evaluated to 15 and `x` gets the value 16</span></code></pre>
<p>Long, function like, form:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> a </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">5</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> b </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">3</span>

<span style="color: #0057E6">computed</span><span style="color: #5B5B5B"> c</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> a1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> a </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> a2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> b </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> a1 </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> a2</span></code></pre>
<p>We will often collectively refer to functions, actions, and computed variables (and later include class computed fields and indexers) as <strong>methods</strong>, which is just another name for subroutines.</p>
<h2 id="named-and-default-arguments"><a class="header-anchor" href="#named-and-default-arguments">ยง</a>Named and default arguments</h2>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> printNameAndAge</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">name </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Anonymous</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, age </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Name: </span><span style="color: #B338FF">{</span><span style="color: #AA6631">name</span><span style="color: #B338FF">}</span><span style="color: #AA6631">, Age: </span><span style="color: #B338FF">{</span><span style="color: #AA6631">age</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">printNameAndAge</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">age </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">12</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints Name: Anonymous, Age: 12</span>
<span style="color: #5B5B5B">printNameAndAge</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">_, </span><span style="color: #E65C00">12</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints Name: Anonymous, Age: 12</span></code></pre>
<h2 id="first-class-methods-and-lexical-closures"><a class="header-anchor" href="#first-class-methods-and-lexical-closures">ยง</a>First-class methods and lexical closures</h2>
<p><strong>First-class methods</strong> is a language feature allowing functions (and actions) to be used similarly to values. They can be assigned to variables, returned from a secondary method, or passed as an argument:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> giveMeFunction</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">f: </span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">  </span><span style="color: #A1A1A1">// This function accepts an argument of type function</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> f</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></code></pre>
<p>A <strong>lexical closure</strong> allows a method to capture data from its environment:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> outerFunction</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// This function returns a value of type 'function'</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> innerFunction</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// x is captured from the outer scope</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> innerFunction</span></code></pre>
<h2 id="anonymous-methods"><a class="header-anchor" href="#anonymous-methods">ยง</a>Anonymous methods</h2>
<p>Anonymous methods, also known as <strong>lambda expressions</strong> are functions or actions that are defined as expressions and are not bound to any identifier.</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> sum2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">n1: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, n2: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> n1 </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> n2 </span><span style="color: #A1A1A1">// Explicit parameter types</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> sum2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">n1, n2</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> n1 </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> n2 </span><span style="color: #A1A1A1">// Implicit parameter types</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> negative </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> n: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #5B5B5B">n </span><span style="color: #A1A1A1">// Single explicitly typed parameter</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> negative </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> n </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #5B5B5B">n </span><span style="color: #A1A1A1">// Single implicitly typed parameter</span>

<span style="color: #A1A1A1">// Since 'print' is an action 'printInQuotes' implicitly becomes a action as well</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> printInQuotes </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> s </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">'</span><span style="color: #B338FF">{</span><span style="color: #AA6631">s</span><span style="color: #B338FF">}</span><span style="color: #AA6631">'</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span></code></pre>
<h2 id="method-overloading"><a class="header-anchor" href="#method-overloading">ยง</a>Method overloading</h2>
<p><strong>Overloading</strong> allows defining multiple methods sharing the same name, but with different parameter types.</p>
<p>Methods can be overloaded:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> f</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, b: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> a </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span>
<span style="color: #0057E6">function</span><span style="color: #5B5B5B"> f</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, b: </span><span style="color: #0057E6">string</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">{</span><span style="color: #AA6631">a</span><span style="color: #B338FF">}</span><span style="color: #AA6631">: </span><span style="color: #B338FF">{</span><span style="color: #AA6631">b</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span>
<span style="color: #0057E6">function</span><span style="color: #5B5B5B"> f</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0057E6">boolean</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> a</span></code></pre>
<p>Overloads can only differ by parameter types, not return types:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> f</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> a </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span>
<span style="color: #0057E6">function</span><span style="color: #5B5B5B"> f</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0057E6">decimal</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> a </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error</span></code></pre>
<p>Overloaded methods can be compacted to a shorter form:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> f</span>
<span style="color: #5B5B5B">	</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, b: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> a </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span>
<span style="color: #5B5B5B">	</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, b: </span><span style="color: #0057E6">string</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">{</span><span style="color: #AA6631">a</span><span style="color: #B338FF">}</span><span style="color: #AA6631">: </span><span style="color: #B338FF">{</span><span style="color: #AA6631">b</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0057E6">boolean</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> a</span></code></pre>
<p><em>(The usefulness of this syntax will become more apparent when refinement and assertion types are introduced in a later chapter, stay tuned!)</em></p>
<h2 id="function-and-action-types"><a class="header-anchor" href="#function-and-action-types">ยง</a>Function and action types</h2>
<p>Function and action types can be written in several ways:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #A1A1A1">// Short form (unnamed parameters):</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> f: </span><span style="color: #B338FF">(</span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">string</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> f: </span><span style="color: #B338FF">(</span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">boolean</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">string</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> a: </span><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">string</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>

<span style="color: #A1A1A1">// Long form (named parameters):</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> f: </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">index: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">string</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> f: </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">index: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, isUnique: </span><span style="color: #0057E6">boolean</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">string</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> a: </span><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">message: </span><span style="color: #0057E6">string</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span></code></pre>
<h2 id="rest-parameters"><a class="header-anchor" href="#rest-parameters">ยง</a>Rest parameters</h2>
<p>A method's last parameter, typed as a list, can be prefixed with <code>...</code> to accept all remaining arguments as its members:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> sum</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">...numbers: List</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span>
<span style="color: #5B5B5B">	numbers.reduce</span><span style="color: #B338FF">((</span><span style="color: #5B5B5B">sum, number</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> sum </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> number</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> r1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> sum</span><span style="color: #B338FF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">6</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">7</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// r1 = 17</span></code></pre>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> multiplyAllBy</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">multiplier: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, ...numbers: List</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span>
<span style="color: #5B5B5B">	numbers.map</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">number </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> number </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> multiplier</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> r2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> multiplyAllBy</span><span style="color: #B338FF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">5</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// r2 = [10, 20, 30, 40, 50]</span></code></pre>
<p>It is also possible to explicitly pass a list to a rest parameter, using <code>...</code> as a suffix instead of a prefix:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> multiplyAllBy</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">multiplier, ...numbers: List</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span>
<span style="color: #5B5B5B">	numbers.map</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">number </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> number </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> multiplier</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> nums </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">]</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> r2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> multiplyAllBy</span><span style="color: #B338FF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, nums...</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// r2 = [10, 20, 30, 40, 50]</span></code></pre>
<p>Sometimes it is more convenient to pass arguments bundled together as a tuple. This is possible by applying the <code>...</code> prefix on the tuple passed, and would work even for methods that don't include a rest parameter:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> averageOf3</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0057E6">decimal</span><span style="color: #5B5B5B">, b: </span><span style="color: #0057E6">decimal</span><span style="color: #5B5B5B">, c: </span><span style="color: #0057E6">decimal</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span>
<span style="color: #5B5B5B">	</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a, b, c</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">/</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> nums </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">7</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #B338FF">)</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> average1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> averageOf3</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">nums...</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// pass nums tuple elements to parameters a, b, c</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> average2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> averageOf3</span><span style="color: #B338FF">(</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, nums[</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">]...</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// pass nums tuple elements 2..3 to parameters b, c</span></code></pre>
<h2 id="arguments-collection"><a class="header-anchor" href="#arguments-collection">ยง</a>Arguments collection</h2>
<p>The <code>arguments</code> keywords allows getting a tuple bundling all the arguments passed to the current method:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> printArguments</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, b: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, c: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">arguments</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">printArguments</span><span style="color: #B338FF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">5</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Prints "(1, 4, 5)"</span></code></pre>
<h2 id="partial-application"><a class="header-anchor" href="#partial-application">ยง</a>Partial application</h2>
<p>Partial application allows to transform a given method to a new method with one or more of its arguments bound to fixed values:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> printThreeNumbers</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, b: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, c: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">b</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">c</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> print5AndTwoNumbers </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> printTwoNumbers</span><span style="color: #B338FF">(</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, ...</span><span style="color: #B338FF">)</span>
<span style="color: #A1A1A1">// print5AndTwoNumbers has the signature print5AndTwoNumbers(b: integer, c: integer)</span>

<span style="color: #5B5B5B">print5AndTwoNumbers</span><span style="color: #B338FF">(</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">, </span><span style="color: #000000">-</span><span style="color: #E65C00">3</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints "5 9 -3"</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> print5And3AndNumber </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> printTwoNumbers</span><span style="color: #B338FF">(</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, ...</span><span style="color: #B338FF">)</span>
<span style="color: #A1A1A1">// print5And3AndNumber has the signature print5And3AndNumber(c: integer)</span>

<span style="color: #5B5B5B">print5And3AndNumber</span><span style="color: #B338FF">(</span><span style="color: #E65C00">1</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints "5 3 1"</span></code></pre>
<p>The <code>with</code> operator can be used to partially apply any subset of parameters, regardless of their declared order:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> partiallyAppliedAction </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> printThreeNumbers </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> b </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">11</span>
<span style="color: #A1A1A1">// partiallyAppliedAction has the signature partiallyAppliedAction(a: integer, c: integer)</span>

<span style="color: #5B5B5B">partiallyAppliedAction</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, c: </span><span style="color: #E65C00">8</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Prints 4, 11, 8</span>
<span style="color: #5B5B5B">partiallyAppliedAction</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">c: </span><span style="color: #E65C00">6</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error: an argument for `a` must be specified</span></code></pre>
<p>Methods may be partially applied any number of times:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> partiallyAppliedAction2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> partiallyAppliedAction </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> a </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">94</span>
<span style="color: #A1A1A1">// partiallyAppliedAction2 has the signature partiallyAppliedAction2(c: integer)</span>

<span style="color: #5B5B5B">partiallyAppliedAction2</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">c </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #E65C00">4</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Prints 94, 11, -4</span></code></pre>
<p>If the target method has multiple overloads, the overload can be disambiguated by including a tuple containing the selected types for the unspecified members:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> printThreeNumbers</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, b: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, c: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">b</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">c</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">action</span><span style="color: #5B5B5B"> printThreeNumbers</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, b: </span><span style="color: #0057E6">decimal</span><span style="color: #5B5B5B">, c: </span><span style="color: #0057E6">decimal</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">{</span><span style="color: #AA6631">b</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">{</span><span style="color: #AA6631">c</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> print5AndTwoNumbers </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> printThreeNumbers</span><span style="color: #B338FF">(</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, ...</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error! Ambiguous call. There are two matching overloads!</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> print5AndTwoNumbers </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> printThreeNumbers</span><span style="color: #B338FF">(</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, ...</span><span style="color: #B338FF">(</span><span style="color: #0057E6">decimal</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">decimal</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// OK</span></code></pre>
<h2 id="abstract-method-types"><a class="header-anchor" href="#abstract-method-types">ยง</a>Abstract method types</h2>
<p>The <code>(param1: ParamType, param2: ParamType, ...) =&gt; ReturnType</code> syntax defines abstract method types. An identifier holding a method of this type cannot be directly invoked, only passed around or partially applied:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> sum</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, b: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> a </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> b</span>

<span style="color: #0057E6">type</span><span style="color: #5B5B5B"> PartialIntFunc </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, ...</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">integer</span>

<span style="color: #0057E6">function</span><span style="color: #5B5B5B"> applyFirstArgument</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">F </span><span style="color: #0057E6">extends</span><span style="color: #5B5B5B"> PartialIntFunc</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">f: F, value: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: PartialIntFunc</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> f</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">value, ...</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> partiallyAppliedSum </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> applyFirstArgument</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">sum, </span><span style="color: #E65C00">11</span><span style="color: #B338FF">)</span>
<span style="color: #A1A1A1">// Type of partiallyAppliedSum is (b: integer) =&gt; integer</span>

<span style="color: #5B5B5B">partiallyAppliedSum</span><span style="color: #B338FF">(</span><span style="color: #E65C00">2</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// returns 13</span></code></pre>
<p>In the above example <code>(integer, ...) =&gt; integer</code> represents a function having any number of parameters where the first parameter must be compatible with <code>integer</code> and the return type must be compatible with <code>integer</code>.</p>
<p>Other abstract function type examples:</p>
<ul>
<li><code>(...) =&gt; any</code> represents a function of any number of parameters returning a value of any type other than <code>nothing</code> (the <code>any</code> type is described in detail in a following chapter).</li>
<li><code>(...) =&gt; any?</code> represents a function of any number of parameters returning a value of any type, including <code>nothing</code>.</li>
<li><code>(string, integer, _, _) =&gt; any?</code> represents a function of four parameters where the first parameter must be of type <code>string</code> and second of type integer, and any return type (including <code>nothing</code>).</li>
</ul>
<p><em>Note that due to contravariance of function parameters (described in a future chapter), a function including a parameter of type <code>any?</code>, e.g <code>(any?) =&gt; integer</code> is not assignable from a function of type <code>(T) =&gt; integer</code> where <code>T != any?</code>. Unlike <code>any?</code>, the <code>_</code> type represents a type that is both a super-type of all types and a subtype of all types, so it can substitute for every possible parameter type)</em>.</p>
<h2 id="strong-and-weak-side-effect-scopes"><a class="header-anchor" href="#strong-and-weak-side-effect-scopes">ยง</a>Strong and weak side-effect scopes</h2>
<p>Up until now, we've made a clear distinction between &quot;pure&quot; and &quot;side-effect&quot; scopes. Functions encompass purely deterministic computations. Actions, on the other hand, allow for external interaction (I/O, file reads and writes) as well as unpredictable operations (e.g. random number generators, timers etc.).</p>
<p>We can refine the distinction further to distinguish between two main classes of side-effects:</p>
<ol>
<li>Operations inducing clear impact on the external environment. e.g. writing to a file, moving a robot arm, displaying information on the monitor etc.</li>
<li>Operations that only observe or query information from the larger computing environment (e.g. reading an open file or screen pixel data) as well as operations that are unpredictable by nature (measuring time, reading data from a hardware random number generator etc).</li>
</ol>
<p>We can roughly classify the first class as &quot;strong&quot;, since they clearly impact the system and the user at large. The second class could be described as &quot;weak&quot; in the sense that it doesn't actually &quot;do&quot; anything - they pose no &quot;risk&quot; aside from requiring a minor amount of computing resources.</p>
<p>The Island language provides an optional way to explicitly mark those weaker scopes, albeit these are open to the developers' own judgment to be marked as such:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #5B5B5B">	</span><span style="color: #0057E6">view</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> getCurrentTime</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">		....</span></code></pre>
<p><code>view</code> actions can only call other view actions, as well as functions. They cannot call regular (strong) actions.</p>
<h1 id="control-flow"><a class="header-anchor" href="#control-flow">ยง</a>Control flow</h1>
<h2 id="conditionals"><a class="header-anchor" href="#conditionals">ยง</a>Conditionals</h2>
<p>The traditional <strong><code>if</code> - <code>else if</code> - <code>else</code></strong>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> abs</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">if</span><span style="color: #5B5B5B"> num </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">else</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">if</span><span style="color: #5B5B5B"> num </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #5B5B5B">num</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">else</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> num</span></code></pre>
<p>The conceptually similar, but more constrained <strong><code>when </code>-<code> otherwise</code></strong> syntax, which also allows for using <code>=&gt;</code> to directly return a value from the enclosing method:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> abs</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> num </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">   </span><span style="color: #A1A1A1">// Equivalent to 'if num == 0 ..'</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> num </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #5B5B5B">num </span><span style="color: #A1A1A1">// Equivalent to 'else if num &lt; 0 ..'</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> num     </span><span style="color: #A1A1A1">// Equivalent to 'else ..'</span></code></pre>
<p>The most important difference between <code>if</code>-<code>else if</code>-<code>else</code> and <code>when</code>-<code>otherwise</code> is that <code>when</code>-<code>otherwise</code> <strong>cannot be followed by any other statement</strong> in its enclosing scope.</p>
<p>So this is OK:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> abs</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">if</span><span style="color: #5B5B5B"> num </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> num</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// OK since when - otherwise sequence is not followed by anything</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #5B5B5B">x</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">otherwise</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> x</span></code></pre>
<p>But this is not:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> abs</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> num </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #5B5B5B">num</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> num </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> num</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error, a 'when' statement sequence cannot be followed by any other statement</span></code></pre>
<p><code>when</code> can also be written as an expression:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> abs </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> num </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">: num, </span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> num </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">: </span><span style="color: #000000">-</span><span style="color: #5B5B5B">num, </span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B">: </span><span style="color: #E65C00">0</span>

<span style="color: #0057E6">function</span><span style="color: #5B5B5B"> gcd</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, b: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> b </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">: abs</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B">: gcd</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">b, a </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> b</span><span style="color: #B338FF">)</span></code></pre>
<p>This function uses a dictionary and a <code>when</code> statement to convert an integer number on the range 1..999 to words:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> numToWords</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">999</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> numberNames </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">{</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">""</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">one</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">two</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">three</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">four</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">five</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">6</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">six</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">7</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">seven</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">8</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">eight</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">nine</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">ten</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">11</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">eleven</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">12</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">thirteen</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">13</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">thirteen</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">14</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">fourteen</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">15</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">fifteen</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">16</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">sixteen</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">17</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">seventeen</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">18</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">eighteen</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">19</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">nineteen</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">20</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">twenty</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">30</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">thirty</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">40</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">fourty</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">50</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">fifty</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">60</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">sixty</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">70</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">seventy</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">80</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">eighty</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">90</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">ninety</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">}</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> num </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">20</span><span style="color: #5B5B5B"> </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">100</span><span style="color: #5B5B5B"> </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> num </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span>
<span style="color: #5B5B5B">		</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">{</span><span style="color: #AA6631">numberNames[num]</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> num </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">100</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span>
<span style="color: #5B5B5B">		</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">{</span><span style="color: #AA6631">numToWords</span><span style="color: #B338FF">(</span><span style="color: #AA6631">n </span><span style="color: #000000">/</span><span style="color: #AA6631"> </span><span style="color: #E65C00">10</span><span style="color: #B338FF">)}</span><span style="color: #AA6631"> </span><span style="color: #B338FF">{</span><span style="color: #AA6631">numToWords</span><span style="color: #B338FF">(</span><span style="color: #AA6631">num </span><span style="color: #000000">mod</span><span style="color: #AA6631"> </span><span style="color: #E65C00">10</span><span style="color: #B338FF">)}</span><span style="color: #AA6631"> </span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">.trimWhitespace</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span>
<span style="color: #5B5B5B">		</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">{</span><span style="color: #AA6631">numToWords</span><span style="color: #B338FF">(</span><span style="color: #AA6631">n </span><span style="color: #000000">/</span><span style="color: #AA6631"> </span><span style="color: #E65C00">100</span><span style="color: #B338FF">)}</span><span style="color: #AA6631"> hundered </span><span style="color: #B338FF">{</span><span style="color: #AA6631">numToWords</span><span style="color: #B338FF">(</span><span style="color: #AA6631">num </span><span style="color: #000000">mod</span><span style="color: #AA6631"> </span><span style="color: #E65C00">100</span><span style="color: #B338FF">)}</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">.trimWhitespace</span><span style="color: #B338FF">()</span></code></pre>
<h2 id="pattern-matching"><a class="header-anchor" href="#pattern-matching">ยง</a>Pattern matching</h2>
<p><strong>Pattern matching</strong> is a form of a conditional which inspects one or more target values and their internal component parts. The <code>match</code>-<code>case</code> syntax expands over the traditional <code>switch</code>-<code>case</code> with more expressive control:</p>
<p><em>(<code>_</code> matches the target value, which is <code>num</code> in this example)</em></p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #A1A1A1">// (long statement form)</span>
<span style="color: #0057E6">function</span><span style="color: #5B5B5B"> abs1</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> num</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> _ </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #5B5B5B">num</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">otherwise</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> num</span>

<span style="color: #A1A1A1">// (short statement form, '=&gt;' returns a value from the enclosing method)</span>
<span style="color: #0057E6">function</span><span style="color: #5B5B5B"> abs2</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> num</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> _ </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #5B5B5B">num</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> num</span>

<span style="color: #A1A1A1">// (expression form)</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> absOfVal </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> num:</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">,</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> _ </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #5B5B5B">num,</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> num</span></code></pre>
<p>Match a tuple:
<em>(here <code>_</code> contextually matches the corresponding element of the target tuple <code>someTuple</code>)</em></p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> tupleMatch</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">someTuple: </span><span style="color: #B338FF">(</span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">string</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">boolean</span><span style="color: #B338FF">))</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> someTuple</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">_, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hi</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, _</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Case 1</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">_ </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> _ </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, _.length </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, _</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Case 2</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">_ </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, _[</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">] </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">O</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">false</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Case 3</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">No match</span><span style="color: #5B5B5B">"</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> r1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> matchTuple</span><span style="color: #B338FF">((</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hi</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">true</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B">    </span><span style="color: #A1A1A1">// returns "Case 1"</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> r2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> matchTuple</span><span style="color: #B338FF">((</span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hello</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">true</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// returns "Case 2"</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> r3 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> matchTuple</span><span style="color: #B338FF">((</span><span style="color: #E65C00">100</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">OK</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">false</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// returns "Case 3"</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> r3 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> matchTuple</span><span style="color: #B338FF">((</span><span style="color: #E65C00">100</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">OK</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">true</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B">  </span><span style="color: #A1A1A1">// returns "No match"</span></code></pre>
<p>Matched elements can be nested, and can be captured using the <code>let</code> keyword:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> nestedTupleMatch</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">someNestedTuple: </span><span style="color: #B338FF">(</span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">string</span><span style="color: #5B5B5B">, </span><span style="color: #B338FF">(</span><span style="color: #0057E6">boolean</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">string</span><span style="color: #B338FF">)))</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> someNestedTuple</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">_, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hi</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #B338FF">(</span><span style="color: #0057E6">true</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> name</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Case 1, </span><span style="color: #B338FF">{</span><span style="color: #AA6631">name</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> num, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hi</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #B338FF">(</span><span style="color: #0057E6">true</span><span style="color: #5B5B5B">, _</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Case 2, </span><span style="color: #B338FF">{</span><span style="color: #AA6631">num</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">No match</span><span style="color: #5B5B5B">"</span></code></pre>
<p>Matching over an object (as well as a tuple with named members) introduces its members into the <code>case</code> scope:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Person</span>
<span style="color: #5B5B5B">	firstName: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	lastName: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	age: </span><span style="color: #0057E6">integer</span>

<span style="color: #0057E6">function</span><span style="color: #5B5B5B"> matchObject</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">person: Person</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> person</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> firstName </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">James</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B"> </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> lastName.length </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Case 1</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> firstName[</span><span style="color: #000000">-</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">] </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">e</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B"> </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">30</span><span style="color: #5B5B5B"> </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">35</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Case 2</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">No match</span><span style="color: #5B5B5B">"</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> r1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> matchObject</span><span style="color: #B338FF">(</span><span style="color: #0057E6">new</span><span style="color: #5B5B5B"> Person</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">James</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Redd</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">21</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// returns "Case 1"</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> r2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> matchObject</span><span style="color: #B338FF">(</span><span style="color: #0057E6">new</span><span style="color: #5B5B5B"> Person</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Jane</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Doe</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">33</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// returns "Case 2"</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> r2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> matchObject</span><span style="color: #B338FF">(</span><span style="color: #0057E6">new</span><span style="color: #5B5B5B"> Person</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Jane</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Doe</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">37</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// returns "No match"</span></code></pre>
<p>In case the concrete type of the target object may be one of several derived types, the <strong>type can be matched</strong> as well:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> matchAnimal</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">animal: Animal</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> animal</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Dog </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> name </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Lucky</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B"> </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> owner.firstName </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Andy</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Good dog, Andy!</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Cat </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Old cat!</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Horse </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> height </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">180</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Tall horse!</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Nothing interesting here</span><span style="color: #5B5B5B">"</span></code></pre>
<p>A secondary syntax uses curly brackets to define a matching structure, which can be nested any amount of times:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> matchAnimal</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">animal: Animal</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> animal</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Dog </span><span style="color: #B338FF">{</span><span style="color: #5B5B5B"> name </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Lucky</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, owner: </span><span style="color: #B338FF">{</span><span style="color: #5B5B5B"> firstName </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Andy</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">}</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">}</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Good dog, Andy!</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Cat </span><span style="color: #B338FF">{</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">}</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Old cat!</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Horse </span><span style="color: #B338FF">{</span><span style="color: #5B5B5B"> height </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">180</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">}</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Tall horse!</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Nothing interesting here</span><span style="color: #5B5B5B">"</span></code></pre>
<p>A third, terser matching syntax uses constructor-like notation, based on the order of declared members (note the varying count of elements in parentheses and the <code>...</code> element signifying the rest of the elements are ignored):</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> matchAnimal</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">animal: Animal</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> animal</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Dog</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Lucky</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, Person</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Andy</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">,...</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">, ...</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Good dog, Andy!</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Cat</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">_, _ </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, ...</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Old cat!</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Horse</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">_, _, _ </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">180</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Tall horse!</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Nothing interesting here</span><span style="color: #5B5B5B">"</span></code></pre>
<p><code>match</code> can be applied to multiple variables, separated by commas:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> matchAnimalAndPerson</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">animal: Animal, person: Person</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> animal, person</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Dog </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> name </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Lucky</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, Man </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">18</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Good dog and young man!</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Cat </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, Woman </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> happinessLevel </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">8</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Old cat and happy woman!</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Horse </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> height </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">180</span><span style="color: #5B5B5B">, Person </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> hobby </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Horseriding</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Tall horse and a true horseriding lover!</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Nothing interesting here</span><span style="color: #5B5B5B">"</span></code></pre>
<p>Matching on multiple Boolean expressions allows to concisely specify a decision table:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> hasPromotions</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">repeatCustomer: </span><span style="color: #0057E6">boolean</span><span style="color: #5B5B5B">, hasMemberCard: </span><span style="color: #0057E6">boolean</span><span style="color: #5B5B5B">, orderAmount: </span><span style="color: #0057E6">decimal</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">:</span>
<span style="color: #5B5B5B">	</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">freeShipping: </span><span style="color: #0057E6">boolean</span><span style="color: #5B5B5B">, discountPercent: </span><span style="color: #0057E6">decimal</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> repeatCustomer, hasMemberCard, orderAmount </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">100</span><span style="color: #5B5B5B">, orderAmount </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1000</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">true</span><span style="color: #5B5B5B">, _   , </span><span style="color: #0057E6">false</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">false</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">freeShipping: </span><span style="color: #0057E6">true</span><span style="color: #5B5B5B">, discountPercent: </span><span style="color: #E65C00">0</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> _   , </span><span style="color: #0057E6">true</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">false</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">false</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">freeShipping: </span><span style="color: #0057E6">true</span><span style="color: #5B5B5B">, discountPercent: </span><span style="color: #E65C00">0</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">true</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">true</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">true</span><span style="color: #5B5B5B"> , </span><span style="color: #0057E6">false</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">freeShipping: </span><span style="color: #0057E6">true</span><span style="color: #5B5B5B">, discountPercent: </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">05</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">true</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">true</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">true</span><span style="color: #5B5B5B"> , </span><span style="color: #0057E6">true</span><span style="color: #5B5B5B">  </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">freeShipping: </span><span style="color: #0057E6">true</span><span style="color: #5B5B5B">, discountPercent: </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">10</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B">                     </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">freeShipping: </span><span style="color: #0057E6">false</span><span style="color: #5B5B5B">, discountPercent: </span><span style="color: #E65C00">0</span><span style="color: #B338FF">)</span></code></pre>
<p><code>match</code> cases can be <strong>nested</strong> without needing to introduce a new <code>match</code> declaration. The nested <code>case</code> clauses receive the enclosing match target value, as well as any type or conditional assertions that were made by its ancestors:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> matchAnimal</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">animal: Animal</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> animal</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Dog </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> name </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Lucky</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> barkingLoudness </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">3</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Quite dog lucky!</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> barkingLoudness </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">7</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Loud dog lucky!</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Nice dog lucky!</span><span style="color: #5B5B5B">"</span>

<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Cat</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> likesMilk </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Nice cat!</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">A cat who doesn't like milk! Who knew?</span><span style="color: #5B5B5B">"</span>

<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Horse </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> height </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">180</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Tall horse!</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Nothing interesting here</span><span style="color: #5B5B5B">"</span></code></pre>
<p>Matching over a list allows for the unpacking syntax to be used as a matching pattern:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> matchList</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">myList: List</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> myList</span>
<span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// Match if 'myList' is empty</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> []</span>

<span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// Match first element only if it is smaller than 10 and capture it with the identifier 'head':</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> [</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> head </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, ...]</span>

<span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// Match if first element equals 25 and capture the last element as 'last':</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">25</span><span style="color: #5B5B5B">, ..., </span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> last]</span>

<span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// Match if first element is greater or equal to 10. Capture the tail of the list with the identifier 'tail':</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> [_ </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> ...tail]</span>

<span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// Match if first element smaller than 0, second not equals to first,</span>
<span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// capture them and the rest with the identifers 'first', 'second', 'rest':</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> [</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> first </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> second </span><span style="color: #000000">!=</span><span style="color: #5B5B5B"> first, </span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> ...rest]</span>

<span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// Find the first member of the list that's greater than 5:</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> [..., </span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> v </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, ...]</span></code></pre>
<p>Using similar syntax, list-typed method parameters can be pattern-matched as well:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> minimumValue</span>
<span style="color: #5B5B5B">	</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">[]: List</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">, currentMinimum: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> currentMinimum</span>

<span style="color: #5B5B5B">	</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">[head, ...tail]: List</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">, currentMinimum </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">infinity</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span>
<span style="color: #5B5B5B">		minimumValue</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">tail, minimum</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">head, currentMinimum</span><span style="color: #B338FF">))</span></code></pre>
<h2 id="matched-parameters"><a class="header-anchor" href="#matched-parameters">ยง</a>Matched parameters</h2>
<p>Many examples in the previous section had the form:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> funcName</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">param1: ...., param2: ....</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> paramX, ....</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> ....</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> ....</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> ....</span></code></pre>
<p>If the outermost scope of a method consists only of a <code>match</code> statement (excluding any <code>let</code>s, nested method or type declarations), the <code>match paramX, ....</code> statement can be omitted and instead integrate directly into the function declaration, by modifying the matched parameters with the <code>match</code> keyword:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> matchAnimalAndPerson</span><span style="color: #B338FF">(</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> animal: Animal, </span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> person: Person</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Dog </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> name </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Lucky</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, Man </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">18</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Good dog and young man!</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Cat </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, Woman </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> happinessLevel </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">8</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Old cat and happy woman!</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Horse </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> height </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">180</span><span style="color: #5B5B5B">, Person </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> hobby </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Horseriding</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Tall horse and a true horseriding lover!</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Nothing interesting here</span><span style="color: #5B5B5B">"</span></code></pre>
<p>Observing the above carefully, it may be noticed the <code>: Animal</code> and <code>: Person</code> annotations are not strictly necessary, since the parameter types are being explicitly asserted at every case clause. When this is the case, the type annotations can be omitted and would be inferred by the compiler:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> matchAnimalAndPerson</span><span style="color: #B338FF">(</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> animal, </span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> person</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Dog </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> name </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Lucky</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, Man </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">18</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Good dog and young man!</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Cat </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, Woman </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> happinessLevel </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">8</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Old cat and happy woman!</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Horse </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> height </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">180</span><span style="color: #5B5B5B">, Person </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> hobby </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Horseriding</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Tall horse and a true horseriding lover!</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">fail</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Nothing interesting here</span><span style="color: #5B5B5B">"</span>

<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Note the 'otherwise' clause must fail for the parameter types to be properly inferred!</span>
<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">//</span>
<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Having a non-failing 'otherwise' clause would mean that the function</span>
<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// could possibly accept any type for 'animal' and 'person' and still succeed!</span></code></pre>
<p>The <code>matchAnimalAndPerson</code> function type is inferred to include several overloads, corresponding to each valid type combination case. Variants with and without assertion types (introduced in a later chapter) are shown:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #A1A1A1">// Without assertion types, the compiler infers:</span>
<span style="color: #0057E6">function</span><span style="color: #5B5B5B"> matchAnimalAndPerson</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">animal: Dog, person: Man</span><span style="color: #B338FF">)</span>
<span style="color: #0057E6">function</span><span style="color: #5B5B5B"> matchAnimalAndPerson</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">animal: Cat, person: Woman</span><span style="color: #B338FF">)</span>
<span style="color: #0057E6">function</span><span style="color: #5B5B5B"> matchAnimalAndPerson</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">animal: Horse, person: Person</span><span style="color: #B338FF">)</span>

<span style="color: #A1A1A1">// With assertion types, the compiler infers:</span>
<span style="color: #0057E6">function</span><span style="color: #5B5B5B"> matchAnimalAndPerson</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">animal: Dog </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> name </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Lucky</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, person: Man </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">18</span><span style="color: #B338FF">)</span>
<span style="color: #0057E6">function</span><span style="color: #5B5B5B"> matchAnimalAndPerson</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">animal: Cat </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, person: Woman </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> happinessLevel </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">8</span><span style="color: #B338FF">)</span>
<span style="color: #0057E6">function</span><span style="color: #5B5B5B"> matchAnimalAndPerson</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">animal: Horse </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> height </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">180</span><span style="color: #5B5B5B">, person: Person </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> hobby </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Horseriding</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span></code></pre>
<p>Even without the <code>match</code> modifier, parameter types can still be omitted and asserted in the method body using the <code>is</code> operator:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> testXY</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x, y</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> x </span><span style="color: #0057E6">is</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">integer</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> y </span><span style="color: #0057E6">is</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">integer</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #E65C00">1</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> y </span><span style="color: #0057E6">is</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">decimal</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span>

<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// (Note the omitted 'otherwise' clauses are interpreted as a fail cases)</span>

<span style="color: #A1A1A1">// Inferred signature:</span>
<span style="color: #A1A1A1">// function testXY(x: integer, y: integer)</span>
<span style="color: #A1A1A1">// function testXY(x: integer, y: decimal)</span></code></pre>
<h2 id="exhaustiveness-checking"><a class="header-anchor" href="#exhaustiveness-checking">ยง</a>Exhaustiveness checking</h2>
<p>The compiler will try to ensure that matched cases include all possible values for a type:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> notExhaustive</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">someBoolean: </span><span style="color: #0057E6">boolean</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> someBoolean</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">true</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">OK!</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// Error! No handling of the case when someBoolean == false</span></code></pre>
<h2 id="single-pattern-matching"><a class="header-anchor" href="#single-pattern-matching">ยง</a>Single pattern matching</h2>
<p>Sometimes it may be useful to match a value only against a single pattern. The <code>matches</code> operator allows that:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> firstTwoElementsAreConsecutive</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">values: List</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0057E6">boolean</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span>
<span style="color: #5B5B5B">	values </span><span style="color: #0057E6">matches</span><span style="color: #5B5B5B"> [</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> first, </span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> second </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> first </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, ...]</span></code></pre>
<h2 id="loops"><a class="header-anchor" href="#loops">ยง</a>Loops</h2>
<p><strong>Loops</strong> are control flow mechanisms for specifying code to be executed repeatedly.</p>
<p>In Island, <strong>loops are founded in functional iteration patterns</strong> and describe iterative progression in a more declarative way than in conventional imperative languages.</p>
<p>Island's <code>for</code> loops maintain immutability for all variables within the scope of <strong>each individual iteration</strong> of the loop. This is achieved by:</p>
<ul>
<li>Requiring all alterable variables to be declared at the head of the loop.</li>
<li>Requiring all variable alterations to be conducted within a <code>continue</code> or <code>break</code> statement, or within the loop's <code>advance</code> clause.</li>
<li>Requiring variables exposed to the outer scope (after the loop has finished) to be declared with the <code>out</code> modifier.</li>
</ul>
<p>Here's the factorial operation, implemented using a <code>for</code> loop:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> factorial</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">out</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">if</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> num</span>
<span style="color: #5B5B5B">		 	</span><span style="color: #A1A1A1">// The continue statement defines the next values of 'result' and 'i':</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">continue</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> i, i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> result</span></code></pre>
<p>It may seem, at first, like <code>i</code> and <code>result</code> are no different than mutable variables, since they can be repeatedly modified at every iteration, however, they are not actually mutable because they are not real variables!</p>
<p>Since Island loops act a lot like functions, <code>i</code> and <code>result</code> could be thought as being analogous to a function parameter and a return variable. Since the <code>continue</code> statement is only executed at the moment the loop is ready to proceed to its next iteration, it can be seen as if the loop is &quot;restarting&quot; with a different initial state. This is analogous to a function being repeatedly tail-recursively invoked with a different set of arguments.</p>
<p>For comparison, here is equivalent code, translated to a tail-recursive function (reference code lines are in the comments):</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> factorial</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// for i = 1, out result = 1</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> iterate</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// if i &lt;= num</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">if</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> num</span>
<span style="color: #5B5B5B">			</span><span style="color: #A1A1A1">// continue result = result * i, i = i + 1</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> iterate</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> i, i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">else</span>
<span style="color: #5B5B5B">			</span><span style="color: #A1A1A1">// (implicitly returns)</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> result</span>

<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// return result</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> iterationResult </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> iterate</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> iterationResult</span></code></pre>
<p>The <code>for</code> loop syntax also allows to define a continuation condition using a <code>while</code> clause and a set of predefined alterations using an <code>advance</code> clause, which are applied after any alterations in a <code>continue</code> statement within the loop body. The <code>factorial</code> function can be rewritten to:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> factorial</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// In C-style languages this would be written as:</span>
<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// int result;</span>
<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// for (int i = 1, result = 1; i &lt;= num; i += 1)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">out</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">while</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> num </span><span style="color: #0057E6">advance</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">continue</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">*=</span><span style="color: #5B5B5B"> i</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> result</span></code></pre>
<p>Loops can be aborted with the <code>break</code> keyword, which also allows for alterations of <code>out</code> variables:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> boundedFactorial</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">out</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">while</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> num </span><span style="color: #0057E6">advance</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">100</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">continue</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">*=</span><span style="color: #5B5B5B"> i</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">otherwise</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">break</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">nothing</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> result</span></code></pre>
<p>Here's a binary search implemented using a <code>for</code> loop and pattern matching, formatted to allow for better readability:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> binarySearch</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">values: List</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">, target: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> low </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, high </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> values.length, mid </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">low </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> high</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">/</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">while</span><span style="color: #5B5B5B"> low </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> high</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">advance</span><span style="color: #5B5B5B"> mid </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">low </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> high</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">/</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> values[mid]</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> target</span>
<span style="color: #5B5B5B">				</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> mid</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> _ </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> target</span>
<span style="color: #5B5B5B">				</span><span style="color: #0057E6">continue</span><span style="color: #5B5B5B"> low </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> mid </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">otherwise</span>
<span style="color: #5B5B5B">				</span><span style="color: #0057E6">continue</span><span style="color: #5B5B5B"> high </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> mid </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">nothing</span></code></pre>
<p>Here's equivalent code translated to a tail-recursive function (original code in comments):</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> binarySearch</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">values: List</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">, target: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// for low = 1, high = values.length, mid = (low + high) / 2</span>
<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// ..</span>
<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// advance mid = (low + high) / 2</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> iterate</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">low </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, high </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> values.length, mid </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">low </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> high</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">/</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// while low &lt;= high</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> low </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> high</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> values[mid]</span>
<span style="color: #5B5B5B">				</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> target</span>
<span style="color: #5B5B5B">					</span><span style="color: #A1A1A1">// return mid</span>
<span style="color: #5B5B5B">					</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> mid</span>
<span style="color: #5B5B5B">				</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> _ </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> target</span>
<span style="color: #5B5B5B">					</span><span style="color: #A1A1A1">// continue low = mid + 1</span>
<span style="color: #5B5B5B">					</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> iterate</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">low </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> mid </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, high </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> high</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">				</span><span style="color: #0057E6">otherwise</span>
<span style="color: #5B5B5B">					</span><span style="color: #A1A1A1">// continue high = mid - 1</span>
<span style="color: #5B5B5B">					</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> iterate</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">low </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> low, high </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> mid </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">otherwise</span>
<span style="color: #5B5B5B">			</span><span style="color: #A1A1A1">// return nothing</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">nothing</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> iterate</span><span style="color: #B338FF">()</span></code></pre>
<p>Loops can be <strong>nested</strong>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> combinationsOf2</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">min: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, max: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> min, </span><span style="color: #0057E6">out</span><span style="color: #5B5B5B"> result: List</span><span style="color: #000000">&lt;</span><span style="color: #B338FF">(</span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [] </span><span style="color: #0057E6">while</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> max </span><span style="color: #0057E6">advance</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> min, </span><span style="color: #0057E6">out</span><span style="color: #5B5B5B"> row: List</span><span style="color: #000000">&lt;</span><span style="color: #B338FF">(</span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [] </span><span style="color: #0057E6">while</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> max </span><span style="color: #0057E6">advance</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">continue</span><span style="color: #5B5B5B"> row </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> [</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x, y</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">]</span>

<span style="color: #5B5B5B">		</span><span style="color: #0057E6">continue</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> row</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> result</span>

<span style="color: #5B5B5B">print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">combinationsOf2</span><span style="color: #B338FF">(</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">1</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints [(0, 0), (0, 1), (1, 0), (1, 1)]</span></code></pre>
<p>Nested loops are also reasonably straightforward to translate to recursive form:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> combinationsOf2</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">min: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, max: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: List</span><span style="color: #000000">&lt;</span><span style="color: #B338FF">(</span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #000000">&gt;</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> iterateX</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> min, result: List</span><span style="color: #000000">&lt;</span><span style="color: #B338FF">(</span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> []</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> iterateY</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">y </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> min, row: List</span><span style="color: #000000">&lt;</span><span style="color: #B338FF">(</span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> []</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> max </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> iterateY</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">y </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, row </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> row </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> [</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x, y</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">]</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> row</span>

<span style="color: #5B5B5B">		</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> max </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> iterateX</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> iterateY</span><span style="color: #B338FF">())</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> result</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> iterate</span><span style="color: #B338FF">()</span></code></pre>
<p>However, directly returning from an inner loop would be more tricky to express in recursive form. For example, the following function, which iterates to find a value in a square matrix:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> findFirstInSquareMatrix</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">matrix: List</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">List</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;&gt;</span><span style="color: #5B5B5B">, value: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B338FF">(</span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">?</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">while</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> matrix.length </span><span style="color: #0057E6">advance</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">while</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> matrix.length </span><span style="color: #0057E6">advance</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">if</span><span style="color: #5B5B5B"> matrix[x][y] </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> value</span>
<span style="color: #5B5B5B">				</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x, y</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">nothing</span></code></pre>
<p>Would be roughly translated to:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> findFirstInSquareMatrix</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">matrix: List</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">List</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;&gt;</span><span style="color: #5B5B5B">, value: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B338FF">(</span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">?</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> iterateX</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B338FF">(</span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">?</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> iterateY</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">y </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B338FF">(</span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">?</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> matrix.length</span>
<span style="color: #5B5B5B">				</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> matrix[x][y] </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> value </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x, y</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">				</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> iterateY</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">y </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">nothing</span>

<span style="color: #5B5B5B">		</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> iterateY</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> result </span><span style="color: #0057E6">is</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">nothing</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> result</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> matrix.length </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> iterateX</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">nothing</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> iterateX</span><span style="color: #B338FF">()</span></code></pre>
<h2 id="shorthand-with-expressions-in-continue-and-break-statements"><a class="header-anchor" href="#shorthand-with-expressions-in-continue-and-break-statements">ยง</a>Shorthand <code>with</code> expressions in <code>continue</code> and <code>break</code> statements</h2>
<p>It is common in <code>continue</code> and <code>break</code> statements to use <code>with</code> to alter one or more of the iteration variables, for example:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> someTuple </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, b: </span><span style="color: #E65C00">2</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">continue</span><span style="color: #5B5B5B"> someTuple </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> someTuple </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, b </span><span style="color: #000000">-=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">5</span><span style="color: #B338FF">)</span></code></pre>
<p>Instead of writing <code>someTuple = someTuple with ...</code>, the <code>with</code> operator can be shortened to:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> someTuple </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, b: </span><span style="color: #E65C00">2</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">continue</span><span style="color: #5B5B5B"> someTuple </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, b </span><span style="color: #000000">-=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">5</span><span style="color: #B338FF">)</span></code></pre>
<h1 id="data-streams"><a class="header-anchor" href="#data-streams">ยง</a>Data streams</h1>
<h2 id="stream-methods"><a class="header-anchor" href="#stream-methods">ยง</a>Stream methods</h2>
<p>A <strong>stream method</strong> (also called a <strong>generator</strong>) is a form of a subroutine enabling the incremental production of a sequence of values. Calling a stream method returns a <strong>stream object</strong> (also called an <strong>iterator</strong>), which is an object allowing step-wise consumption of the values produced by the stream method.</p>
<p>Stream methods produce values using the <code>yield</code> statement. Streams can be consumed within <code>for</code> loops using the <code>x in stream</code> clause:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> naturalNumbers</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">advance</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> i</span>

<span style="color: #0057E6">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> naturalNumbers</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Loops forever</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">i</span><span style="color: #B338FF">)</span>

<span style="color: #A1A1A1">// Prints 1, 2, 3, 4, 5, ....</span></code></pre>
<p><strong>Multiple streams</strong> may be consumed within a single <code>for</code> loop. At every iteration, each stream is evaluated once by its order of declaration. The loop will terminate whenever any one of the streams end:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> keypresses</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">forever</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> key </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> getKeyPress</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> key</span>

<span style="color: #0057E6">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">100</span><span style="color: #5B5B5B">, key </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> keypresses</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// This will repeat 100 times</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Keypress </span><span style="color: #B338FF">{</span><span style="color: #AA6631">i</span><span style="color: #B338FF">}</span><span style="color: #AA6631"> was '</span><span style="color: #B338FF">{</span><span style="color: #AA6631">key</span><span style="color: #B338FF">}</span><span style="color: #AA6631">'</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span></code></pre>
<p>A <strong>stream object</strong> is a stateless object, of the form:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Stream</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T</span><span style="color: #000000">&gt;</span>
<span style="color: #5B5B5B">	value: T? </span><span style="color: #A1A1A1">// The '?' means `value` may be of type `nothing`</span>
<span style="color: #5B5B5B">	ended: </span><span style="color: #0057E6">boolean</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> next</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B">: Stream</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// For an action stream, `next` would be an action instead</span></code></pre>
<p>Calling <code>next()</code> returns a new stream object, and would cause the previous one to be disposed (any attempt to access it would cause a runtime error).</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> numsInRange</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">min: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, max: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> min..max</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> i</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> step0 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> numsInRange</span><span style="color: #B338FF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> step1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> step0.next</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// The stream requires an initial next() call to produce its first value.</span>
<span style="color: #5B5B5B">print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">step1.value</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Prints 1</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> step2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> step1.next</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">step2.value</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Prints 2</span>

<span style="color: #5B5B5B">print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">step1.value</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error! step1 object has been disposed when step1.next() was called.</span></code></pre>
<p>The <code>Stream&lt;T&gt;.toList()</code> expansion method accumulates all successive elements of the stream into a list.</p>
<p>Using streams and <code>toList()</code>, a previous example - which enumerates all combinations of two integers in a given range - can now be simplified further:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> combinationsOf2</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">min: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, max: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> enumerateCombinations</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> x </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> min..max</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> y </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> min..max</span>
<span style="color: #5B5B5B">				</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x, y</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> enumerateCombinations</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B">.toList</span><span style="color: #B338FF">()</span></code></pre>
<p>(<em>Note calling <code>toList()</code> on an infinite stream would never terminate and may rapidly consume all machine memory!</em>).</p>
<p>A stream can yield the content of another stream using <code>yield stream</code>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> a</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> x </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">5</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> x</span>

<span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> b</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> x </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">12</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> x</span>

<span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> c</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> a </span><span style="color: #A1A1A1">// no need for parentheses if stream method has no parameters</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> b</span>

<span style="color: #0057E6">for</span><span style="color: #5B5B5B"> value </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> c</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">value</span><span style="color: #B338FF">)</span>

<span style="color: #A1A1A1">// prints 1, 2, 3, 4, 5, 9, 10, 11, 12</span></code></pre>
<h2 id="accumulative-streams-and-named-return-variables"><a class="header-anchor" href="#accumulative-streams-and-named-return-variables">ยง</a>Accumulative streams and named return variables</h2>
<p>Oftentimes it is useful to be able to make small, incremental alterations to a value, such as when piecing out a string, building an object, sorting a list, or calculating a complex math formula.</p>
<p>Imagine you wanted to create a function that builds a URL string from an object specifying its parts. In an imperative language, that would be easy. You could write something like:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> urlTostring</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">url: Url</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	var urlstring </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">""</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// There's no 'var' in Island - this is only meant for illustration</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">if</span><span style="color: #5B5B5B"> url.isSecure</span>
<span style="color: #5B5B5B">		urlstring </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">https://</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">else</span>
<span style="color: #5B5B5B">		urlstring </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">http://</span><span style="color: #5B5B5B">"</span>

<span style="color: #5B5B5B">	urlstring </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> url.hostname</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">if</span><span style="color: #5B5B5B"> url.port </span><span style="color: #0057E6">is</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">nothing</span>
<span style="color: #5B5B5B">		urlstring </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">:</span><span style="color: #B338FF">{</span><span style="color: #AA6631">url.port</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span>

<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// ....</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> urlstring</span></code></pre>
<p>Unfortunately Island doesn't support the <code>var</code> keyword, so how could we approach this?</p>
<p>One option would be to give a different name to <code>urlstring</code> every time we want to change it:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> urlTostring</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">url: Url</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> urlstring1</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">if</span><span style="color: #5B5B5B"> url.isSecure</span>
<span style="color: #5B5B5B">		urlstring1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">https://</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">else</span>
<span style="color: #5B5B5B">		urlstring1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">http://</span><span style="color: #5B5B5B">"</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> urlstring2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> urlstring1 </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> url.hostname</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> urlstring3</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">if</span><span style="color: #5B5B5B"> url.port </span><span style="color: #0057E6">is</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">nothing</span>
<span style="color: #5B5B5B">		urlstring3 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> urlstring2 </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">:</span><span style="color: #B338FF">{</span><span style="color: #AA6631">url.port</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span>

<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// ....</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> urlstringX</span></code></pre>
<p>That looks, well, pretty bad. Couldn't we do better than that?</p>
<p>OK, so how about using an inner stream method?</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> urlTostring</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">url: Url</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> buildstring</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">if</span><span style="color: #5B5B5B"> url.isSecure</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">https://</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">else</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">http://</span><span style="color: #5B5B5B">"</span>

<span style="color: #5B5B5B">		</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> url.hostname</span>

<span style="color: #5B5B5B">		</span><span style="color: #0057E6">if</span><span style="color: #5B5B5B"> url.port </span><span style="color: #0057E6">is</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">nothing</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">:</span><span style="color: #B338FF">{</span><span style="color: #AA6631">url.port</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span>

<span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// ....</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> buildstring</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B">.JoinStrings</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">""</span><span style="color: #B338FF">)</span></code></pre>
<p>Looks a bit better! but a solution like this will only work for simple list concatenations, we want something more flexible that would generalize over to arbitrary computations of a similar nature.</p>
<p>The general pattern seems to be that every yielded value &quot;builds&quot; over the previous one. So maybe the <code>yield</code> statement could provide a &quot;placeholder&quot; variable that would represent the previous value? something like:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> urlTostring</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">url: Url</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> buildstring</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">initial</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">""</span>

<span style="color: #5B5B5B">		</span><span style="color: #0057E6">if</span><span style="color: #5B5B5B"> url.isSecure</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">prior</span><span style="color: #5B5B5B"> </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">https://</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">else</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">prior</span><span style="color: #5B5B5B"> </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">http://</span><span style="color: #5B5B5B">"</span>

<span style="color: #5B5B5B">		</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">prior</span><span style="color: #5B5B5B"> </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> url.hostname</span>

<span style="color: #5B5B5B">		</span><span style="color: #0057E6">if</span><span style="color: #5B5B5B"> url.port </span><span style="color: #0057E6">is</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">nothing</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">prior</span><span style="color: #5B5B5B"> </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">:</span><span style="color: #B338FF">{</span><span style="color: #AA6631">url.port</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span>

<span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// ....</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> buildstring</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B">.last</span><span style="color: #B338FF">()</span></code></pre>
<p>We'll call this an <strong>accumulative stream</strong>.</p>
<p>However, this still doesn't look pretty (frankly, even more verbose than the previous solution), we've got that nested function, and all those repeated <code>yield prior ..</code>s. Also, do we really need to yield all those intermediate results? There must be a simpler way.</p>
<p>We can take this pattern and make it more implicit by introducing the notion of a <strong>named return variable</strong>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> urlTostring</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">url: Url</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">urlstring: </span><span style="color: #0057E6">string</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">""</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">if</span><span style="color: #5B5B5B"> url.isSecure</span>
<span style="color: #5B5B5B">		urlstring </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> urlstring </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">https://</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">else</span>
<span style="color: #5B5B5B">		urlstring </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> urlstring </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">http://</span><span style="color: #5B5B5B">"</span>

<span style="color: #5B5B5B">	urlstring </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> urlstring </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> url.hostname</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">if</span><span style="color: #5B5B5B"> url.port </span><span style="color: #0057E6">is</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">nothing</span>
<span style="color: #5B5B5B">		urlstring </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> urlstring </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">:</span><span style="color: #B338FF">{</span><span style="color: #AA6631">url.port</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span>

<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// ....</span>

<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// No need to return anything, since the return variable(s) have been explicitly declared</span></code></pre>
<p>But wait a minute! you said Island didn't have <code>var</code>, and here you're using <code>urlstring</code> like it was mutable? what's going on?</p>
<p>The answer is that <code>urlstring</code> is not really mutable because it is not a real variable! It is a placeholder for a <code>yield</code> pattern representing incremental computations. The pattern:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #5B5B5B">returnVariable </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">expression possibly including returnVariable</span><span style="color: #000000">&gt;</span></code></pre>
<p>Is equivalent to:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">expression possibly including </span><span style="color: #0057E6">prior</span><span style="color: #000000">&gt;</span></code></pre>
<p>And:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #5B5B5B">: </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">returnValue: T </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> initialValue</span><span style="color: #B338FF">)</span></code></pre>
<p>Is equivalent to:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">initial</span><span style="color: #5B5B5B"> initialValue</span></code></pre>
<p>And finally, returning from the function implicitly returns the last value yielded.</p>
<p>Now we can now allow the <code>resultVariable = resultVariable + something</code> pattern to be shortened to <code>resultVariable += something</code>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> urlTostring</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">url: Url</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">urlstring: </span><span style="color: #0057E6">string</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">""</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">if</span><span style="color: #5B5B5B"> url.isSecure</span>
<span style="color: #5B5B5B">		urlstring </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">https://</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">else</span>
<span style="color: #5B5B5B">		urlstring </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">http://</span><span style="color: #5B5B5B">"</span>

<span style="color: #5B5B5B">	urlstring </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> url.hostname</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">if</span><span style="color: #5B5B5B"> url.port </span><span style="color: #0057E6">is</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">nothing</span>
<span style="color: #5B5B5B">		urlstring </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">:</span><span style="color: #B338FF">{</span><span style="color: #AA6631">url.port</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span>

<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// ....</span>

<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// No need to return anything, urlstring is returned by default</span></code></pre>
<p>And here you go! looks like reasonable code.</p>
<p>Now let's try to define more precisely what exactly are the constraints on a named return variable:</p>
<p>A <strong>named return variable</strong> is a special variable that:</p>
<ul>
<li><strong>Can</strong> be reassigned multiple times, including from within conditionals and loop bodies.</li>
<li><strong>Can</strong> be passed to any method (including to an action or an object initializer).</li>
<li><strong>Can only</strong> be read from within an expression that is <strong>assigned back to itself</strong>.</li>
<li><strong>Cannot</strong> be accessed from within a nested function or action.</li>
</ul>
<p>Accumulative patterns also allow for several <strong>optimizations</strong> to take place, for example when shuffling a list:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> shuffle</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">values: List</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">, seed: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">suffledValues </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> values</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..values.length, rand </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> Random</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">seed</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> randIndex </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> rand.range</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">i </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, values.length</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">		suffledValues </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> suffledValues </span><span style="color: #0057E6">with</span>
<span style="color: #5B5B5B">			[i] </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> suffledValues[randIndex]</span>
<span style="color: #5B5B5B">			[randIndex] </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> suffledValues[i]</span></code></pre>
<p>Since <code>suffledValues</code> can only be read for the purpose of modifying itself, there is no need for the <code>with</code> operation to create a new copy of the list every time it is performed, and the intermediate results can be written in-place.</p>
<p>With a named return variable, a previous example can be made simpler:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> combinationsOf2</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">min: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, max: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">result: List</span><span style="color: #000000">&lt;</span><span style="color: #B338FF">(</span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> []</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> x </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> min..max</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> y </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> min..max</span>
<span style="color: #5B5B5B">			result </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> [</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x, y</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">]</span></code></pre>
<h2 id="list-and-stream-comprehensions"><a class="header-anchor" href="#list-and-stream-comprehensions">ยง</a>List and stream comprehensions</h2>
<p><strong>List comprehensions</strong> allow building a list from <code>for</code>-like expressions.</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> l </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #B338FF">(</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">5</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> i</span><span style="color: #000000">*</span><span style="color: #5B5B5B">i]</span>
<span style="color: #A1A1A1">// l = [1, 4, 9, 16, 25]</span></code></pre>
<p>A <strong>filtering predicate</strong> can also be added, using the <code>where</code> clause:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> l </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #B338FF">(</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> i</span><span style="color: #000000">*</span><span style="color: #5B5B5B">i]</span>
<span style="color: #A1A1A1">// l = [4, 16]</span></code></pre>
<p><strong>Multiple streams</strong> may be consumed concurrently, and each may have a different <code>where</code> clause:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> l </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #B338FF">(</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">6</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, j </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> j </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> j]</span>
<span style="color: #A1A1A1">// l = [5, 10, 15]</span></code></pre>
<p>Like in <code>for</code> loops, consuming streams of <strong>different lengths</strong> would end whenever the shorter of them ends:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> l </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #B338FF">(</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">a</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">..</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">c</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, j </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">6</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">i, j</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">]</span>
<span style="color: #A1A1A1">// l = [("a", 1), ("b", 2), ("c", 3)]</span></code></pre>
<p>Stream expressions can be <strong>nested</strong>, by successively passing the <code>=&gt;</code> symbol through multiple streams. This allows to further simplify the implementation for the combination enumeration example mentioned earlier:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> combinationsOf2</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">min: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, max: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span>
<span style="color: #5B5B5B">	[</span><span style="color: #B338FF">(</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> x </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> min..max</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> y </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> min..max</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x, y</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">]</span>

<span style="color: #5B5B5B">print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">combinationsOf2</span><span style="color: #B338FF">(</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">1</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints [(0, 0), (0, 1), (1, 0), (1, 1)]</span></code></pre>
<p>Similarly to <code>for</code> loops, comprehensions may introduce variables and include <code>while</code> and <code>advance</code> clauses:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> sumsOfNaturalsUpTo5 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #B338FF">(</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, sum </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">advance</span><span style="color: #5B5B5B"> sum </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> i</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> sum] </span><span style="color: #A1A1A1">// [1, 3, 6, 10, 15]</span></code></pre>
<p>Comprehensions may be <strong>accumulative</strong>, and make use of the <code>initial</code> and <code>prior</code> keywords:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> sumsOfNaturalsUpTo5 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #B338FF">(</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">initial</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, i </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">5</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">prior</span><span style="color: #5B5B5B"> </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> i]  </span><span style="color: #A1A1A1">// [1, 3, 6, 10, 15]</span></code></pre>
<p><strong>Stream comprehensions</strong> use identical syntax, excluding the brackets, but create a stream method instead:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> squaresOfEvenNumbers </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..</span><span style="color: #0057E6">infinity</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> i</span><span style="color: #000000">**</span><span style="color: #E65C00">2</span>
<span style="color: #A1A1A1">// The type of squaresOfEvenNumbers is 'stream () =&gt; integer'</span>

<span style="color: #A1A1A1">// (Note: since squaresOfEvenNumbers is a stream method with no parameters,</span>
<span style="color: #A1A1A1">//  the for..in syntax allows it to be optionally invoked without the parentheses '()')</span>
<span style="color: #0057E6">for</span><span style="color: #5B5B5B"> n </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> squaresOfEvenNumbers</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">n</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints 4, 16, 36, 64, ....</span></code></pre>
<p>Now the factorial example can be simplified to a single line:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> factorial</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">..</span><span style="color: #0057E6">infinity</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">((</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">initial</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, i </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..num</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">prior</span><span style="color: #5B5B5B"> </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> i</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">.last</span></code></pre>
<p>Here's the infamous &quot;Fizz-Buzz&quot; problem implemented using a stream comprehension and a <code>when</code> expression:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> divides</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x, y</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span>

<span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> fizzBuzz</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span>
<span style="color: #5B5B5B">	</span><span style="color: #B338FF">(</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..</span><span style="color: #0057E6">infinity</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> divides</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">i, </span><span style="color: #E65C00">15</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">FizzBuzz</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">,</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> divides</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">i, </span><span style="color: #E65C00">3</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Fizz</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">,</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> divides</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">i, </span><span style="color: #E65C00">5</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Buzz</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">,</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">{</span><span style="color: #AA6631">i</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span></code></pre>
<p>Here's a very simple recursive quicksort implementation using list comprehensions, pattern matching, and the spread operator:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> quicksort</span><span style="color: #B338FF">(</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> items: List</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> [] </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> []</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">otherwise</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> pivot </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> items[items.length </span><span style="color: #000000">/</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">]</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> left </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> quicksort</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">[</span><span style="color: #B338FF">(</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> x </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> items </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> pivot</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> x]</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> right </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> quicksort</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">[</span><span style="color: #B338FF">(</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> x </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> items </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> pivot</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> x]</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> [...left, ...right]</span></code></pre>
<p>Here's a simple bounded sieve of Eratosthenes using a <code>for</code> loop and a list comprehension:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> primesTo</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">max: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> n </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">..max, nonprimes: Set</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">{}</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">if</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> nonprimes.includes</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">n</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> n</span>

<span style="color: #5B5B5B">			</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> multiplesOfN </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #B338FF">(</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">initial</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> n</span><span style="color: #000000">**</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">while</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">prior</span><span style="color: #5B5B5B"> </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> max</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">prior</span><span style="color: #5B5B5B"> </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> n]</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">continue</span><span style="color: #5B5B5B"> nonprimes </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> nonprimes.union</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">multiplesOfN</span><span style="color: #B338FF">)</span></code></pre>
<p>Wouldn't it be nice to make an infinite-length (unbounded) stream which enumerates all prime numbers? This can be achieved by, for each prime encountered, storing a stream enumerating its multiples, and at each step incrementally advancing the collected streams as needed:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> primes</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Generates the integer sequence n^2, n^2 + n, n^2 + n + n, n^2 + n + n + n, ...</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> multiplesOfN</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">n: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span>
<span style="color: #5B5B5B">		</span><span style="color: #B338FF">(</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">initial</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> n</span><span style="color: #000000">**</span><span style="color: #E65C00">2</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">prior</span><span style="color: #5B5B5B"> </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> n</span>

<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// For n in 2..infinity</span>
<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// At each step, advance each stream until a value greater than or equal to n is reached</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> n </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">..</span><span style="color: #0057E6">infinity</span><span style="color: #5B5B5B">, nonprimeStreams: List</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">Stream</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> []</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">advance</span><span style="color: #5B5B5B"> nonprimeStreams </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #B338FF">(</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> nonprimeStreams</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> i.skipUntil</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> num </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> n</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">]</span>

<span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// Search the stream object collection for an stream that reached exactly n</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">if</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> nonprimeStreams.includes</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">nonprimeStream </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> nonprimeStream.value </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> n</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">			</span><span style="color: #A1A1A1">// If none found then n is a prime - yield it</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> n</span>

<span style="color: #5B5B5B">			</span><span style="color: #A1A1A1">// Create a new (infinite-length) stream for the multiples of the prime just found</span>
<span style="color: #5B5B5B">			</span><span style="color: #A1A1A1">// and add it to the collection</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">continue</span><span style="color: #5B5B5B"> nonprimeStreams </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> multiplesOfN</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">n</span><span style="color: #B338FF">)</span></code></pre>
<p>List and stream comprehensions allow to easily implement common higher-order sequence processing functions like, <code>map</code>, <code>flatMap</code>, <code>filter</code>, <code>reduce</code> and <code>zip</code>, evaluated either eagerly (through list comprehensions) or lazily (through stream comprehensions). The generality of these operations requires type parameters, which would be introduced in a future chapter:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> map</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">E, R</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">valueStream: Stream</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">E</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">, transform: E </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> R</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span>
<span style="color: #5B5B5B">	</span><span style="color: #B338FF">(</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> e </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> valueStream</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> transform</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">e</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> flatMap</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">E, R</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">valueStreams: Stream</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">Stream</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">E</span><span style="color: #000000">&gt;&gt;</span><span style="color: #5B5B5B">, transform: E </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> R</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span>
<span style="color: #5B5B5B">	</span><span style="color: #B338FF">(</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> e </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">((</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> valueStreams</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> i</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> transform</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">e</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> filter</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">E</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">valueStream: Stream</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">E</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">, filteringPredicate: E </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">boolean</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span>
<span style="color: #5B5B5B">	</span><span style="color: #B338FF">(</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> e </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> valueStream </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> filteringPredicate</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">e</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> e</span>

<span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> zip</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">E1, E2</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">stream1: Stream</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">E1</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">, stream2: Stream</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">E2</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span>
<span style="color: #5B5B5B">	</span><span style="color: #B338FF">(</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> e1 </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> stream1, e2 </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> stream2</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">e1, e2</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> accumulate</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">E, R</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">valueStream: Stream</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">E</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">, accumulator: </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">R, E</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> R, initialResult: R</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span>
<span style="color: #5B5B5B">	</span><span style="color: #B338FF">(</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">initial</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> initialResult, e </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> valueStream</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> accumulator</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">e, </span><span style="color: #0057E6">prior</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> reduce</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">E, R</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">valueStream: Stream</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">E</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">, accumulator: </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">R, E</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> R, initialResult: R</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span>
<span style="color: #5B5B5B">	accumulate</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">valueStream, accumulator, initialResult</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">.last</span></code></pre>
<p><em>Note the use of <code>=</code> and not <code>=&gt;</code> when defining a method using a stream comprehension. Stream comprehensions are expressions that evaluate to stream methods, not values. We don't want a call to <code>map()</code> to return a method, but a stream object. Using the equals operation binds the parameters of the declared function into the comprehension, composing a new function, which returns a stream object when called.</em></p>
<h2 id="for-loops-as-methods"><a class="header-anchor" href="#for-loops-as-methods">ยง</a>For-loops as methods</h2>
<p>Like comprehensions, <code>for</code>-loops can also be converted to stand-alone methods:</p>
<p>So instead of:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> factorial</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..num </span><span style="color: #0057E6">out</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">continue</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">*=</span><span style="color: #5B5B5B"> i</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> result</span></code></pre>
<p>We can write:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> factorial</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Note the equals operator</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..num </span><span style="color: #0057E6">out</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">continue</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">*=</span><span style="color: #5B5B5B"> i</span></code></pre>
<p>Loop variables marked with <code>out</code> would be treated as return values. If there are more than one, they would be returned as a tuple, arranged by their order of declaration.</p>
<h1 id="compound-and-polymorphic-data-types"><a class="header-anchor" href="#compound-and-polymorphic-data-types">ยง</a>Compound and polymorphic data types</h1>
<h2 id="classes-and-objects"><a class="header-anchor" href="#classes-and-objects">ยง</a>Classes and objects</h2>
<p>A <strong>class</strong> is a template allowing the creation of object structures, which are also simply called <strong>objects</strong>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Person</span>
<span style="color: #5B5B5B">	firstName: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	lastName: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	age: </span><span style="color: #0057E6">integer</span>

<span style="color: #A1A1A1">// Shorter syntax:</span>
<span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Person </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> firstName: </span><span style="color: #0057E6">string</span><span style="color: #5B5B5B">, lastName: </span><span style="color: #0057E6">string</span><span style="color: #5B5B5B">, age: </span><span style="color: #0057E6">integer</span></code></pre>
<p>The <code>with</code> operator can be used to create a new object using the <code>Person</code> class as its template:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> andy </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Person </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> firstName </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Andy</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, lastName </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Williams</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, Age </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">19</span></code></pre>
<p>A class may also be invoked like a constructor method, and would return a new object, whose fields receive the arguments passed to it, by their order of declaration:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> andy </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Person</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Andy</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Williams</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">19</span><span style="color: #B338FF">)</span></code></pre>
<!--
The behavior of the class construction invocation can be customized using an **initializer** method.
```isl
class Person
	firstName: string
	lastName: string
	age: integer

	initialize(fullName: string, age: integer)
		// When accessed through an initializer, fields are write-only and can be
		// written to multiple times, but not read.
		[self.firstName, self.lastName] = fullName.split(" ")
		self.age = age

let person = Person("John Doe", 23)
```


Initializers parameters can be set to automatically assign to a field with a matching name. This is equivalent:
```isl
class Person
	firstName: string
	lastName: string
	age: integer

	initialize(fullName: string, self.age: integer)
		[self.firstName, self.lastName] = fullName.split(" ")
		// No need to specify self.age = age, it is implied by the parameter identifier
```
-->
<p>One or more class fields may have default values:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Person</span>
<span style="color: #5B5B5B">	firstName </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Anonymous</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	lastName </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">""</span>
<span style="color: #5B5B5B">	age: </span><span style="color: #0057E6">integer</span></code></pre>
<p>In addition to fields, classes may include functions, actions, computed fields, indexers and default streams:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Person</span>
<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Fields</span>
<span style="color: #5B5B5B">	firstName: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	lastName: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	age: </span><span style="color: #0057E6">integer</span>

<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Function (long syntax)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> agePlusSomething</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">something: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> something</span>

<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Function (short syntax)</span>
<span style="color: #5B5B5B">	agePlusSomething</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">something: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> something</span>

<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Action (long syntax)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> printDescription</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">		print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">description</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Action (short syntax)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> printDescription</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">description</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Computed field (long syntax)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">computed</span><span style="color: #5B5B5B"> description</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">{</span><span style="color: #AA6631">firstName</span><span style="color: #B338FF">}</span><span style="color: #AA6631"> </span><span style="color: #B338FF">{</span><span style="color: #AA6631">lastName</span><span style="color: #B338FF">}</span><span style="color: #AA6631">, of </span><span style="color: #B338FF">{</span><span style="color: #AA6631">age</span><span style="color: #B338FF">}</span><span style="color: #AA6631"> years of age</span><span style="color: #5B5B5B">"</span>

<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Computed field (short syntax)</span>
<span style="color: #5B5B5B">	description </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">{</span><span style="color: #AA6631">firstName</span><span style="color: #B338FF">}</span><span style="color: #AA6631"> </span><span style="color: #B338FF">{</span><span style="color: #AA6631">lastName</span><span style="color: #B338FF">}</span><span style="color: #AA6631">, of </span><span style="color: #B338FF">{</span><span style="color: #AA6631">age</span><span style="color: #B338FF">}</span><span style="color: #AA6631"> years of age</span><span style="color: #5B5B5B">"</span>

<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Indexer</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">this</span><span style="color: #5B5B5B">[</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> index]</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> firstName</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> lastName</span>

<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Default stream</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">this</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> firstName</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> lastName</span></code></pre>
<p>Member usage examples:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> p </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Person</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Catherine</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Jones</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">41</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">p.agePlusSomething</span><span style="color: #B338FF">(</span><span style="color: #E65C00">5</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// returns 46</span>
<span style="color: #5B5B5B">p.printDescription</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints "Catherine Jones, of 41 years of age"</span>
<span style="color: #5B5B5B">p.description </span><span style="color: #A1A1A1">// returns "Catherine Jones, of 41 years of age"</span>
<span style="color: #5B5B5B">p[</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// returns "Jones"</span>

<span style="color: #0057E6">for</span><span style="color: #5B5B5B"> m </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> p</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">m</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints "Catherine" "Jones"</span></code></pre>
<p>A class method can use the <code>this</code> object and the <code>with</code> operator to create a altered copy of its containing object:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Person</span>
<span style="color: #5B5B5B">	firstName: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	lastName: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	age: </span><span style="color: #0057E6">integer</span>

<span style="color: #5B5B5B">	getOlderPerson</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">yearsToAdd: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">this</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> yearsToAdd</span></code></pre>
<p>Alterations can be applied deeper into the object hierarchy:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Group</span>
<span style="color: #5B5B5B">	members: List</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">Person</span><span style="color: #000000">&gt;</span>
<span style="color: #5B5B5B">	sharedInterest: </span><span style="color: #0057E6">string</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> golfers </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Group </span><span style="color: #0057E6">with</span>
<span style="color: #5B5B5B">	members </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [Person</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">John</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Smith</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">24</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">, Person</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Jane</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Doe</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">42</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">]</span>
<span style="color: #5B5B5B">	sharedInterest </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Golf</span><span style="color: #5B5B5B">"</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> deeplyAlteredGroup </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> golfers </span><span style="color: #0057E6">with</span>
<span style="color: #5B5B5B">	members[</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">].firstName </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Michael</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	members[</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">].age </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">45</span></code></pre>
<p>The <code>with</code> operator also allows for merging syntax on objects, the following is equivalent:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> deeplyAlteredGroup </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> golfers </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">{</span><span style="color: #5B5B5B"> members: [</span><span style="color: #B338FF">{</span><span style="color: #5B5B5B"> firstName: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Michael</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">, </span><span style="color: #B338FF">{</span><span style="color: #5B5B5B"> age: </span><span style="color: #E65C00">45</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">] </span><span style="color: #B338FF">}</span></code></pre>
<h2 id="extension"><a class="header-anchor" href="#extension">ยง</a>Extension</h2>
<p><strong>Extension</strong> (also called <strong>inheritance</strong>) allows a new type to built on the basis of an existing type.</p>
<p>Classes can only extend a single <strong>base class</strong>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Person</span>
<span style="color: #5B5B5B">	firstName: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	lastName: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	age: </span><span style="color: #0057E6">integer</span>

<span style="color: #0057E6">class</span><span style="color: #5B5B5B"> PersonWithHeight </span><span style="color: #0057E6">extends</span><span style="color: #5B5B5B"> Person</span>
<span style="color: #5B5B5B">	height: </span><span style="color: #0057E6">decimal</span>

<span style="color: #A1A1A1">// Shorter syntax:</span>
<span style="color: #0057E6">class</span><span style="color: #5B5B5B"> PersonWithHeight </span><span style="color: #0057E6">extends</span><span style="color: #5B5B5B"> Person </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> height: </span><span style="color: #0057E6">decimal</span></code></pre>
<!--
**Custom initializers** of an extending class require calling one of its parent class's initializers before any other code:
```isl
class PersonWithHeight extends Person
	height: decimal

	initialize(firstName: string, lastName: string, age: integer, height: decimal)
		base.initialize(firstName, lastName, age)

		self.height = height
```
_(Remember that when the initializer function is executed, fields can be written to multiple times, but not read)_
-->
<p>Extending class can override one or more members of its base class:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Person</span>
<span style="color: #5B5B5B">	firstName: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	lastName: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	age: </span><span style="color: #0057E6">integer</span>

<span style="color: #5B5B5B">	description </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">{</span><span style="color: #AA6631">firstName</span><span style="color: #B338FF">}</span><span style="color: #AA6631"> </span><span style="color: #B338FF">{</span><span style="color: #AA6631">lastName</span><span style="color: #B338FF">}</span><span style="color: #AA6631">, of </span><span style="color: #B338FF">{</span><span style="color: #AA6631">age</span><span style="color: #B338FF">}</span><span style="color: #AA6631"> years of age</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> printDescription</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">description</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">class</span><span style="color: #5B5B5B"> PersonWithHeight </span><span style="color: #0057E6">extends</span><span style="color: #5B5B5B"> Person</span>
<span style="color: #5B5B5B">	height: </span><span style="color: #0057E6">decimal</span>

<span style="color: #5B5B5B">	description </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">{</span><span style="color: #0057E6">base</span><span style="color: #AA6631">.description</span><span style="color: #B338FF">}</span><span style="color: #AA6631"> and </span><span style="color: #B338FF">{</span><span style="color: #AA6631">height</span><span style="color: #B338FF">}</span><span style="color: #AA6631"> meters tall</span><span style="color: #5B5B5B">"</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> james </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> PersonWithHeight</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">James</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Taylor</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">19</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">8</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">james.printDescription</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Prints "James Taylor, of 19 years of age and 1.8 meters tall"</span>
<span style="color: #B338FF">(</span><span style="color: #5B5B5B">james </span><span style="color: #0057E6">as</span><span style="color: #5B5B5B"> Person</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">.printDescription</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Prints "James Taylor, of 19 years of age"</span></code></pre>
<h2 id="abstract-classes"><a class="header-anchor" href="#abstract-classes">ยง</a>Abstract classes</h2>
<p>An <strong>abstract class</strong> is a class lacking a body for at least one of its methods. An abstract class cannot be used to create objects, but only to serve as a basis for another class:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">abstract</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Vehicle</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> startEngine</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> turnLeft</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> turnRight</span><span style="color: #B338FF">()</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> v </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Vehicle</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// This will not work</span>

<span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Car </span><span style="color: #0057E6">extends</span><span style="color: #5B5B5B"> Vehicle </span><span style="color: #A1A1A1">// This is possible</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> startEngine</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">		....</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> turnLeft</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">		....</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> turnRight</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">		....</span></code></pre>
<h2 id="fixed-fields-and-partially-constructed-objects"><a class="header-anchor" href="#fixed-fields-and-partially-constructed-objects">ยง</a>Fixed fields and partially constructed objects</h2>
<p>Consider this definition of the <code>Person</code> class :</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Person</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">enumeration</span><span style="color: #5B5B5B"> Gender </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> Male, Female</span>

<span style="color: #5B5B5B">	firstName: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	lastName: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	gender: Gender</span>
<span style="color: #5B5B5B">	age: </span><span style="color: #0057E6">integer</span>

<span style="color: #5B5B5B">	titleAndLastName </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">{</span><span style="color: #0057E6">when</span><span style="color: #AA6631"> gender </span><span style="color: #000000">==</span><span style="color: #AA6631"> Gender.Male: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Mr.</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">, </span><span style="color: #0057E6">otherwise</span><span style="color: #AA6631">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Ms.</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">}</span><span style="color: #AA6631"> </span><span style="color: #B338FF">{</span><span style="color: #AA6631">lastName</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span>

<span style="color: #5B5B5B">	fullName </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">{</span><span style="color: #AA6631">firstName</span><span style="color: #B338FF">}</span><span style="color: #AA6631"> </span><span style="color: #B338FF">{</span><span style="color: #AA6631">lastName</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span>

<span style="color: #5B5B5B">	fullNameAndAge </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">{</span><span style="color: #AA6631">fullName</span><span style="color: #B338FF">}</span><span style="color: #AA6631">, of </span><span style="color: #B338FF">{</span><span style="color: #AA6631">age</span><span style="color: #B338FF">}</span><span style="color: #AA6631"> years of age</span><span style="color: #5B5B5B">"</span></code></pre>
<p>Say we wanted to derive a class for a person who must be male and whose last name must be &quot;Smith&quot;. In the traditional object-oriented style this can be done by extending <code>Person</code> and fixing the <code>lastName</code> and <code>gender</code> fields to the constant values <code>&quot;Smith&quot;</code> and <code>Male</code>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> MrSmith </span><span style="color: #0057E6">extends</span><span style="color: #5B5B5B"> Person</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">final</span><span style="color: #5B5B5B"> lastName </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Smith</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">final</span><span style="color: #5B5B5B"> gender </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Gender.Male</span></code></pre>
<p>A major limitation of this approach is that it can only work with values that are known at compile-time. What if we wanted to &quot;partially apply&quot; the <code>Person</code> class with some arbitrary values for <code>lastName</code> and <code>gender</code> that are only known at run-time?</p>
<p>This can be done using the <code>with</code> operator:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> mrSmith </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Person </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> lastName </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Smith</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, gender </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Gender.Male</span></code></pre>
<p>Because some of <code>mrSmith</code>'s fields (namely <code>firstName</code> and <code>age</code>) are missing (and don't have default values), a full instance of <code>Person</code> could not be constructed. Instead, the resulting value - <code>mrSmith</code> is not an object of type <code>Person</code>, but of the type <code>partial Person with lastName, gender</code>.</p>
<p>Wouldn't it be nice if we could call some of the partially constructed object's methods? Unfortunately since these methods access the <code>this</code> object (either implicitly or explicitly), they don't provide any formal guarantees they wouldn't attempt to access uninitialized fields. In the special case the methods never pass the <code>this</code> object to an external method, the requirements of each method can be determined automatically:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Person</span>
<span style="color: #5B5B5B">	....</span>

<span style="color: #5B5B5B">	titleAndLastName </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">{</span><span style="color: #0057E6">when</span><span style="color: #AA6631"> gender </span><span style="color: #000000">==</span><span style="color: #AA6631"> Gender.Male: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Mr.</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">, </span><span style="color: #0057E6">otherwise</span><span style="color: #AA6631">: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Ms.</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">}</span><span style="color: #AA6631"> </span><span style="color: #B338FF">{</span><span style="color: #AA6631">lastName</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span>

<span style="color: #5B5B5B">	fullName </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">{</span><span style="color: #AA6631">firstName</span><span style="color: #B338FF">}</span><span style="color: #AA6631"> </span><span style="color: #B338FF">{</span><span style="color: #AA6631">lastName</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span>

<span style="color: #5B5B5B">	fullNameAndAge </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">{</span><span style="color: #AA6631">fullName</span><span style="color: #B338FF">}</span><span style="color: #AA6631">, of </span><span style="color: #B338FF">{</span><span style="color: #AA6631">age</span><span style="color: #B338FF">}</span><span style="color: #AA6631"> years of age</span><span style="color: #5B5B5B">"</span></code></pre>
<p>The computed field <code>titleAndLastName</code> can be called for <code>mrSmith</code>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #5B5B5B">print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">mrSmith.titleAndLastName</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints "Mr. Smith"</span></code></pre>
<p>However trying to reference <code>fullName</code> would result in a compilation error, since it requires <code>firstName</code> to be initialized:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #5B5B5B">print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">mrSmith.fullName</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error: `fullName` uses member `firstName`, which is not defined for type `partial Person with lastName, gender`</span></code></pre>
<p>In case a member passes the <code>this</code> object explicitly, the receiving function must annotate its parameter with a compatible <code>partial</code> type:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> giveMePartialPerson</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">p: </span><span style="color: #0057E6">partial</span><span style="color: #5B5B5B"> Person </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> gender, lastName</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	....</span>

<span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Person</span>
<span style="color: #5B5B5B">	....</span>

<span style="color: #5B5B5B">	somethingElse </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> giveMePartialPerson</span><span style="color: #B338FF">(</span><span style="color: #0057E6">this</span><span style="color: #B338FF">)</span></code></pre>
<p>We could continue adding more information to the object:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> mrJohnSmith </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> mrSmith </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> firstName </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">John</span><span style="color: #5B5B5B">"</span>

<span style="color: #5B5B5B">print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">mrJohnSmith.fullName</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints "John Smith"</span>
<span style="color: #5B5B5B">print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">mrJohnSmith.fullNameAndAge</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error! fullNameAndAge uses member `age`, which is not defined for type `partial Person with firstName, lastName, gender`</span></code></pre>
<p>Finally, when we add a value for <code>age</code>, the object becomes fully constructed:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> mrJohnSmith28 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> mrJohnSmith </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">28</span>
<span style="color: #A1A1A1">// mrJohnSmith28 finally receives the type `Person`</span>

<span style="color: #5B5B5B">print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">mrJohnSmith28.fullNameAndAge</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints "John Smith, of 28 years of age"</span></code></pre>
<p>An alternative, but more limited, way to achieve a similar effect is to partially apply the constructor call:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Point</span>
<span style="color: #5B5B5B">	x: </span><span style="color: #0057E6">decimal</span>
<span style="color: #5B5B5B">	y: </span><span style="color: #0057E6">decimal</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> pointWhereXEquals1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Point</span><span style="color: #B338FF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, ...</span><span style="color: #B338FF">)</span>
<span style="color: #A1A1A1">// The type of pointWhereXEquals1 is `partial Point with x`</span></code></pre>
<p>Here's a more realistic use case.</p>
<p>Say we had an object representing a database, and that has the fields <code>connection</code> and <code>name</code>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Database</span>
<span style="color: #5B5B5B">	connection: ServerConnection</span>
<span style="color: #5B5B5B">	name: </span><span style="color: #0057E6">string</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> query</span><span style="color: #B338FF">(</span><span style="color: #0057E6">this</span><span style="color: #5B5B5B">, sql: </span><span style="color: #0057E6">string</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		....</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> verifyConnection</span><span style="color: #B338FF">({</span><span style="color: #5B5B5B"> connection </span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">: </span><span style="color: #0057E6">this</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		connection.verify</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">....</span><span style="color: #B338FF">)</span></code></pre>
<p>For every new database object we wanted to create, we'd have to re-specify which server connection it uses:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> myConnection </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> connectServer</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">localhost:5555</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">admin</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">1234</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> db1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Database </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> connection </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> myConnection, name </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">DB1</span><span style="color: #5B5B5B">"</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> db2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Database </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> connection </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> myConnection, name </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">DB2</span><span style="color: #5B5B5B">"</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> db3 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Database </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> connection </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> myConnection, name </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">DB3</span><span style="color: #5B5B5B">"</span></code></pre>
<p>With a partially constructed object, the <code>connection</code> field can be fixed once and then the resulting object reused:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> myConnection </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> connectServer</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">localhost:5555</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">admin</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">1234</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> databaseWithMyConnection </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Database </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> connection </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> myConnection</span>
<span style="color: #A1A1A1">// The type of `databaseWithMyConnection` is `partial Database with connection`</span>

<span style="color: #5B5B5B">databaseWithMyConnection.verifyConnection</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Works!</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> db1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> databaseWithMyConnection </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> name </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">DB1</span><span style="color: #5B5B5B">"</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> db2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> databaseWithMyConnection </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> name </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">DB2</span><span style="color: #5B5B5B">"</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> db3 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> databaseWithMyConnection </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> name </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">DB3</span><span style="color: #5B5B5B">"</span></code></pre>
<p><em>Note:</em> in case some fields have default values but the desired behavior is to have those fields undefined on the partial object, their default values can be &quot;erased&quot; by explicitly applying the <code>no</code> modifier during the <code>with</code> application:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Person</span>
<span style="color: #5B5B5B">	firstName: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	lastName: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	planetResidence </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Earth</span><span style="color: #5B5B5B">"</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> angelaFromUnknownPlanet </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Person </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> firstName </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Angela</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">no</span><span style="color: #5B5B5B"> planetResidence</span></code></pre>
<h2 id="type-objects"><a class="header-anchor" href="#type-objects">ยง</a>Type objects</h2>
<p><strong>Type objects</strong> (which may also be described as dedicated <strong>static member structures</strong>) are special objects that may share the same name as a class (or act as singleton objects). They are used to provide data and functionality that are not associated with a particular instance of the class:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Vector2</span>
<span style="color: #5B5B5B">	x: </span><span style="color: #0057E6">decimal</span>
<span style="color: #5B5B5B">	y: </span><span style="color: #0057E6">decimal</span>

<span style="color: #0057E6">object</span><span style="color: #5B5B5B"> Vector2</span>
<span style="color: #5B5B5B">	zero </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Vector2</span><span style="color: #B338FF">(</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">0</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> distance</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: Vector2, b: Vector2</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span>
<span style="color: #5B5B5B">		sqrt</span><span style="color: #B338FF">((</span><span style="color: #5B5B5B">a.x </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> b.x</span><span style="color: #B338FF">)</span><span style="color: #000000">**</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B"> </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a.y </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> b.y</span><span style="color: #B338FF">)</span><span style="color: #000000">**</span><span style="color: #E65C00">2</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> z </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Vector2.zero </span><span style="color: #A1A1A1">// z = (0, 0)</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> d </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Vector2.distance</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Vector2</span><span style="color: #B338FF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">, Vector2</span><span style="color: #B338FF">(</span><span style="color: #000000">-</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">9</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// d = 8.485</span></code></pre>
<p><strong>Operators</strong> are functions using symbols as a calling mechanism. Operators can only defined on type objects:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Point</span>
<span style="color: #5B5B5B">	x: </span><span style="color: #0057E6">decimal</span>
<span style="color: #5B5B5B">	y: </span><span style="color: #0057E6">decimal</span>

<span style="color: #0057E6">object</span><span style="color: #5B5B5B"> Point</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">operator</span><span style="color: #5B5B5B"> </span><span style="color: #000000">+</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: Point, b: Point</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> Point</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a.x </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> b.x, a.y </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> b.y</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">operator</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: Point, b: Point</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> Point</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a.x </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> b.x, a.y </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> b.y</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">operator</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: Point</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> Point</span><span style="color: #B338FF">(</span><span style="color: #000000">-</span><span style="color: #5B5B5B">a.x, </span><span style="color: #000000">-</span><span style="color: #5B5B5B">b.y</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> sumOfPoints </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Point</span><span style="color: #B338FF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> Point</span><span style="color: #B338FF">(</span><span style="color: #000000">-</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">5</span><span style="color: #B338FF">)</span>
<span style="color: #A1A1A1">// sumOfPoints equals Point(-1, 9)</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> differenceOfPoints </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Point</span><span style="color: #B338FF">(</span><span style="color: #E65C00">7</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> Point</span><span style="color: #B338FF">(</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #B338FF">)</span>
<span style="color: #A1A1A1">// differenceOfPoints equals Point(5, 1)</span></code></pre>
<h2 id="traits"><a class="header-anchor" href="#traits">ยง</a>Traits</h2>
<p>A <strong>trait</strong> is an abstract class-like type specifying a set of required members. Classes may implement any number of traits. A trait may optionally provide <strong>default implementations</strong> or values for its members:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">trait</span><span style="color: #5B5B5B"> Labeled</span>
<span style="color: #5B5B5B">	label: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> printLabel</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">label</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Employee </span><span style="color: #0057E6">extends</span><span style="color: #5B5B5B"> Labeled</span>
<span style="color: #5B5B5B">	fullName: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	label: </span><span style="color: #0057E6">string</span>

<span style="color: #0057E6">action</span><span style="color: #5B5B5B"> processLabeledObject</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">obj: Labeled</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	obj.printLabel</span><span style="color: #B338FF">()</span>

<span style="color: #5B5B5B">processLabeledObject</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Employee</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">John Doe</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">abc123</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints "abc123"</span></code></pre>
<p>Default implementations will be overridden if they are implemented in the concrete type:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Employee </span><span style="color: #0057E6">extends</span><span style="color: #5B5B5B"> Labeled</span>
<span style="color: #5B5B5B">	fullName: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	label: </span><span style="color: #0057E6">string</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> printLabel</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Employee: </span><span style="color: #B338FF">{</span><span style="color: #AA6631">label</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">processLabeledObject</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Employee</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">John Doe</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">abc123</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints "Employee: abc123"</span></code></pre>
<p>When trying to provide different implementations for two or more different trait members with identical signatures, the method declaration can explicitly specify which trait it relates to:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">trait</span><span style="color: #5B5B5B"> Runner</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> start</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">speed: </span><span style="color: #0057E6">decimal</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">trait</span><span style="color: #5B5B5B"> Processor</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> start</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">speed: </span><span style="color: #0057E6">decimal</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Employee </span><span style="color: #0057E6">extends</span><span style="color: #5B5B5B"> Runner, Processor</span>
<span style="color: #5B5B5B">	fullName: </span><span style="color: #0057E6">string</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> Runner.start</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">speed: </span><span style="color: #0057E6">decimal</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		....</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> Processor.start</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">speed: </span><span style="color: #0057E6">decimal</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		....</span></code></pre>
<p>Traits can extend any number of other traits:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">trait</span><span style="color: #5B5B5B"> Named</span>
<span style="color: #5B5B5B">	name: </span><span style="color: #0057E6">string</span>

<span style="color: #0057E6">trait</span><span style="color: #5B5B5B"> Printable</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> print</span><span style="color: #B338FF">()</span>

<span style="color: #0057E6">trait</span><span style="color: #5B5B5B"> NamedAndPrintable </span><span style="color: #0057E6">extends</span><span style="color: #5B5B5B"> Named, Printable</span></code></pre>
<h2 id="expansion"><a class="header-anchor" href="#expansion">ยง</a>Expansion</h2>
<p><strong>Expansion</strong> introduces new members to an existing class, trait or type object, and can be performed any number of times:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Person</span>
<span style="color: #5B5B5B">	firstName: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	lastName: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	age: </span><span style="color: #0057E6">integer</span>

<span style="color: #0057E6">class</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">expansion</span><span style="color: #5B5B5B"> Person</span>
<span style="color: #5B5B5B">	fullname </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">{</span><span style="color: #AA6631">firstName</span><span style="color: #B338FF">}</span><span style="color: #AA6631"> </span><span style="color: #B338FF">{</span><span style="color: #AA6631">lastName</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span>

<span style="color: #0057E6">object</span><span style="color: #5B5B5B"> Person</span>
<span style="color: #5B5B5B">	anonymous </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Person</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Anonymous</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">""</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">0</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	haveSameFirstName</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">p1: Person, p2: Person</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> p1.firstName </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> p2.firstName</span>

<span style="color: #0057E6">object</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">expansion</span><span style="color: #5B5B5B"> Person</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">operator</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: Person, b: Person</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span>
<span style="color: #5B5B5B">		</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a.firstName, a.lastName, a.age</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">b.firstName, b.lastName, b.age</span><span style="color: #B338FF">)</span></code></pre>
<p>Expansion can add any member kind apart from instance fields (though it can add type object fields):</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Person</span>
<span style="color: #5B5B5B">	firstName: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	lastName: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	age: </span><span style="color: #0057E6">integer</span>

<span style="color: #0057E6">class</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">expansion</span><span style="color: #5B5B5B"> Person</span>
<span style="color: #5B5B5B">	favoriteNumber: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// ERROR: This will not work</span>

<span style="color: #0057E6">object</span><span style="color: #5B5B5B"> Person</span>
<span style="color: #5B5B5B">	andy </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Person</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Andy</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Jones</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">22</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">object</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">expansion</span><span style="color: #5B5B5B"> Person</span>
<span style="color: #5B5B5B">	angela </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Person</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Anegla</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Jones</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">25</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// But this will work</span>

<span style="color: #0057E6">object</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">expansion</span><span style="color: #5B5B5B"> Person</span>
<span style="color: #5B5B5B">	ben </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Person</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Ben</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Smith</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">23</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// And so will this</span></code></pre>
<p>Expansions can <strong>implement traits</strong>, as well as override their default implementations:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Employee</span>
<span style="color: #5B5B5B">	fullName: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	label: </span><span style="color: #0057E6">string</span>

<span style="color: #0057E6">trait</span><span style="color: #5B5B5B"> Labeled</span>
<span style="color: #5B5B5B">	label: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> printLabel</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">label</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">class</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">expansion</span><span style="color: #5B5B5B"> Employee </span><span style="color: #0057E6">extends</span><span style="color: #5B5B5B"> Labeled</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> printLabel</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Great Employee: </span><span style="color: #B338FF">{</span><span style="color: #AA6631">label</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span></code></pre>
<p>Expansions can <strong>add members to traits</strong>, as long as they provide default values or implementations:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">trait</span><span style="color: #5B5B5B"> Labeled</span>
<span style="color: #5B5B5B">	label: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> printLabel</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">label</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">trait</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">expansion</span><span style="color: #5B5B5B"> Labeled</span>
<span style="color: #5B5B5B">	reversedLabel </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> label.reversed</span></code></pre>
<p>Expansions are designed such that they never change the behavior of code outside of their own scope. This is ensured by several <strong>precedence rules</strong>.</p>
<p>For class or type object members added through an expansion:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: undefined">overriden members &gt; trait default implementations &gt; expansion members
</span></code></pre>
<p>For trait members added through an expansion:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: undefined">any trait members with same name and signature (including in traits other than the expanded one) &gt; trait expansion members
</span></code></pre>
<p>This means that if <code>X</code> and <code>Y</code> are traits, and <code>Z</code> extends both <code>X</code> and <code>Y</code>, and <code>X</code> is expanded with a method that also exists in <code>Y</code>, <code>X</code>'s expansion will be shadowed by <code>Y</code>'s implementation:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">trait</span><span style="color: #5B5B5B"> X</span>
<span style="color: #5B5B5B">	someField: </span><span style="color: #0057E6">string</span>

<span style="color: #0057E6">trait</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">expansion</span><span style="color: #5B5B5B"> X</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> someFunction</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">X!</span><span style="color: #5B5B5B">"</span>

<span style="color: #0057E6">trait</span><span style="color: #5B5B5B"> Y</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> someFunction</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Y!</span><span style="color: #5B5B5B">"</span>

<span style="color: #0057E6">trait</span><span style="color: #5B5B5B"> Z </span><span style="color: #0057E6">extends</span><span style="color: #5B5B5B"> X, Y</span>

<span style="color: #0057E6">function</span><span style="color: #5B5B5B"> test</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">z: Z</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> z.someFunction</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// There is no conflict here, this is will always return "Y!"</span></code></pre>
<h2 id="generics"><a class="header-anchor" href="#generics">ยง</a>Generics</h2>
<p><strong>Generic typing</strong> (also known as <strong>parametric polymorphism</strong>) allows types and methods to refer to unknown, or partially known, types, which can vary and are determined individually at each class instantiation or method call.</p>
<p>A <strong>type parameter</strong> is introduced using the <code>&lt;T&gt;</code> notation:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Pair</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T</span><span style="color: #000000">&gt;</span>
<span style="color: #5B5B5B">	a: T</span>
<span style="color: #5B5B5B">	b: T</span></code></pre>
<p>The unknown type parameter (named <code>T</code> in this example) can accept any type:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> pairOfIntegers </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Pair</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #B338FF">)</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> pairOfstrings </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Pair</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">string</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">a</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">b</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> pairOfBooleans </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Pair</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">boolean</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">(</span><span style="color: #0057E6">true</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">false</span><span style="color: #B338FF">)</span></code></pre>
<p>Including the <code>Pair</code> type itself:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> pairOfPairs </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Pair</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">Pair</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">string</span><span style="color: #000000">&gt;&gt;</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Pair</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">string</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">a</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">b</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">, Pair</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">string</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">c</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">,</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">d</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">))</span></code></pre>
<p>The type argument e.g. <code>&lt;integer&gt;</code> is not required if it <strong>can be inferred</strong> from the constructor arguments, this simplifies the above to:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> pairOfIntegers </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Pair</span><span style="color: #B338FF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #B338FF">)</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> pairOfstrings </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Pair</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">a</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">b</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> pairOfBooleans </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Pair</span><span style="color: #B338FF">(</span><span style="color: #0057E6">true</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">false</span><span style="color: #B338FF">)</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> pairOfPairs </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Pair</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Pair</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">a</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">b</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">, Pair</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">c</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">,</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">d</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">))</span></code></pre>
<p><em>(Note: Unlike C#, Java, TypeScript, and several other languages, the Island language does not allow both generic and non-generic types sharing a common identifier. This enables to safely omit the type argument with no chance of ambiguity)</em></p>
<p>Methods can accept and infer type arguments as well:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> firstOfPair</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">A</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">p: Pair</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">A</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> p.a</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> firstInteger </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> firstOfPair</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Pair</span><span style="color: #B338FF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// returns 1</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> firststring </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> firstOfPair</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Pair</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">a</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">b</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// returns a</span></code></pre>
<p>Type parameters can have <strong>constraints</strong>, which enforce a minimum assignability requirement:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">trait</span><span style="color: #5B5B5B"> Named</span>
<span style="color: #5B5B5B">	name: </span><span style="color: #0057E6">string</span>

<span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Person </span><span style="color: #0057E6">extends</span><span style="color: #5B5B5B"> Named</span>
<span style="color: #5B5B5B">	name: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	age: </span><span style="color: #0057E6">integer</span>

<span style="color: #0057E6">function</span><span style="color: #5B5B5B"> loveAffair</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T </span><span style="color: #0057E6">extends</span><span style="color: #5B5B5B"> Named</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: T, b: T</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span>
<span style="color: #5B5B5B">	</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">{</span><span style="color: #AA6631">a.name</span><span style="color: #B338FF">}</span><span style="color: #AA6631"> loves </span><span style="color: #B338FF">{</span><span style="color: #AA6631">b.name</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> l </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> loveAffair</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Person</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Angela</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">21</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">, Person</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Mike</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">20</span><span style="color: #B338FF">))</span>
<span style="color: #A1A1A1">// l = "Angela loves Mike"</span></code></pre>
<p>Note that applying a type as a constraint is subtly different than specifying the type directly, especially in the case where the type parameter is used in multiple places:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Fruit </span><span style="color: #0057E6">extends</span><span style="color: #5B5B5B"> Named</span>
<span style="color: #5B5B5B">	name: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	weight: </span><span style="color: #0057E6">decimal</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> l </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> loveAffair</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Person</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Angela</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">21</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">, Fruit</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Apple</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">5</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error! could not find a binding for type parameter T.</span></code></pre>
<p>Even though both the types <code>Person</code> and <code>Fruit</code> satisfy the <code>Named</code> trait, the <code>T</code> type parameter can only be instantiated by a single type, therefore a compilation error is emitted.</p>
<p>Alternatively, if the <code>Named</code> trait was used directly as <code>a</code> and <code>b</code>'s parameter types, the code would compile successfully:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> loveAffair2</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: Named, b: Named</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span>
<span style="color: #5B5B5B">	</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">{</span><span style="color: #AA6631">a.name</span><span style="color: #B338FF">}</span><span style="color: #AA6631"> loves </span><span style="color: #B338FF">{</span><span style="color: #AA6631">b.name</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> l </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> loveAffair2</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Person</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Angela</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">21</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">, Fruit</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Apple</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">5</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Works!</span>
<span style="color: #A1A1A1">// l = "Angela loves Apple"</span></code></pre>
<p><strong>Multiple constraints</strong> may be applied to a type parameter:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">trait</span><span style="color: #5B5B5B"> Printable</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> printMe</span><span style="color: #B338FF">()</span>

<span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Fruit </span><span style="color: #0057E6">extends</span><span style="color: #5B5B5B"> Named, Printable</span>
<span style="color: #5B5B5B">	name: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	weight: </span><span style="color: #0057E6">decimal</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> printMe</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">A </span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">{</span><span style="color: #AA6631">a.name</span><span style="color: #B338FF">}</span><span style="color: #AA6631"> weighing </span><span style="color: #B338FF">{</span><span style="color: #AA6631">weight</span><span style="color: #B338FF">}</span><span style="color: #AA6631">kg</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">action</span><span style="color: #5B5B5B"> printNamedThing</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T </span><span style="color: #0057E6">extends</span><span style="color: #5B5B5B"> Named </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> Printable</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: T</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> a.printMe</span><span style="color: #B338FF">()</span>

<span style="color: #5B5B5B">printNamedThing</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Fruit</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Banana</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">5</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints "A Banana weighing 0.5kg"</span></code></pre>
<p>Type parameters can have <strong>default values</strong>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> MakePair</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">v1: T, v2: T</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">T, T</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	....</span></code></pre>
<p>Island supports <strong>implicit type parameters</strong>, meaning that generic types referenced without the introduction of type parameters will accept any type argument, given it satisfies their constraint set:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> firstsOfPairs</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">p1: Pair, p2: Pair</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">p1.a, p2.a</span><span style="color: #B338FF">)</span></code></pre>
<p>which would be roughly equivalent to:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> firstsOfPairs</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">p1: Pair</span><span style="color: #000000">&lt;*&gt;</span><span style="color: #5B5B5B">, p2: Pair</span><span style="color: #000000">&lt;*&gt;</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">p1.a, p2.a</span><span style="color: #B338FF">)</span>
<span style="color: #A1A1A1">// ('&lt;*&gt;' is pseudo-syntax, it has no real meaning)</span></code></pre>
<p><code>p1</code> and <code>p2</code> can accept any instances of <code>Pair</code>, including ones with incompatible types:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> r </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> firstsOfPairs</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Pair</span><span style="color: #B338FF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">, Pair</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">a</span><span style="color: #5B5B5B">'</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">b</span><span style="color: #5B5B5B">'</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// r = (1, 'a')</span></code></pre>
<p>This is not always desirable. In case <code>p1</code> and <code>p2</code> are expected to have compatible instantiations of <code>Pair</code>, a type parameter must be introduced:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> firstsOfPairs</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">p1: Pair</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">, p2: Pair</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">p1.a, p2.a</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> r </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> firstsOfPairs</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Pair</span><span style="color: #B338FF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">, Pair</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">a</span><span style="color: #5B5B5B">'</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">b</span><span style="color: #5B5B5B">'</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error: p1 and p2 must have compatible types!</span></code></pre>
<h2 id="type-traits"><a class="header-anchor" href="#type-traits">ยง</a>Type traits</h2>
<p>A <strong>type trait</strong> (also known as a <strong>type class</strong> in other languages) is a trait consisting only of type object members and operators and which consequently abstracts over different <strong>types</strong> (rather than instances of types). For example, a trait abstracting over all types supporting the <code>==</code> operator would be defined as:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">type</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">trait</span><span style="color: #5B5B5B"> Equatable</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T</span><span style="color: #000000">&gt;</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">operator</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x: T, y: T</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0057E6">boolean</span></code></pre>
<p>In the following example, both <code>Point</code> and <code>Person</code> implement the <code>Equatable</code> trait:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Point</span>
<span style="color: #5B5B5B">	x: </span><span style="color: #0057E6">decimal</span>
<span style="color: #5B5B5B">	y: </span><span style="color: #0057E6">decimal</span>

<span style="color: #0057E6">object</span><span style="color: #5B5B5B"> Point </span><span style="color: #0057E6">extends</span><span style="color: #5B5B5B"> Equatable</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">Point</span><span style="color: #000000">&gt;</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">operator</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: Point, b: Point</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span>
<span style="color: #5B5B5B">		</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a.x, a.y</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">b.x, b.y</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Person</span>
<span style="color: #5B5B5B">	fullName: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	age: </span><span style="color: #0057E6">integer</span>

<span style="color: #0057E6">object</span><span style="color: #5B5B5B"> Person </span><span style="color: #0057E6">extends</span><span style="color: #5B5B5B"> Equatable</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">Person</span><span style="color: #000000">&gt;</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">operator</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: Person, b: Person</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span>
<span style="color: #5B5B5B">		</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a.fullName, a.age</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">b.fullName, b.age</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">function</span><span style="color: #5B5B5B"> areEqual</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T </span><span style="color: #0057E6">extends</span><span style="color: #5B5B5B"> Equatable</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T</span><span style="color: #000000">&gt;&gt;</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: T, b: T</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> a </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> b</span>

<span style="color: #5B5B5B">print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">areEqual</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Point</span><span style="color: #B338FF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">, Point</span><span style="color: #B338FF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #B338FF">)))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints "true"</span>
<span style="color: #5B5B5B">print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">areEqual</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Person</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">John Doe</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">24</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">, Person</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">John Doe</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">24</span><span style="color: #B338FF">)))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints "true"</span>
<span style="color: #5B5B5B">print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">areEqual</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Point</span><span style="color: #B338FF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">, Person</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">John Doe</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">24</span><span style="color: #B338FF">)))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error: couldn't find a type for T</span></code></pre>
<p>Here's a monoid type trait (representing an associative binary operation with identity element):</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">type</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">trait</span><span style="color: #5B5B5B"> Monoid</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">operator</span><span style="color: #5B5B5B"> </span><span style="color: #000000">+</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #0057E6">this</span><span style="color: #5B5B5B">, y: </span><span style="color: #0057E6">this</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0057E6">this</span>
<span style="color: #5B5B5B">	identity: </span><span style="color: #0057E6">this</span></code></pre>
<p><em>(Note the <code>this</code> type would contextually refer to the concrete type of the object implementing the trait, not to the <code>Monoid</code> abstraction)</em></p>
<p>Multiple type traits used as constraints:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> propertyOf3Sums</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T </span><span style="color: #0057E6">extends</span><span style="color: #5B5B5B"> Monoid </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> Equatable</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: T, b: T, c: T</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0057E6">boolean</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span>
<span style="color: #5B5B5B">	</span><span style="color: #B338FF">((</span><span style="color: #5B5B5B">a </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> b</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> T.identity</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">((</span><span style="color: #5B5B5B">b </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> c</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">!=</span><span style="color: #5B5B5B"> T.identity</span><span style="color: #B338FF">)</span></code></pre>
<p>Using a type alias and a join type we can define a trait that <strong>combines both instance and type members</strong>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">trait</span><span style="color: #5B5B5B"> Person</span>
<span style="color: #5B5B5B">	firstName: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	lastName: </span><span style="color: #0057E6">string</span>

<span style="color: #0057E6">type</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">trait</span><span style="color: #5B5B5B"> Equatable</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">operator</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #0057E6">this</span><span style="color: #5B5B5B">, y: </span><span style="color: #0057E6">this</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0057E6">boolean</span>

<span style="color: #0057E6">type</span><span style="color: #5B5B5B"> EquatablePerson </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Equatable </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> Person</span></code></pre>
<h2 id="polymorphic-subtyping-rules-(covariance-and-contravariance)"><a class="header-anchor" href="#polymorphic-subtyping-rules-(covariance-and-contravariance)">ยง</a>Polymorphic subtyping rules (covariance and contravariance)</h2>
<p>When assigning a value to a plain variable of a given type, the value would be assignable to it only if the target type is identical to, or more general than the type of the value:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> a1: Animal </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Animal</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Works: identical types</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> a2: Animal </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">34</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Doesn't work: unrelated types</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> a3: Animal </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Cat</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Works: target type is more general than assigned value type</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> a4: Cat </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Animal</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Doesn't work: target type is more specific than assigned value type</span></code></pre>
<p>It may seem, at first, like this is the only manner in which types can relate to each other: after all, it doesn't make sense that an any <code>Animal</code> type would substitute a <code>Cat</code> type. However, there are cases where this is exactly what happens!</p>
<p>Here are two function types, one accepting an <code>Animal</code> parameter type, the other a <code>Cat</code> parameter type:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">type</span><span style="color: #5B5B5B"> GiveMeAnimal </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Animal</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">string</span>
<span style="color: #0057E6">type</span><span style="color: #5B5B5B"> GiveMeCat </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Cat</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">string</span></code></pre>
<p>Now ponder this carefully: do you think that <code>GiveMeCat</code> should assign to <code>GiveMeAnimal</code>? <code>GiveMeAnimal</code> should assign to <code>GiveMeCat</code>? or maybe both should assign to each other? or neither one to any?</p>
<p>Let's go through it again:</p>
<ul>
<li>The type <code>GiveMeCat</code> describes a function that accepts a <code>Cat</code> object, and returns a string.</li>
<li>The type <code>GiveMeAnimal</code> describes a function that accepts an <code>Animal</code> object, and returns a string.</li>
</ul>
<p><code>GiveMeAnimal</code> is more permissive, it will accept any animal, however <code>GiveMeCat</code> is more strict, and will only accept a cat.</p>
<p>If you attempted to assign a function of type <code>GiveMeCat</code> to a variable of type <code>GiveMeAnimal</code> you'd take a strict function and put in a placeholder designated for a more permissive function:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> giveMeAnimal: </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Animal</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">string</span>

<span style="color: #5B5B5B">giveMeAnimal </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Cat</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hello cat!</span><span style="color: #5B5B5B">"</span>

<span style="color: #A1A1A1">// Because 'giveMeAnimal' accepts any animal, passing a dog as argument should work,</span>
<span style="color: #A1A1A1">// but would it make any sense?</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> str </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> giveMeAnimal</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Dog</span><span style="color: #B338FF">())</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Would return "Hello cat!" ??!!</span></code></pre>
<p>However, if you assigned <code>GiveMeAnimal</code> to <code>GiveMeCat</code>, it would, surprisingly, make more sense:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> giveMeCat: </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Cat</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">string</span>

<span style="color: #5B5B5B">giveMeCat </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Animal</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hello animal!</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Seems to work, but why?</span></code></pre>
<p>This phenomenon is called <strong>contravariance</strong> (substitution of general with specific) and the more &quot;intuitive&quot; substitution rule, mentioned in the context of plain variables, is called <strong>covariance</strong> (substitution of specific with general).</p>
<p>It turns out that when thinking about functions: return types (&quot;out&quot; positions) are covariant, however, parameter types (&quot;in&quot; positions) are contravariant.</p>
<p>Sometimes we may wish to constrain type parameters so that they can only be used in one of these positions. This is possible with the <code>in</code> and <code>out</code> modifiers:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> LookupTable</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> K, </span><span style="color: #0057E6">out</span><span style="color: #5B5B5B"> V</span><span style="color: #000000">&gt;</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> getValue</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">key: K</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: V</span></code></pre>
<h1 id="concurrency%2C-parallelism-and-lazy-evaluation"><a class="header-anchor" href="#concurrency%2C-parallelism-and-lazy-evaluation">ยง</a>Concurrency, parallelism and lazy evaluation</h1>
<h2 id="computed-variables-and-values"><a class="header-anchor" href="#computed-variables-and-values">ยง</a>Computed variables and values</h2>
<p>Remember computed fields in a class?</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Person</span>
<span style="color: #5B5B5B">	firstName: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	lastName: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	fullName </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">{</span><span style="color: #AA6631">firstName</span><span style="color: #B338FF">}</span><span style="color: #AA6631"> </span><span style="color: #B338FF">{</span><span style="color: #AA6631">lastName</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span></code></pre>
<p><code>fullName</code> is only evaluated when it is called (and possibly the result is then stored for subsequent calls).</p>
<p>Using a computed variable, we could make a local variable that behaves in a similar way:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> z </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> y </span><span style="color: #A1A1A1">// The type of z is a plain integer</span>

<span style="color: #5B5B5B">print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">z</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints 3</span></code></pre>
<p><code>z</code> is a variable bound to a value of type <code>integer</code>, but its value would only be calculated when it is first used.</p>
<p>With this approach, however, <code>z</code> will lose its <code>computed</code> characteristic when it is passed to a method:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> makePair</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">value1, value2</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">value1, value2</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> z </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> y</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> w </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> makePair</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">z, </span><span style="color: #E65C00">5</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// z will be evaluated before makePair is called</span>
<span style="color: #A1A1A1">// w is equal to (3, 5)</span></code></pre>
<p>A second approach would be define the value itself (not the variable) as computed:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> makePair</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">value1: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, value2: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">value1, value2</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> z </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">compute</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> y</span>
<span style="color: #A1A1A1">// `z` still has the plain type `integer`</span>
<span style="color: #A1A1A1">// The 'computed' characteristic is only tracked internally, in the runtime</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> w </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> makePair</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">z, </span><span style="color: #E65C00">5</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// z will not be evaluated here</span>
<span style="color: #A1A1A1">// w has the value (compute 1 + 2, 5)</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> v </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> w[</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">] </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// `compute 1 + 2` is finally evaluated to 3 and v gets the value 4</span></code></pre>
<p>This behavior is called <strong>lazy evaluation</strong>. We can postpone the evaluation of <code>compute 1 + 2</code> only to the point where it is actually needed. It can be passed to methods or stored in variables and objects, but will only be evaluated when it is a part of a complex expression that is immediately (eagerly) evaluated.</p>
<p>Computed values can be <strong>composed</strong> together:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> z </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">compute</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> y</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> s </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">compute</span><span style="color: #5B5B5B"> sqrt</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">z</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// z is not evaluated but composed with the computation `sqrt(....)`</span>
<span style="color: #A1A1A1">// s now equals `compute sqrt(1 + 2)`</span></code></pre>
<p>Note that just like computed fields, computed variables and values cannot have side-effects therefore cannot include calls to actions or action streams.</p>
<h2 id="concurrent-and-parallel-execution-with-the-spawn-keyword"><a class="header-anchor" href="#concurrent-and-parallel-execution-with-the-spawn-keyword">ยง</a>Concurrent and parallel execution with the <code>spawn</code> keyword</h2>
<p>When then <code>spawn</code> keyword is added to a method call, the method is immediately executed in a separate thread. When the returned value of the spawned method is first read, execution may block if the method had not yet completed:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> heavyCalculation</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// ....</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> result</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">spawn</span><span style="color: #5B5B5B"> heavyCalculation</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// The function heavyCalculations() starts on a seperate thread</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> somethingUnrelated</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">....</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// This will execute even if heavyCalculations() has not completed</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> z </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> y; </span><span style="color: #A1A1A1">// This may block until heavyCalculations() returns and x receives a value</span></code></pre>
<p><strong>Multiple methods</strong> may be spawned at the same time:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">r1, r2</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">spawn</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">heavyCalculation1</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B">, heavyCalculation2</span><span style="color: #B338FF">())</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> a </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> r1 </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">; </span><span style="color: #A1A1A1">// Will block until r1 received a value and exeute even if r2 hasn't yet</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> b </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> r2 </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">; </span><span style="color: #A1A1A1">// Blocks until r2 receives a value</span></code></pre>
<p>The <code>wait</code> statement can be used to explicitly wait for a particular value to become available:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">r1, r2</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">spawn</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">heavyCalculation1</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B">, heavyCalculation2</span><span style="color: #B338FF">())</span>
<span style="color: #0057E6">wait</span><span style="color: #5B5B5B"> r2</span></code></pre>
<p>For convenience, the <code>wait</code> keyword can also be used as a modifier. The following is equivalent:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">r1, </span><span style="color: #0057E6">wait</span><span style="color: #5B5B5B"> r2</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">spawn</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">heavyCalculation1</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B">, heavyCalculation2</span><span style="color: #B338FF">())</span></code></pre>
<p><em>Note: applying <code>wait</code> to all result variables, e.g. <code>let (wait r1, wait r2)</code> or <code>let wait r</code>, is not permitted, since that would imply no concurrency and most likely would be better replaced with a simple synchronous call.</em></p>
<p>As demonstrated, applying <code>spawn</code> to a simple function call, it is possible to compute an <strong>individual value</strong> in the background. Using streams, it is also possible to instead compute a <strong>sequence of values</strong> in background.</p>
<p>This will evaluate a stream method in a background thread and save the yielded values to disk as soon as they arrive:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> heavyCalculations</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> ....</span>
<span style="color: #5B5B5B">		....</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> result</span>

<span style="color: #0057E6">for</span><span style="color: #5B5B5B"> result </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">spawn</span><span style="color: #5B5B5B"> heavyCalculations</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">	somethingUnrelated</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">....</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// This will execute even if 'result' has not yet received a value</span>
<span style="color: #5B5B5B">	writeToDisk</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">result</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// This will block until 'result' receives a value</span></code></pre>
<p>Analogously to the single-value approach, we can spawn multiple streams and iterate both of them at the same time:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">result1, result2</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">spawn</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">heavyCalculations1</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B">, heavyCalculations2</span><span style="color: #B338FF">())</span>
<span style="color: #5B5B5B">	writeToDisk</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">result1</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// This will block until result1 receives a value, and will execute even if result2 didn't</span>
<span style="color: #5B5B5B">	writeToDisk</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">result2</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// This will block until result2 receives a value</span></code></pre>
<p>Sometimes the lazy behavior isn't desirable, and it is preferred to wait until one or all of the streams produce a value before the body of the loop is entered. The <code>wait</code> keyword will cause execution to block until the reference variable(s) receive a value.</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">result1, result2</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">spawn</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">heavyCalculations1</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B">, heavyCalculations2</span><span style="color: #B338FF">())</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">wait</span><span style="color: #5B5B5B"> result1, result2</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Congratulations, we have new results!</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// This will only execute when both result1 and result receive a value</span>
<span style="color: #5B5B5B">	....</span></code></pre>
<p>For convenience, the <code>wait</code> keyword can also be integrated as a modifier to the loop variable:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">wait</span><span style="color: #5B5B5B"> result1, </span><span style="color: #0057E6">wait</span><span style="color: #5B5B5B"> result2</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">spawn</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">heavyCalculations1</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B">, heavyCalculations2</span><span style="color: #B338FF">())</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Congratulations, we have new results!</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// This will only execute when both result1 and result receive a value</span>
<span style="color: #5B5B5B">	....</span></code></pre>
<p>Sometimes we want to allow for results to evaluate as soon as any one of several computations yields a value. By adding the <code>any</code> modifier to the variable, a single result is received whenever any one of the streams yields a value.</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #A1A1A1">// Note both streams should have compatible return types,</span>
<span style="color: #A1A1A1">// otherwise 'result' will receive a choice type (introduced at later chapter)</span>
<span style="color: #0057E6">for</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">wait</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">any</span><span style="color: #5B5B5B"> result </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">spawn</span><span style="color: #5B5B5B"> [heavyCalculations1</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B">, heavyCalculations2</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B">]</span>
<span style="color: #5B5B5B">	writeToDisk</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">result</span><span style="color: #B338FF">)</span></code></pre>
<p>A similar approach can be used to simultaneously listen to multiple event sources:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #A1A1A1">// Note that modifying 'event' with the `match` keyword here would automatically wait until a result arrives.</span>
<span style="color: #A1A1A1">// No need to specify `wait match`:</span>
<span style="color: #0057E6">for</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">any</span><span style="color: #5B5B5B"> event </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">spawn</span><span style="color: #5B5B5B"> [keyboardEvents</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B">, mouseEvents</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B">]</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> KeyboardEvent</span>
<span style="color: #5B5B5B">		print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Keyboard event!</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> MouseEvent</span>
<span style="color: #5B5B5B">		print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Mouse event!</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span></code></pre>
<p>In a real-world application, however, it is more likely that event sources would require being dynamically subscribed and unsubscribed from throughout the program runtime. This can be achieved by applying <code>spawn</code> to a collection (in this example a dictionary) and altering the collection in progressive iterations of the loop:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> eventSources </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">{</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">kEvents</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">: keyboardEvents</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">any</span><span style="color: #5B5B5B"> event </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">spawn</span><span style="color: #5B5B5B"> eventSources</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> KeyboardEvent</span>
<span style="color: #5B5B5B">		print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Keyboard event!</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Now listening to mouse events instead!</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">continue</span><span style="color: #5B5B5B"> eventSources </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> eventSources </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">no</span><span style="color: #5B5B5B"> [</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">kEvents</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">], [</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">mEvents</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">] </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> mouseEvents</span><span style="color: #B338FF">()</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> MouseEvent</span>
<span style="color: #5B5B5B">		print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Mouse event!</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span></code></pre>
<p>The <code>spawn</code> keyword can also be used in stream and list comprehensions.</p>
<p>This will define a stream method that computes an unbounded series of primes in the background:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> backgroundPrimes </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> p </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">spawn</span><span style="color: #5B5B5B"> calculatePrimes</span><span style="color: #B338FF">())</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> p</span></code></pre>
<h1 id="contracts"><a class="header-anchor" href="#contracts">ยง</a>Contracts</h1>
<h2 id="contracts-2"><a class="header-anchor" href="#contracts-2">ยง</a>Contracts</h2>
<p>The <code>assert</code> statement can evaluate arbitrary assertions. It is evaluated both during compile-time and run-time, as needed.</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> divide</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0057E6">decimal</span><span style="color: #5B5B5B">, b: </span><span style="color: #0057E6">decimal</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">assert</span><span style="color: #5B5B5B"> b </span><span style="color: #000000">!=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> a </span><span style="color: #000000">/</span><span style="color: #5B5B5B"> b</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> r1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> divide</span><span style="color: #B338FF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">0</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// compiler error</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> r2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> divide</span><span style="color: #B338FF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, x</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// compiler error</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> r2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> divide</span><span style="color: #B338FF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, y </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// compiler error</span></code></pre>
<p>It can be positioned anywhere, including in the global scope:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> z </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> y</span>
<span style="color: #0057E6">assert</span><span style="color: #5B5B5B"> z </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">5</span></code></pre>
<p>It can include function calls (but not action calls)</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> notZero</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">!=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span>

<span style="color: #0057E6">function</span><span style="color: #5B5B5B"> divide</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0057E6">decimal</span><span style="color: #5B5B5B">, b: </span><span style="color: #0057E6">decimal</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">assert</span><span style="color: #5B5B5B"> notZero</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">b</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> a </span><span style="color: #000000">/</span><span style="color: #5B5B5B"> b</span></code></pre>
<p>It can reference the returned value as well (these types of assertions would always be evaluated after the function has returned):</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> doSomeMath</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #0057E6">decimal</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">result: </span><span style="color: #0057E6">decimal</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">assert</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> x</span>
<span style="color: #5B5B5B">	....</span></code></pre>
<p>The immutability property could potentially ease the analysis of more complex scenarios at compile-time, using a more advanced theorem prover:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> someMath1</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #0057E6">decimal</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">result: </span><span style="color: #0057E6">decimal</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">assert</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">5</span>
<span style="color: #5B5B5B">	....</span>

<span style="color: #0057E6">function</span><span style="color: #5B5B5B"> someMath2</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0057E6">decimal</span><span style="color: #5B5B5B">, b: </span><span style="color: #0057E6">decimal</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">assert</span><span style="color: #5B5B5B"> b </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">assert</span><span style="color: #5B5B5B"> a </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> b </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">5</span>
<span style="color: #5B5B5B">	....</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> r1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> someMath1</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">..</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// r1 is always greater than 5</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> r2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> someMath2</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">r1, ..</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Compiler error regardless of the value of r1 and the second argument passed</span></code></pre>
<h1 id="type-abstractions"><a class="header-anchor" href="#type-abstractions">ยง</a>Type abstractions</h1>
<h2 id="refinement-and-assertion-types"><a class="header-anchor" href="#refinement-and-assertion-types">ยง</a>Refinement and assertion types</h2>
<p><strong>Refinement types</strong> can be seen as simple contracts annotated into the type itself:</p>
<p>The following are two function declarations are practically equivalent:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> someMath1</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #0057E6">decimal</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">result: </span><span style="color: #0057E6">decimal</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">assert</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">assert</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">16</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span>
<span style="color: #5B5B5B">	....</span></code></pre>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> someMath1</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #000000">-</span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #E65C00">16</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">..</span><span style="color: #0057E6">infinity</span>
<span style="color: #5B5B5B">	....</span></code></pre>
<p>Since Island values and variables are strictly read-only after initialization, only one assertion check is needed to ensure the validity of a contract throughout the lifetime of the object and its binding variable. Types of operations between refined types can be inferred during compile-time (if feasible):</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> x: </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">10</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> y: </span><span style="color: #000000">-</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">0</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> z </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> y </span><span style="color: #A1A1A1">// z's type is -50..0</span></code></pre>
<p>Refinement types can include more complex Boolean expressions:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> someMath2</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #000000">-</span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">4</span><span style="color: #5B5B5B"> </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">20</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #000000">-</span><span style="color: #E65C00">16</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">16</span><span style="color: #5B5B5B"> </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span>
<span style="color: #5B5B5B">	....</span></code></pre>
<p>Refinement types can apply to strings, using regular expressions:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> properIdentifiersOnly</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">id: </span><span style="color: #000000">/</span><span style="color: #5B5B5B">[a..zA..Z]</span><span style="color: #000000">+/</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	....</span></code></pre>
<p>More complex assertions can be included in a type by referencing a <strong>predicate function</strong>, which must accept a single argument and a return type of <code>boolean</code>. These kinds of types are called <strong>assertion types</strong>.</p>
<p>Assertion types, for the most part, cannot be checked during compile-time and would require a run-time call each time a variable of the type is initialized. The predicate's parameter type (which can be any type, including a refinement type) would be used to determine the base underlying type used at compile-time:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">predicate</span><span style="color: #5B5B5B"> MultipleOf10</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span>

<span style="color: #0057E6">function</span><span style="color: #5B5B5B"> something</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x: MultipleOf10</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	....</span></code></pre>
<p>Like any other method, assertion types can accept type arguments:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">predicate</span><span style="color: #5B5B5B"> ShortList</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">list: List</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> list.Length </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">100</span>

<span style="color: #0057E6">function</span><span style="color: #5B5B5B"> something</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x: ShortList</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">string</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	....</span></code></pre>
<p>A less powerful, but more concise way to define assertion types employs the <code>where</code> clause, used similarly to the <code>match</code> predicate syntax:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> something</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">result: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	....</span></code></pre>
<p>These capabilities enable overload resolution to include rudimentary <code>match</code>-like predicates:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> processSomething</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">category: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Animal</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, isMammal: </span><span style="color: #0057E6">true</span><span style="color: #5B5B5B">, owner: Person </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">18</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hello animal lover!</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">action</span><span style="color: #5B5B5B"> processSomething</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">category: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Animal</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, isMammal: </span><span style="color: #0057E6">false</span><span style="color: #5B5B5B">, owner: Person </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">18</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hello young animal lover!</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">action</span><span style="color: #5B5B5B"> processSomething</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">category: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Person</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, id: </span><span style="color: #000000">/</span><span style="color: #5B5B5B">[a..zA..Z]</span><span style="color: #000000">+/</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hello random person!</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span></code></pre>
<p>Using the compact overloading syntax would resemble more of the <code>match</code>/<code>case</code> structure. The following is semantically equivalent:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> processSomething</span>
<span style="color: #5B5B5B">	</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">category: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">animal</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, isMammal: </span><span style="color: #0057E6">true</span><span style="color: #5B5B5B">, owner: Person </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">18</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hello animal lover!</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">	</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">category: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">animal</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, isMammal: </span><span style="color: #0057E6">false</span><span style="color: #5B5B5B">, owner: Person </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">18</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hello young animal lover!</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">	</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">category: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">person</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, id: </span><span style="color: #000000">/</span><span style="color: #5B5B5B">[a..zA..Z]</span><span style="color: #000000">+/</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hello random person!</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span></code></pre>
<p>However, note that unlike <code>match</code> statements, overloading assumes the given argument set must satisfy one of the overloads, thus an analogous <code>otherwise</code> fallback is not needed. In case of a matching failure not caught during compile-time, a run-time error would be thrown.</p>
<p>Here's recursive Fibonacci implemented using overloading and refinement types:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> fibonacci</span>
<span style="color: #5B5B5B">	</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #E65C00">1</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span>
<span style="color: #5B5B5B">	</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #E65C00">2</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #5B5B5B">	</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">..</span><span style="color: #0057E6">infinity</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> fibonacci</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> fibonacci</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #B338FF">)</span></code></pre>
<p>Passing a number smaller than 1, e.g. <code>fibonacci(0)</code> would cause a runtime error (alternatively an overload like <code>(num: integer where num &lt; 1) =&gt; throw ....</code> could be added to provide more specialized error handling).</p>
<p>Compare with a single function matching over <code>num</code> as a parameter:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> fibonacci</span><span style="color: #B338FF">(</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> num</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> _ </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> fibonacci</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> fibonacci</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #B338FF">)</span></code></pre>
<p>Passing <code>fibonacci(0)</code>, would cause a compile-time error.</p>
<p>Also note that in both approaches, calling:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> fibonacci</span><span style="color: #B338FF">(</span><span style="color: #E65C00">2</span><span style="color: #B338FF">)</span></code></pre>
<p>Would cause <code>result</code> to have the literal type <code>1</code> as the return value could be inferred at compile-time.</p>
<p>Simple literal types like <code>&quot;Animal&quot;</code>, <code>5</code> or <code>true</code> can alternatively be stated without an identifier:</p>
<p>This would further simplify a previous example to:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> processSomething</span>
<span style="color: #5B5B5B">	</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">animal</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">true</span><span style="color: #5B5B5B">, owner: Person </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">18</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hello animal lover!</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">	</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">animal</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">false</span><span style="color: #5B5B5B">, owner: Person </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">18</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hello young animal lover!</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">	</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">person</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, id: </span><span style="color: #000000">/</span><span style="color: #5B5B5B">[a..zA..Z]</span><span style="color: #000000">+/</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hello random person!</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span></code></pre>
<p>Having no identifiers, the first two parameters can still accept named arguments by being referenced by their index:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #5B5B5B">processSomething</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">[</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">]: </span><span style="color: #0057E6">false</span><span style="color: #5B5B5B">, owner: Person</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Lea</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">,</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Johnson</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">16</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">, [</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">]: </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Animal</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>
<span style="color: #A1A1A1">// prints "Hello young animal lover!"</span></code></pre>
<h2 id="type-aliases"><a class="header-anchor" href="#type-aliases">ยง</a>Type aliases</h2>
<p>A <strong>type alias</strong> defines a new name for a type expression.</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">type</span><span style="color: #5B5B5B"> MyDictionary </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Dictionary</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">string</span><span style="color: #5B5B5B">, </span><span style="color: #B338FF">(</span><span style="color: #0057E6">string</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #000000">&gt;</span></code></pre>
<p>It may include type parameters:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">type</span><span style="color: #5B5B5B"> MyDictionary</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T, U</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Dictionary</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T, </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">T, U</span><span style="color: #B338FF">)</span><span style="color: #000000">&gt;</span></code></pre>
<p>By default, type aliases are <strong>structural</strong>, meaning differently named type aliases representing equivalent types are interchangeable with each other.</p>
<p>This is not always desirable, say, when aliasing the <code>decimal</code> type to represent different currencies:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">type</span><span style="color: #5B5B5B"> Dollars </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">decimal</span>
<span style="color: #0057E6">type</span><span style="color: #5B5B5B"> Euros </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">decimal</span>

<span style="color: #0057E6">function</span><span style="color: #5B5B5B"> iWantDollars</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">money: Dollars</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	....</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> euros: Euros </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">45</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span>
<span style="color: #5B5B5B">iWantDollars</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">euros</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// No error!</span></code></pre>
<p>To ensure <code>Dollars</code> and <code>Euros</code> would not be interchangeable with each other one can add the <code>new</code> modifier. This would define the aliases as <strong>nominal</strong> (unique) types:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">unique</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">type</span><span style="color: #5B5B5B"> Dollars </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">decimal</span>
<span style="color: #0057E6">unique</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">type</span><span style="color: #5B5B5B"> Euros </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">decimal</span>

<span style="color: #0057E6">function</span><span style="color: #5B5B5B"> iWantDollars</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">money: Dollars</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	....</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> euros: Euros </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">45</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">as</span><span style="color: #5B5B5B"> Euros </span><span style="color: #A1A1A1">// Explicit cast needed here</span>
<span style="color: #5B5B5B">iWantDollars</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">euros</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error! incompatible types</span></code></pre>
<h2 id="choice-types"><a class="header-anchor" href="#choice-types">ยง</a>Choice types</h2>
<p>A <strong>choice type</strong> (also called a <strong>union</strong> or a <strong>sum type</strong>) defines a type that may hold one of several different types:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">type</span><span style="color: #5B5B5B"> IntegerOrString </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B"> </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">string</span></code></pre>
<p>Choice types can disambiguated at runtime, using a type assertion:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> x: IntegerOrString </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">3</span>

<span style="color: #0057E6">if</span><span style="color: #5B5B5B"> x </span><span style="color: #0057E6">is</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">integer</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">integer!</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>
<span style="color: #0057E6">else</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">if</span><span style="color: #5B5B5B"> x </span><span style="color: #0057E6">is</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">string!</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span></code></pre>
<p>Or using pattern matching:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> x: IntegerOrString </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">3</span>

<span style="color: #0057E6">match</span><span style="color: #5B5B5B"> x</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">integer</span>
<span style="color: #5B5B5B">		print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">integer!</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">		print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">string!</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span></code></pre>
<p>Choice types may <strong>include any type</strong>, including primitives, templates, features, other choice types or even refinement types:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">type</span><span style="color: #5B5B5B"> CanBeManyThings </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B"> </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">decimal</span><span style="color: #5B5B5B"> </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> List</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> Cat </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">string</span><span style="color: #5B5B5B"> </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">boolean</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">10</span></code></pre>
<p>Like any type alias, choice types may <strong>include type parameters</strong>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">type</span><span style="color: #5B5B5B"> AnyCollection</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> List</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> Dictionary</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">string</span><span style="color: #5B5B5B">, T</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> Set</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T</span><span style="color: #000000">&gt;</span></code></pre>
<p>Choice types may be <strong>self-referencing</strong>, which allows modeling complex recursive structures like a binary tree:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">unique</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">type</span><span style="color: #5B5B5B"> BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">V</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> V </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">leftNode: BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">V</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">?, rightNode: BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">V</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">?</span><span style="color: #B338FF">)</span></code></pre>
<h2 id="variant-types"><a class="header-anchor" href="#variant-types">ยง</a>Variant types</h2>
<p>In the final example of the previous section we've used a choice type to define a binary tree type:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">unique</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">type</span><span style="color: #5B5B5B"> BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">V</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> V </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">leftNode: BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">V</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">?, rightNode: BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">V</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">?</span><span style="color: #B338FF">)</span></code></pre>
<p>One issue with this approach is that pattern matching to discriminate between a leaf and internal node is rather involved and error prone:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> leafOrInternal</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">(</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> tree: BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> T</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">leaf!</span><span style="color: #5B5B5B">"</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">?, BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">?</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">internal!</span><span style="color: #5B5B5B">"</span></code></pre>
<p>Wouldn't it be nicer if we could give those two possibilities names, to ease on pattern matching? It would be also nice to declare the type in a more organized way.</p>
<p>This is possible with variant types. A <strong>variant type</strong> (also called a <strong>tagged union</strong>) is a unique (nominal) choice type where each member has its own name.</p>
<p>With a variant type, pattern matching over a binary tree becomes much easier:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">variant</span><span style="color: #5B5B5B"> BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">V</span><span style="color: #000000">&gt;</span>
<span style="color: #5B5B5B">	Leaf: V</span>
<span style="color: #5B5B5B">	Internal: </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">leftNode: BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">V</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">?, rightNode: BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">V</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">?</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">function</span><span style="color: #5B5B5B"> leafOrInternal</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">(</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> tree: BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Leaf</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">leaf!</span><span style="color: #5B5B5B">"</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Internal</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">internal!</span><span style="color: #5B5B5B">"</span></code></pre>
<p>Values of variant members can be assigned, matched and extracted using the <code>VariantMemberName(value)</code> syntax:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> traverseBinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">(</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> tree: BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Leaf</span><span style="color: #B338FF">(</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> value</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> value</span>

<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Tuple typed variant members don't require the extra parentheses</span>
<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// e.g. instead of Internal((left: ...., right: ....))</span>
<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">//    we can write Internal(left: ...., right: ....)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Internal</span><span style="color: #B338FF">(</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> left: BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">?, </span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> right: BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">?</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">if</span><span style="color: #5B5B5B"> left </span><span style="color: #0057E6">is</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">nothing</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> traverseBinaryTree</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">left</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">		</span><span style="color: #0057E6">if</span><span style="color: #5B5B5B"> right </span><span style="color: #0057E6">is</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">nothing</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> traverseBinaryTree</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">right</span><span style="color: #B338FF">)</span></code></pre>
<p>Variant types allow for including members with <strong>duplicate types</strong>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">variant</span><span style="color: #5B5B5B"> Currency</span>
<span style="color: #5B5B5B">	USDollar: </span><span style="color: #0057E6">decimal</span>
<span style="color: #5B5B5B">	Euro: </span><span style="color: #0057E6">decimal</span>
<span style="color: #5B5B5B">	Yen: </span><span style="color: #0057E6">decimal</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> money: Currency </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Euro</span><span style="color: #B338FF">(</span><span style="color: #E65C00">45</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #B338FF">)</span></code></pre>
<p>Variant types with members of tuple types allow including a <code>where</code> clause, in which the tuple's member names are introduced. In practice this appears similarly to how objects are matched:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">variant</span><span style="color: #5B5B5B"> PersonOrCar</span>
<span style="color: #5B5B5B">	Person: </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">name: </span><span style="color: #0057E6">string</span><span style="color: #5B5B5B">, height: </span><span style="color: #0057E6">decimal</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	Car: </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">brand: </span><span style="color: #0057E6">string</span><span style="color: #5B5B5B">, maxSpeed: </span><span style="color: #0057E6">decimal</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">function</span><span style="color: #5B5B5B"> getResponseString</span><span style="color: #B338FF">(</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> personOrCar: PersonOrCar</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Person </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> name </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">James</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hi James</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Person </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> height </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Tall person</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Car </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> maxSpeed </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">200</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Fast car</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Not interesting</span><span style="color: #5B5B5B">"</span></code></pre>
<p>Same as above using the constructor-style syntax:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> getResponseString</span><span style="color: #B338FF">(</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> personOrCar: PersonOrCar</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Person</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">James</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, ...</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hi James</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Person</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">_, _ </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, ...</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Tall person</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Car</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">_, _ </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">200</span><span style="color: #5B5B5B">, ...</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Fast car</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Not interesting</span><span style="color: #5B5B5B">"</span></code></pre>
<p>Members may individually include their own set of type parameters (this is related to the concept of <strong>generalized algebraic data types</strong>):</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">variant</span><span style="color: #5B5B5B"> PairOrTriple</span>
<span style="color: #5B5B5B">	Pair</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">: </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x: T, y: T</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	Triple</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">V</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">: </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x: V, y: V, z: V</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">function</span><span style="color: #5B5B5B"> matchPairOrTriple</span><span style="color: #B338FF">(</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> pairOrTriple: PairOrTriple</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Pair</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">string</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">James</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, _</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hi James</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Pair</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">string</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">XYZ</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B"> ,</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">123</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">123</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Pair</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> ,_ </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">100</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Good</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Triple</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">_, _, </span><span style="color: #E65C00">55</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">55</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Triple</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">boolean</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">_, </span><span style="color: #0057E6">false</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">true</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">OK!</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Not interesting</span><span style="color: #5B5B5B">"</span></code></pre>
<p>Variant types can be <strong>extended</strong>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">variant</span><span style="color: #5B5B5B"> Currency</span>
<span style="color: #5B5B5B">	USDollar: </span><span style="color: #0057E6">decimal</span>
<span style="color: #5B5B5B">	Euro: </span><span style="color: #0057E6">decimal</span>
<span style="color: #5B5B5B">	Yen: </span><span style="color: #0057E6">decimal</span>

<span style="color: #0057E6">variant</span><span style="color: #5B5B5B"> ExtendedCurrency </span><span style="color: #0057E6">extends</span><span style="color: #5B5B5B"> Currency</span>
<span style="color: #5B5B5B">	CanadianDollar: </span><span style="color: #0057E6">decimal</span>
<span style="color: #5B5B5B">	PoundSterling: </span><span style="color: #0057E6">decimal</span>

<span style="color: #0057E6">variant</span><span style="color: #5B5B5B"> ExtendedMoreCurrency </span><span style="color: #0057E6">extends</span><span style="color: #5B5B5B"> ExtendedCurrency</span>
<span style="color: #5B5B5B">	SwedishKrona: </span><span style="color: #0057E6">decimal</span>
<span style="color: #5B5B5B">	SwissFranc: </span><span style="color: #0057E6">decimal</span></code></pre>
<p>An extended variant type is a <strong>super-type</strong> of the variant it inherits from. This is the opposite relationship when compared to class inheritance, which creates a subtype.</p>
<p>For example:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> giveMeMoney</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">money: Currency</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	....</span>

<span style="color: #5B5B5B">giveMeMoney</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Currency.Euro</span><span style="color: #B338FF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// works</span>
<span style="color: #5B5B5B">giveMeMoney</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">ExtendedCurrency.CanadianDollar</span><span style="color: #B338FF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// doesn't work</span></code></pre>
<p>However:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> giveMeMoney</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">money: ExtendedCurrency</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	....</span>

<span style="color: #5B5B5B">giveMeMoney</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Currency.Euro</span><span style="color: #B338FF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// works</span>
<span style="color: #5B5B5B">giveMeMoney</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">ExtendedCurrency.CanadianDollar</span><span style="color: #B338FF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// works</span>
<span style="color: #5B5B5B">giveMeMoney</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">ExtendedMoreCurrency.SwissFranc</span><span style="color: #B338FF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// doesn't work</span></code></pre>
<p>An extending variant type may <strong>override</strong> one or more members, as long as the overriding type is a super-type of the original:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">variant</span><span style="color: #5B5B5B"> WordKind</span>
<span style="color: #5B5B5B">	ActionWord: TransitiveVerb</span>
<span style="color: #5B5B5B">	ObjectWord: Noun</span>

<span style="color: #0057E6">variant</span><span style="color: #5B5B5B"> ExtendedWordKind </span><span style="color: #0057E6">extends</span><span style="color: #5B5B5B"> WordKind</span>
<span style="color: #5B5B5B">	ActionWord: Verb </span><span style="color: #A1A1A1">// Verb is a super-type of TransitiveVerb</span></code></pre>
<p>Variants may contain <strong>untyped members</strong>, which can be useful for representing possibilities or states that don't carry any data with them:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">variant</span><span style="color: #5B5B5B"> Currency</span>
<span style="color: #5B5B5B">	USDollar: </span><span style="color: #0057E6">decimal</span>
<span style="color: #5B5B5B">	Euro: </span><span style="color: #0057E6">decimal</span>
<span style="color: #5B5B5B">	Unknown</span></code></pre>
<p>Variant types may <strong>embed class declarations</strong> for one or more of their members. Declaring <code>Internal</code> as an embedded class now allows to implement a specialized <code>traverse</code> method for the <code>Internal</code> member:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">variant</span><span style="color: #5B5B5B"> BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">V</span><span style="color: #000000">&gt;</span>
<span style="color: #5B5B5B">	Leaf: V</span>

<span style="color: #5B5B5B">	Internal: </span><span style="color: #0057E6">class</span>
<span style="color: #5B5B5B">		leftNode: BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">V</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">?</span>
<span style="color: #5B5B5B">		rightNode: BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">V</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">?</span>

<span style="color: #5B5B5B">		hasChildren </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">leftNode, rightNode</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">is</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">nothing</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">nothing</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">		</span><span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> traverse</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> leftNode?.traverse</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> rightNode?.traverse</span><span style="color: #B338FF">()</span></code></pre>
<p>Like classes, variants may have <strong>companion type objects</strong>, which also enable them to support type traits:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">variant</span><span style="color: #5B5B5B"> BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">V</span><span style="color: #000000">&gt;</span>
<span style="color: #5B5B5B">	....</span>

<span style="color: #0057E6">object</span><span style="color: #5B5B5B"> BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">V</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">extends</span><span style="color: #5B5B5B"> Comparable</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">V</span><span style="color: #000000">&gt;&gt;</span><span style="color: #5B5B5B">, Equatable</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">V</span><span style="color: #000000">&gt;&gt;</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> traverse</span><span style="color: #B338FF">(</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> tree: BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">V</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Leaf</span><span style="color: #B338FF">(</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> value</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> value</span>

<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Internal</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> tree.iterate</span><span style="color: #B338FF">()</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> compare</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">t1: BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">V</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">, t2: BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">V</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0057E6">integer</span>
<span style="color: #5B5B5B">		....</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">operator</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">t1: BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">V</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">, t2: BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">V</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0057E6">boolean</span>
<span style="color: #5B5B5B">		....</span></code></pre>
<p>Individual members of the variant may also receive their own <strong>dedicated type objects</strong>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">object</span><span style="color: #5B5B5B"> BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">V</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">extends</span><span style="color: #5B5B5B"> Comparable</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">V</span><span style="color: #000000">&gt;&gt;</span><span style="color: #5B5B5B">, Equatable</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">V</span><span style="color: #000000">&gt;&gt;</span>
<span style="color: #5B5B5B">	....</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">object</span><span style="color: #5B5B5B"> Leaf </span><span style="color: #0057E6">extends</span><span style="color: #5B5B5B"> Comparable</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">V</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">.Leaf</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">, Equatable</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">V</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">.Leaf</span><span style="color: #000000">&gt;</span>
<span style="color: #5B5B5B">		....</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">object</span><span style="color: #5B5B5B"> Internal </span><span style="color: #0057E6">extends</span><span style="color: #5B5B5B"> Comparable</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">V</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">.Internal</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">, Equatable</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">BinaryTree</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">V</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">.Internal</span><span style="color: #000000">&gt;</span>
<span style="color: #5B5B5B">		....</span></code></pre>
<h2 id="enumerations"><a class="header-anchor" href="#enumerations">ยง</a>Enumerations</h2>
<p>An <strong>enumeration</strong> is a type expressing a choice between a set of identifiers associated with constant values. By default, enumeration members receive integer values following the sequence <code>1, 2, 3, ...</code></p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">enumeration</span><span style="color: #5B5B5B"> StatusCode</span>
<span style="color: #5B5B5B">	Waiting</span>
<span style="color: #5B5B5B">	OK</span>
<span style="color: #5B5B5B">	Failed</span>

<span style="color: #0057E6">action</span><span style="color: #5B5B5B"> alertStatus </span><span style="color: #B338FF">(</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> status: StatusCode</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Waiting </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Still waiting..</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> OK </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Everything is OK!</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Failed </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Damn, failed :(</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span></code></pre>
<p>Enumerations are special forms of variant types where each member must receive a unique type (which can also be a literal type like <code>4</code>, <code>&quot;hello&quot;</code> or <code>true</code>).</p>
<p>Here is <code>StatusCode</code> equivalently expressed as its underlying variant type:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">variant</span><span style="color: #5B5B5B"> StatusCode </span><span style="color: #A1A1A1">// 1, 2, 3 are literal *types*</span>
<span style="color: #5B5B5B">	Waiting: </span><span style="color: #E65C00">1</span>
<span style="color: #5B5B5B">	OK: </span><span style="color: #E65C00">2</span>
<span style="color: #5B5B5B">	Failed: </span><span style="color: #E65C00">3</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> status: StatusCode </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> StatusCode.OK</span></code></pre>
<p>Enumeration members can have integer values other than the <code>1, 2, 3, ...</code> sequence. If a member value is explicitly specified, all following members without explicit values are automatically incremented relative to it:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">enumeration</span><span style="color: #5B5B5B"> HttpStatusCode</span>
<span style="color: #5B5B5B">	OK </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">200</span>
<span style="color: #5B5B5B">	Created  </span><span style="color: #A1A1A1">// = 201</span>
<span style="color: #5B5B5B">	Accepted </span><span style="color: #A1A1A1">// = 202</span>
<span style="color: #5B5B5B">	MultipleChices </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">300</span>
<span style="color: #5B5B5B">	MovedPermanently </span><span style="color: #A1A1A1">// = 301</span>
<span style="color: #5B5B5B">	Found 			 </span><span style="color: #A1A1A1">// = 302</span>
<span style="color: #5B5B5B">	BadRequest </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">400</span>
<span style="color: #5B5B5B">	Unauthorized	 </span><span style="color: #A1A1A1">// = 401</span>
<span style="color: #5B5B5B">	PaymentRequired  </span><span style="color: #A1A1A1">// = 402</span></code></pre>
<p>Enumerations can have members of types other than <code>integer</code>, however, in this case all member values have to be explicitly specified:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">enumeration</span><span style="color: #5B5B5B"> Direction</span>
<span style="color: #5B5B5B">	Up </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">UP</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	Down </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">DOWN</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	Left </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">LEFT</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	Right </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">RIGHT</span><span style="color: #5B5B5B">"</span></code></pre>
<h2 id="the-nothing-type-and-the-%3F-operator"><a class="header-anchor" href="#the-nothing-type-and-the-%3F-operator">ยง</a>The <code>nothing</code> type and the <code>?</code> operator</h2>
<p>So far we've occasionally used the <code>nothing</code> keyword, but hadn't really got into the details of what it really is.</p>
<p><code>nothing</code> may look superficially similar to <code>null</code> in other languages. However, in Island <code>nothing</code> is not primarily a value, but a type.</p>
<p>Take for example:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> computeSomething</span><span style="color: #B338FF">(</span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B"> num</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B"> </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">nothing</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// can also be written as 'integer?'</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> num </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> num </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">otherwise</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">nothing</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// `nothing` here acts somewhat like `null`</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> computeSomething</span><span style="color: #B338FF">(</span><span style="color: #000000">-</span><span style="color: #E65C00">1</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// what type and value does 'x' receive?</span></code></pre>
<p><code>return nothing</code> might seem like a value named <code>nothing</code> is being returned from the function (similarly to, say <code>return null</code> would in other languages). However, in practice, what is really happening is that <code>x</code> receives the type <code>nothing</code> which by default has <strong>a single empty value</strong> which is also called <code>nothing</code> (this behavior is similar to a concept known as the <strong>unit type</strong>).</p>
<p>Actions that don't return any value can be optionally annotated as returning <code>nothing</code>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> printHelloWorld</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B">: </span><span style="color: #0057E6">nothing</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// `nothing` here acts like `void` in the C family of languages</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hello World!</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span></code></pre>
<p>Trying the read the result of a method returning only <code>nothing</code> (either annotated as such or not) will fail, since the <code>nothing</code> type doesn't contain any useful information by itself:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> printHelloWorld</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error: printHelloWorld() returns only `nothing`</span></code></pre>
<p>The <code>nothing</code> type is designed such that there is very little you can do with it. However, it is at times a very useful tool when defining optional parameters or capturing &quot;soft&quot; failures when returning from methods.</p>
<p>The question mark symbol (<code>?</code>) would modify a type to become a choice type including <code>nothing</code> as one of its options. It would work on any type, including a type that already is a choice type, for example:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">type</span><span style="color: #5B5B5B"> Number </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B"> </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">decimal</span>
<span style="color: #0057E6">type</span><span style="color: #5B5B5B"> PossiblyNumber </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Number? </span><span style="color: #A1A1A1">// PossiblyNumber = integer or decimal or nothing</span></code></pre>
<p>The <code>?</code> symbol can also be used in several other ways:</p>
<p>The <strong>null-conditional operator</strong> applies member access <code>?.</code>, index access <code>?[]</code> or method call <code>?()</code> only if the preceding expression fragment evaluates to a value that is not of type <code>nothing</code>, otherwise, the entire enclosing expression evaluates to <code>nothing</code>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Address</span>
<span style="color: #5B5B5B">	city: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	street: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	houseNumber: </span><span style="color: #0057E6">integer</span>

<span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Person</span>
<span style="color: #5B5B5B">	name: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	address: Address </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">nothing</span>
<span style="color: #5B5B5B">	petNames: List</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">string</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">nothing</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> person </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Person </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> name </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Jimmy Jones</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, address </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">nothing</span><span style="color: #5B5B5B">, petNames </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">nothing</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> houseNumber </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> person.address?.houseNumber </span><span style="color: #A1A1A1">// houseNumber = nothing</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> firstPetName </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> person.petNames?[</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// firstPetName = nothing</span></code></pre>
<p><em>Some notes on possible confusion with terminology used by other languages: In Island the unit type is called <code>nothing</code> and the bottom type is called <code>never</code> (introduced in a following chapter). In Scala the unit type is called <code>Unit</code> and the bottom type <code>Nothing</code>. However Haskell uses the term <code>Nothing</code> in its option type to represent the option of having &quot;No value&quot;, which is closer to the semantics intended here.</em></p>
<h2 id="the-any-type"><a class="header-anchor" href="#the-any-type">ยง</a>The <code>any</code> type</h2>
<p>The <code>any</code> type (roughly representing the <strong>top type</strong>). It is equivalent to a choice type including of all the types in the language, except <code>nothing</code> and <code>never</code> (<code>any?</code> would include <code>nothing</code> as well) .</p>
<p>Note this is not the same as a dynamic type, because it requires an explicit type assertion or a cast in order to be used for any meaningful purpose:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> whatIsThis</span><span style="color: #B338FF">(</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> x: </span><span style="color: #0057E6">any</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">integer!</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">decimal</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">decimal!</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">string</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">string!</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">boolean</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">boolean!</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> List</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">boolean</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">list of booleans!</span><span style="color: #5B5B5B">"</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">I don't know?</span><span style="color: #5B5B5B">"</span></code></pre>
<p>Assigning from a value having the <code>any</code> type could also be done using an explicit cast:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> x: </span><span style="color: #0057E6">any</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">5</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> y: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> x </span><span style="color: #0057E6">as</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">integer</span></code></pre>
<p>However assigning a value of the wrong type would produce a compile or runtime error:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> x: </span><span style="color: #0057E6">any</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">hello</span><span style="color: #5B5B5B">"</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> y: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> x </span><span style="color: #0057E6">as</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error</span></code></pre>
<h2 id="the-never-type"><a class="header-anchor" href="#the-never-type">ยง</a>The <code>never</code> type</h2>
<p>The <code>never</code> type represents the result of a computation that either never terminates, or always fails:</p>
<p>For example, if a <code>for</code> loop, running inside a <code>function</code> context, does not alter any of its variables and does not have any stopping condition, it is guaranteed to never terminate, and consequently the function would never return!</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> neverEndingFunction</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">out</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">continue</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// never terminates!</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> result</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> neverEndingFunction</span><span style="color: #B338FF">(</span><span style="color: #E65C00">0</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// what type is x?</span></code></pre>
<p>In this case you may think the compiler should just raise an error (it will). However, <code>x</code> will also get the <code>never</code> type, which would be useful to allow more errors to be reported down the road.</p>
<p>Sometimes there are only particular cases where the function never returns:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> maybeNeverEndingFunction</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">out</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">while</span><span style="color: #5B5B5B"> num </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">continue</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> result</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> mysteryValue: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> mysteryFunction</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">....</span><span style="color: #B338FF">)</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> maybeNeverEndingFunction</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">mysteryValue</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// what type is x?</span></code></pre>
<p>If <code>num &lt;= 0</code> the function would return immediately with the value <code>1</code>. However, when <code>num &gt; 0</code> it will never terminate.</p>
<p>So <code>x</code> receives the type <code>integer or never</code>, which roughly means &quot;if x has a value, it is of type <code>integer</code>, but it may also never get to the point where receives any value&quot;.</p>
<p>The <code>never</code> type is also known as the <strong>bottom type</strong>, meaning it is a type that has no values, and behaves somewhat like the empty set ร.</p>
<h2 id="join-types"><a class="header-anchor" href="#join-types">ยง</a>Join types</h2>
<p>A <strong>join type</strong> (also called an <strong>intersection type</strong>) allows combining multiple traits in a convenient form:</p>
<p>If we wanted to write a function that accepts a parameter of a type implementing the two traits <code>Named</code> and <code>Numbered</code> we could do something like:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">trait</span><span style="color: #5B5B5B"> Named</span>
<span style="color: #5B5B5B">	name: </span><span style="color: #0057E6">string</span>

<span style="color: #0057E6">trait</span><span style="color: #5B5B5B"> Numbered</span>
<span style="color: #5B5B5B">	id: </span><span style="color: #0057E6">integer</span>

<span style="color: #0057E6">trait</span><span style="color: #5B5B5B"> NamedAndNumbered </span><span style="color: #0057E6">extends</span><span style="color: #5B5B5B"> Named, Numbered</span>

<span style="color: #0057E6">function</span><span style="color: #5B5B5B"> giveMeNamedAndNumbered</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">value: NamedAndNumbered</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	....</span></code></pre>
<p>Using a join type, this can be shortened to:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">trait</span><span style="color: #5B5B5B"> Named</span>
<span style="color: #5B5B5B">	name: </span><span style="color: #0057E6">string</span>

<span style="color: #0057E6">trait</span><span style="color: #5B5B5B"> Numbered</span>
<span style="color: #5B5B5B">	id: </span><span style="color: #0057E6">integer</span>

<span style="color: #0057E6">function</span><span style="color: #5B5B5B"> giveMeNamedAndNumbered</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">value: Named </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> Numbered</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	....</span></code></pre>
<h2 id="member-type-references"><a class="header-anchor" href="#member-type-references">ยง</a>Member type references</h2>
<p>Object or tuple type references may include references to members, method parameter or return types:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Person</span>
<span style="color: #5B5B5B">	name: </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	data: </span><span style="color: #B338FF">(</span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">boolean</span><span style="color: #5B5B5B">, id: </span><span style="color: #0057E6">string</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> processMe</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">someData: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, moreData: </span><span style="color: #0057E6">string</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: Set</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">string</span><span style="color: #000000">&gt;</span>
<span style="color: #5B5B5B">		....</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> n: Person.name </span><span style="color: #A1A1A1">// n receives the type string</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> d: Person.data[</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// d receives the type boolean</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> id: Person.data.id </span><span style="color: #A1A1A1">// id receives the type string</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> p: Person.processMe.params </span><span style="color: #A1A1A1">// p receives the tuple type (someData: integer, moreData: string)</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> md: Person.processMe.moreData </span><span style="color: #A1A1A1">// md receieves the type string (might be a choice type if overloaded)</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> r: Person.processMe.</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// r receives the type Set&lt;string&gt;</span></code></pre>
<h2 id="higher-kinded-traits"><a class="header-anchor" href="#higher-kinded-traits">ยง</a>Higher-kinded traits</h2>
<h1 id="reactive-programming"><a class="header-anchor" href="#reactive-programming">ยง</a>Reactive programming</h1>
<h2 id="reactive-values"><a class="header-anchor" href="#reactive-values">ยง</a>Reactive values</h2>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> currentTemperature </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> Weather.currentTemperature</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Current temperature is </span><span style="color: #B338FF">{</span><span style="color: #AA6631">currentTemperature</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> temperatureIsOver20: </span><span style="color: #0057E6">reactive</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">boolean</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> temperature </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">20</span>

<span style="color: #0057E6">for</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> currentlyOver20 </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> temperatureIsOver20</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">true</span>
<span style="color: #5B5B5B">		print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Current temperature is over 20 degrees!</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">otherwise</span>
<span style="color: #5B5B5B">		print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Current temperature is under 20 degrees!</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">reactive</span><span style="color: #5B5B5B"> lightSwitchState</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> currentState: </span><span style="color: #0057E6">boolean</span><span style="color: #5B5B5B">? </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">nothing</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> newState </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> getLightSwitchState</span><span style="color: #B338FF">()</span>

<span style="color: #5B5B5B">		</span><span style="color: #0057E6">if</span><span style="color: #5B5B5B"> newState </span><span style="color: #000000">!=</span><span style="color: #5B5B5B"> currentState</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">emit</span><span style="color: #5B5B5B"> newState</span>
<span style="color: #5B5B5B">			currentState </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> newState</span>

<span style="color: #5B5B5B">		</span><span style="color: #0057E6">wait</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">100</span>

<span style="color: #0057E6">reactive</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">selection</span><span style="color: #5B5B5B"> oneOfSeveralEvents</span>
<span style="color: #5B5B5B">	Temperature </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Weather.currentTemperature</span>
<span style="color: #5B5B5B">	LightSwitch </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> lightSwitchState</span>
<span style="color: #5B5B5B">	CustomIntEvent: </span><span style="color: #0057E6">integer</span>

<span style="color: #0057E6">for</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> event </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> oneOfSeveralEvents</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Temperature</span><span style="color: #B338FF">(</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> t</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Temperature is now </span><span style="color: #B338FF">{</span><span style="color: #AA6631">t</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		oneOfSeveralEvents </span><span style="color: #000000">&lt;&lt;</span><span style="color: #5B5B5B"> someAction</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">t</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">as</span><span style="color: #5B5B5B"> CustomIntEvent </span><span style="color: #A1A1A1">// Implicitly spawns someAction</span>
<span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// Execution immediately proceeds here</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> LightSwitch</span><span style="color: #B338FF">(</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> s</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Light switch state is now </span><span style="color: #B338FF">{</span><span style="color: #AA6631">t</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> CustomIntEvent</span><span style="color: #B338FF">(</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> i</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Custom int event of </span><span style="color: #B338FF">{</span><span style="color: #AA6631">i</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span></code></pre>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> MyState</span>
<span style="color: #5B5B5B">	downloadingFile: </span><span style="color: #0057E6">boolean</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">false</span>

<span style="color: #5B5B5B">	downloadButtonPressed: </span><span style="color: #0057E6">reactive</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">boolean</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> downloadButton.Pressed</span>
<span style="color: #5B5B5B">	downloadResult: </span><span style="color: #0057E6">reactive</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">url: </span><span style="color: #0057E6">string</span><span style="color: #5B5B5B">, fileContent: </span><span style="color: #0057E6">string</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	outsideTemperature: </span><span style="color: #0057E6">reactive</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">decimal</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Weather.outsideTemperature</span>

<span style="color: #0057E6">for</span><span style="color: #5B5B5B"> state </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> MyState</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B">, change </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">observe</span><span style="color: #5B5B5B"> state</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> change, state.downloadingFile</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> MyState.downloadButtonPressed </span><span style="color: #0057E6">of</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">true</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">false</span>
<span style="color: #5B5B5B">			print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Starting download..</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">spawn</span><span style="color: #5B5B5B"> downloadFile</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">https://example.com/someFile</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">continue</span><span style="color: #5B5B5B"> state </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">downloadingFile </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">true</span><span style="color: #5B5B5B">, downloadResult </span><span style="color: #000000">&lt;&lt;</span><span style="color: #5B5B5B"> result</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> MyState.downloadButtonPressed </span><span style="color: #0057E6">of</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">true</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">true</span>
<span style="color: #5B5B5B">			print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Already downloading!</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> MyState.downloadResult </span><span style="color: #0057E6">of</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> url, </span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> fileContent</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">, _</span>
<span style="color: #5B5B5B">			print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Finished downloading </span><span style="color: #B338FF">{</span><span style="color: #AA6631">url</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">spawn</span><span style="color: #5B5B5B"> saveFile</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">myFile</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, fileContent</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">continue</span><span style="color: #5B5B5B"> state </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> downloadingFile </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">false</span>

<span style="color: #5B5B5B">		</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> MyState.outsideTemperature </span><span style="color: #0057E6">of</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> temperature</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">, _</span>
<span style="color: #5B5B5B">			print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Current temperature is </span><span style="color: #B338FF">{</span><span style="color: #AA6631">temperature</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span></code></pre>
<h1 id="exception-handling"><a class="header-anchor" href="#exception-handling">ยง</a>Exception handling</h1>
<h2 id="failure-types"><a class="header-anchor" href="#failure-types">ยง</a>Failure types</h2>
<p>So far we've used <code>nothing</code> to represent failure cases, i.e. cases where the function doesn't succeed and instead returns an empty return value.</p>
<p>Sometimes we wish to be more specific and provide a more detailed report on what exactly went wrong. This is made possible by the <strong>failure type</strong>, which is a type representing a failed computation, and may also include further information.</p>
<p>Consider this case:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> divide</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, y: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">/</span><span style="color: #5B5B5B"> y</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> r </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> divide</span><span style="color: #B338FF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">0</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// What should be the type of `r`?</span></code></pre>
<p>One approach would be to return <code>nothing</code> when <code>y</code> is 0:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> divide</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, y: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">?</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">nothing</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">/</span><span style="color: #5B5B5B"> y</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> r1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> divide</span><span style="color: #B338FF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, someInt</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// `r1` gets type integer or nothing</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> r2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> divide</span><span style="color: #B338FF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">0</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// `r2` gets type nothing</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> r3 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> r1 </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error: r1 may be of type nothing!</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> r4 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> r2 </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error: r2 is of type nothing!</span></code></pre>
<p>However, that would mean that in every computation done with <code>divide</code> we would have to use a type assertion to check if the result type is not <code>nothing</code> and then proceed:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> r3</span>
<span style="color: #0057E6">if</span><span style="color: #5B5B5B"> r1 </span><span style="color: #0057E6">is</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">nothing</span>
<span style="color: #5B5B5B">	r3 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> r1 </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span></code></pre>
<p>Alternatively, the <strong>Failure type</strong> is a special type designated to represent failures.</p>
<p>Island has two approaches to using the failure type:</p>
<ol>
<li>Returned directly from a method, as a part of a choice type, and then optionally assert on through the returned value. This is the only approach permittable for a function.</li>
<li>Use the <code>fail</code> statement to raise an error, together with a <code>check</code>..<code>detect</code> block to capture the error in a caller scope. This is only possible in action scopes.</li>
</ol>
<h2 id="returning-the-failure-type-from-a-method"><a class="header-anchor" href="#returning-the-failure-type-from-a-method">ยง</a>Returning the failure type from a method</h2>
<p>The failure type possesses a special &quot;vanishing&quot; quality when included inside of a choice type. If the choice type contains only a single type that is not of type <code>failure</code> then no assertion is needed for the variable to be used as if it could only have that type.</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> divide</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, y: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> Failure</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Divide by zero!</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">/</span><span style="color: #5B5B5B"> y</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> r1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> divide</span><span style="color: #B338FF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, someInt</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// `r1` gets type integer or Failure</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> r2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> divide</span><span style="color: #B338FF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">0</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// `r2` gets type Failure</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> r3 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> r1 </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Works! no type assertion needed!</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> r4 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> r2 </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error: r2 is of type Failure</span></code></pre>
<p>Note that if the result of the operation is immediately unpacked, the failure can sill be asserted for on any one of the unpacked variables:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> getKeyOrFail</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">key: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> dict: </span><span style="color: #B338FF">{</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">string</span><span style="color: #5B5B5B">: </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">age: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, bestFriend: </span><span style="color: #0057E6">string</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">})</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">{</span><span style="color: #5B5B5B"> ..., key, ... </span><span style="color: #B338FF">}</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> dict[key]</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> Failure</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Key '</span><span style="color: #B338FF">{</span><span style="color: #AA6631">key</span><span style="color: #B338FF">}</span><span style="color: #AA6631">' not found!</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> someDictionary </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">{</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Linda</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">: </span><span style="color: #B338FF">(</span><span style="color: #E65C00">25</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Mary</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">,  </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Alan</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">: </span><span style="color: #B338FF">(</span><span style="color: #E65C00">34</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Anton</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">}</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">age, bestFriend</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> getKeyOrFail</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">James</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, someDictionary</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">if</span><span style="color: #5B5B5B"> age </span><span style="color: #0057E6">is</span><span style="color: #5B5B5B"> Failure</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Couldn't find 'James' in the dictionary!</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span></code></pre>
<h2 id="using-check..detect-(action-scopes-only)"><a class="header-anchor" href="#using-check..detect-(action-scopes-only)">ยง</a>Using <code>check</code>..<code>detect</code> (action scopes only)</h2>
<p>The second approach, available only in action scopes (due to its use of side-effects), uses a <code>check</code>..<code>detect</code> block and behaves very similarly to <code>try</code>, <code>catch</code> in mainstream imperative languages:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">action</span><span style="color: #5B5B5B"> readLineFromFile</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">f: File</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> f.ReadLine</span><span style="color: #B338FF">()</span>

<span style="color: #0057E6">action</span><span style="color: #5B5B5B"> example</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">f: File</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">check</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> line </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> readLineFromFile</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">f</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">line</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">detect</span><span style="color: #5B5B5B"> failure: Failure</span>
<span style="color: #5B5B5B">		print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">failure.message</span><span style="color: #B338FF">)</span></code></pre>
<h1 id="logic-programming"><a class="header-anchor" href="#logic-programming">ยง</a>Logic programming</h1>
<h2 id="relations%2C-facts-and-rules"><a class="header-anchor" href="#relations%2C-facts-and-rules">ยง</a>Relations, facts and rules</h2>
<p>Island provides a statically typed logic programming system integrating closely with the rest of the language.</p>
<p>The <code>relation</code> declaration defines a relation, which, in a sense, expands over the concept of a function and provides a way to express and query multi-directional dependencies between its parameters (also referred to as <em>terms</em>).</p>
<p>With respect to its output, a relation is, in practice, a lot like a stream method yielding a sequence of tuples where each tuple in the sequence represent a satisfying assignment for its terms.</p>
<p>A <code>relation fact</code> statement defines a fact, which is like an axiom containing a combination of term values that is always true.</p>
<p>A <code>relation rule</code> defines a conjunction of one or more clauses (also called goals) where a set of input arguments (which may be either assigned or unassigned) are flowed through them. If a goal cannot be satisfied with the given arguments the inference engine backtracks to the previous goal and proceeds with its next satisfying assignment. This continues either until the final goal is satisfied or all the possible alternatives are exhausted.</p>
<p>Here's the classic parent-siblings example expressed in Island's logic programming syntax:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">class</span><span style="color: #5B5B5B"> Family</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">relation</span><span style="color: #5B5B5B"> Parent</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">fact</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Alice</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">James</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">fact</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Alice</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Angela</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">fact</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Tom</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">John</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">relation</span><span style="color: #5B5B5B"> Siblings</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">rule</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">sibiling1: </span><span style="color: #0057E6">string</span><span style="color: #5B5B5B">, sibling2: </span><span style="color: #0057E6">string</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">			Parent</span><span style="color: #B338FF">(</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> someParent, sibling1</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">			Parent</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">someParent, sibling2</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">			NotEqual</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">sibling1, sibling2</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> family </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Family</span><span style="color: #B338FF">()</span>

<span style="color: #A1A1A1">// Remember that since Parent returns a stream</span>
<span style="color: #A1A1A1">// Getting its first result would require stepping once through the stream</span>
<span style="color: #A1A1A1">// The 'exists' expansion property returns true if a stream yields at least one value</span>
<span style="color: #A1A1A1">// The 'first' expansion property returns the first value yielded</span>
<span style="color: #5B5B5B">family.Parent</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Alice</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, _</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">.exists </span><span style="color: #A1A1A1">// returns true</span>
<span style="color: #5B5B5B">family.Parent</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Alice</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Angela</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">.exists </span><span style="color: #A1A1A1">// returns true</span>
<span style="color: #5B5B5B">family.Parent</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Alice</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Angela</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">.first </span><span style="color: #A1A1A1">// returns ("Alice", "Angela")</span>
<span style="color: #5B5B5B">family.Parent</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Alice</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">John</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">.exists </span><span style="color: #A1A1A1">// returns false</span>
<span style="color: #5B5B5B">family.Parent</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">_, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">John</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">.exists </span><span style="color: #A1A1A1">// returns true</span>
<span style="color: #5B5B5B">family.Parent</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">_, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">John</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">.first?.parent </span><span style="color: #A1A1A1">// returns "Tom"</span>

<span style="color: #0057E6">for</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">sibling1, sibling2</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> family.Siblings</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">_, _</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">(</span><span style="color: #B338FF">{</span><span style="color: #AA6631">sibling1</span><span style="color: #B338FF">}</span><span style="color: #AA6631">, </span><span style="color: #B338FF">{</span><span style="color: #AA6631">sibling2</span><span style="color: #B338FF">}</span><span style="color: #AA6631">)</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>

<span style="color: #A1A1A1">// prints "(James, Angela)", "(Angela, James)"</span></code></pre>
<p><em>(Note that the order of <code>sibling1</code> and <code>sibling2</code> is significant for the inference engine - since it has no way to know the <code>Sibling</code> relation is symmetric - the results included what appears like duplicates, in the next example we'll apply <code>.distinctUnorderedPairs()</code> on the result sequence to filter out the duplicates)</em></p>
<p>A relation's fact database may be non-destructively altered using the <code>with</code> operator, applied over the containing object:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> alteredFamlily </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> family </span><span style="color: #0057E6">with</span>
<span style="color: #5B5B5B">	Parent</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Alice</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Lea</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	Parent</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Alice</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Chris</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">no</span><span style="color: #5B5B5B"> Parent</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Alice</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">James</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">for</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">sibling1, sibling2</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> alteredFamlily.Siblings</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">_, _</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">.distinctUnorderedPairs</span><span style="color: #B338FF">()</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">(</span><span style="color: #B338FF">{</span><span style="color: #AA6631">sibling1</span><span style="color: #B338FF">}</span><span style="color: #AA6631">, </span><span style="color: #B338FF">{</span><span style="color: #AA6631">sibling2</span><span style="color: #B338FF">}</span><span style="color: #AA6631">)</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>

<span style="color: #A1A1A1">// prints "(Angela, Lea)", "(Angela, Chris)", "(Lea, Chris)"</span></code></pre>
<p>Here is factorial defined as a relation:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">relation</span><span style="color: #5B5B5B"> Factorial</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">fact</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">1</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">rule</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">number: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, result: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		GreaterThan</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">number, </span><span style="color: #E65C00">0</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		Subtraction</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">number, </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> previousNumber</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		Factorial</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">previousNumber, </span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> previousFactorial</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		Product</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">number, previousFactorial, result</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Factorial</span><span style="color: #B338FF">(</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, _</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">.first</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Prints "(5, 120)"</span>
<span style="color: #5B5B5B">print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Factorial</span><span style="color: #B338FF">(</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, _</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">.first.result</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Prints "120"</span>

<span style="color: #A1A1A1">// Since Factorial is a relation we could potentially query for any one of its parameters</span>
<span style="color: #A1A1A1">// Here we'll query which number has the factorial of 5040</span>
<span style="color: #5B5B5B">print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Factorial</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">_, </span><span style="color: #E65C00">5040</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">.first</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Prints "(7, 5040)"</span>
<span style="color: #5B5B5B">print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Factorial</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">_, </span><span style="color: #E65C00">5040</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">.first?.number</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Prints "7"</span></code></pre>
<h2 id="relation-predicates%2C-functions-and-streams"><a class="header-anchor" href="#relation-predicates%2C-functions-and-streams">ยง</a>Relation predicates, functions and streams</h2>
<p>In order to express numeric relations like <code>GreaterThan</code>, <code>Subtraction</code> and <code>Product</code> we will need some means to link relations with plain functions:</p>
<ul>
<li>The <code>predicate</code> declaration defines a simple predicate function returning <code>true</code> or <code>false</code>.</li>
<li>The <code>function</code> declaration defines a simple function returning a tuple representing a single term assignment</li>
<li>The <code>stream</code> declaration defines a stream method yielding a sequence of term assignments.</li>
<li>Every relation method parameter must be annotated as either <code>in</code> or <code>out</code>, where <code>in</code> parameter must be returned unmodified in the resulting tuple and <code>out</code> parameters must receive a value.</li>
</ul>
<p>For example, here's how the <code>GreaterThan</code> relation is defined. There are several overloads defined for different combinations of input and output terms (modified by <code>in</code> and <code>out</code> respectively):</p>
<p>The <code>(in, in)</code> overload, in which both terms are known values is implemented using a predicate function, simply tests whether the first term is greater than the second one:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">relation</span><span style="color: #5B5B5B"> GreaterThan</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">predicate</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> num1: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> num2: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> num1 </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> num2</span></code></pre>
<p>The <code>(in, out)</code> overload, in which the first term is a value and the second unknown, defines a stream method yielding a sequence of tuples where the first element is always (and must always be!) <code>num1</code> and the second enumerates all the values smaller than <code>num1</code>.</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">relation</span><span style="color: #5B5B5B"> GreaterThan</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> num1: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">out</span><span style="color: #5B5B5B"> num2: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> num1 </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">advance</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">-=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num1, i</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// yields (num1, num1 - 1), (num1, num1 - 2), (num1, num1 - 3), ...</span></code></pre>
<p>The <code>(out, in)</code> overload defines a stream method yielding a sequence of tuples where the first element enumerates all the values greater than <code>num2</code> and the second is always <code>num2</code>.</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">relation</span><span style="color: #5B5B5B"> GreaterThan</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">out</span><span style="color: #5B5B5B"> num1: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> num2: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> num2 </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">advance</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">i, num2</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// yields (num2 + 1, num2), (num2 + 2, num2), (num2 + 3, num2), ...</span></code></pre>
<p>Since <code>in</code> parameters are always returned as-is in the resulting tuple, we can avoid stating them in the <code>yield</code> statement by using <code>continue</code>- like syntax, which allows omitting arguments that were not assigned by the function. The following is equivalent:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">relation</span><span style="color: #5B5B5B"> GreaterThan</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> num1: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">out</span><span style="color: #5B5B5B"> num2: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> num2 </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">advance</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> num2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> i </span><span style="color: #A1A1A1">// implicitly equivalent to yielding the tuple (num1, i)</span></code></pre>
<p><em>(An <code>(out, out)</code> overload might also be defined, in theory, though it would be significantly more challenging to implement as it would need to somehow &quot;fairly&quot; cover all possible combinations of two integers where the first one is greater than the second)</em></p>
<p>Here's how the <code>Subtraction</code> relation is defined:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">relation</span><span style="color: #5B5B5B"> Subtraction</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">predicate</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> num1: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> num2: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> difference: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span>
<span style="color: #5B5B5B">		num1 </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> num2 </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> difference</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> num1: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> num2: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">out</span><span style="color: #5B5B5B"> difference: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span>
<span style="color: #5B5B5B">		</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num1, num2, num1 </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> num2</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> num1: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">out</span><span style="color: #5B5B5B"> num2: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> difference: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span>
<span style="color: #5B5B5B">		</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num1, num1 </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> difference, difference</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">out</span><span style="color: #5B5B5B"> num1: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> num2: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> difference: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span>
<span style="color: #5B5B5B">		</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num1 </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> num2, num2, difference</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// For illustration, here's a stream method defined for the more complex</span>
<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// case where both num1 and num2 are unknowns:</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">stream</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">out</span><span style="color: #5B5B5B"> num1: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">out</span><span style="color: #5B5B5B"> num2: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> difference: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> difference, difference</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// yield the case for num1 == 0</span>

<span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// Alternate between positive and negative values for num1</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">advance</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> num1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> i, num2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> difference</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">yield</span><span style="color: #5B5B5B"> num1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #5B5B5B">i, num2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #5B5B5B">i </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> difference</span>

<span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// For the case where difference = 2 this would yield:</span>
<span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// (0, -2, 2), (1, -1, 2), (-1, -3, 2), (2, 0, 2), (-2, -4, 2), ....</span></code></pre>
<p>The <code>when</code> keyword allows branch-like functionality for relation blocks:</p>
<p>Here's the infamous &quot;Fizz-Buzz&quot; problem, this time implemented using a relation:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">relation</span><span style="color: #5B5B5B"> Divides</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">predicate</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> x, </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> y</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span>

<span style="color: #0057E6">relation</span><span style="color: #5B5B5B"> FizzBuzz</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">rule</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">index: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, output: </span><span style="color: #0057E6">string</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		InRange</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">index, </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">infinity</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">		</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> Divides</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">index, </span><span style="color: #E65C00">15</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">			Equals</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">output, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">FizzBuzz</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> Divides</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">index, </span><span style="color: #E65C00">3</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">			Equals</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">output, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Fizz</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> Divides</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">index, </span><span style="color: #E65C00">5</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">			Equals</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">output, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Buzz</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">otherwise</span>
<span style="color: #5B5B5B">			Equals</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">output, </span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">{</span><span style="color: #AA6631">index</span><span style="color: #B338FF">}</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">FizzBuzz</span><span style="color: #B338FF">(</span><span style="color: #E65C00">30</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Buzz</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">.exists </span><span style="color: #A1A1A1">// returns false</span>
<span style="color: #5B5B5B">FizzBuzz</span><span style="color: #B338FF">(</span><span style="color: #E65C00">30</span><span style="color: #5B5B5B">, _</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">.exists </span><span style="color: #A1A1A1">// returns true</span>
<span style="color: #5B5B5B">FizzBuzz</span><span style="color: #B338FF">(</span><span style="color: #E65C00">30</span><span style="color: #5B5B5B">, _</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">.first?.output </span><span style="color: #A1A1A1">// returns "FizzBuzz"</span>
<span style="color: #5B5B5B">FizzBuzz</span><span style="color: #B338FF">(</span><span style="color: #E65C00">30</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">FizzBuzz</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">.exists </span><span style="color: #A1A1A1">// returns true</span>

<span style="color: #0057E6">for</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">_, str</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> FizzBuzz</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">_, _</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">str</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// prints "1", "2", "Fizz", "4", "Buzz", "Fizz" ....</span></code></pre>
<p><code>when</code> blocks also handle cases where the conditional cannot be resolved:</p>
<p>For example, in the case where <code>FizzBuzz(_, &quot;Fizz&quot;)</code> is queried, since <code>index</code> isn't bound to anything on the <code>when</code> conditional, the inference engine unconditionally evaluates the branch, as well as any other unresolvable conditional branches, which in this example includes all of them (the <code>otherwise</code> branch is considered unresolvable as well):</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">index, _</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> FizzBuzzer.FizzBuzz</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">_, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Fizz</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">index</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// prints 3, 6, 9, 12, 18, 21, ....</span></code></pre>
<p>Here's the absolute value implemented as a relation using a <code>when</code> conditional:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">relation</span><span style="color: #5B5B5B"> Abs</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">rule</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">number: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, abs: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> GreaterThanOrEquals</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">number, </span><span style="color: #E65C00">0</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">			Equals</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">number, abs</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">otherwise</span>
<span style="color: #5B5B5B">			Negation</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">number, </span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> negation</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">			Equals</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">abs, negation</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">Abs</span><span style="color: #B338FF">(</span><span style="color: #000000">-</span><span style="color: #E65C00">65</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">100</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">.exists </span><span style="color: #A1A1A1">// returns false</span>
<span style="color: #5B5B5B">Abs</span><span style="color: #B338FF">(</span><span style="color: #000000">-</span><span style="color: #E65C00">65</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">65</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">.exists </span><span style="color: #A1A1A1">// returns true</span>
<span style="color: #5B5B5B">Abs</span><span style="color: #B338FF">(</span><span style="color: #000000">-</span><span style="color: #E65C00">65</span><span style="color: #5B5B5B">, _</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">.first?.abs </span><span style="color: #A1A1A1">// returns 65</span>
<span style="color: #5B5B5B">Abs</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">_, </span><span style="color: #E65C00">65</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">.first?.number </span><span style="color: #A1A1A1">// returns -65</span>

<span style="color: #A1A1A1">// This will query for any two numbers where the second is the absolute value of the first:</span>
<span style="color: #0057E6">for</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">number, abs</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> Abs</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">_, _</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">(</span><span style="color: #B338FF">{</span><span style="color: #AA6631">number</span><span style="color: #B338FF">}</span><span style="color: #AA6631">, </span><span style="color: #B338FF">{</span><span style="color: #AA6631">abs</span><span style="color: #B338FF">}</span><span style="color: #AA6631">)</span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// prints "(0, 0)", "(-1, 1)", "(1, -1)", "(-2, 2)", ....</span>

<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// (As a heuristic, the inference engine alternates between the unresolvable conditional branches to</span>
<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">//  avoid getting "trapped" in case one of them produces an infinite amount of results)</span></code></pre>
<p>Sometimes we would like to iterate over <strong>all</strong> the possible results of a relation. A common case would be when asserting over a property of a list:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">relation</span><span style="color: #5B5B5B"> MemberOf</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">predicate</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> member, </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> list: List</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> list.includes</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">member</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">out</span><span style="color: #5B5B5B"> member, </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> list: List</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> x </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> list </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x, list</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">relation</span><span style="color: #5B5B5B"> AllMembersGreaterThan</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">rule</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> list: List</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">, smallerValue: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">foreach</span><span style="color: #5B5B5B"> MemberOf</span><span style="color: #B338FF">(</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> member, list</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">			GreaterThan</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">member, smallerValue</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">AllMembersGreaterThan</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">[</span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">], </span><span style="color: #E65C00">3</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">.exists </span><span style="color: #A1A1A1">// returns false</span>
<span style="color: #5B5B5B">AllMembersGreaterThan</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">[</span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">], </span><span style="color: #000000">-</span><span style="color: #E65C00">5</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">.exists </span><span style="color: #A1A1A1">// returns true</span></code></pre>
<p>It would be interesting to consider the query <code>AllMembersGreaterThan([3, 2, 4, 5], _)</code>, which asks for one or more values that are smaller than all the elements of the list.</p>
<p>Let's consider the execution of:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #5B5B5B">AllMembersGreaterThan</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">[</span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">], _</span><span style="color: #B338FF">)</span></code></pre>
<p>If we were to unroll the <code>foreach</code> loop to multiple steps it would look somewhat like:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #5B5B5B">GreaterThan</span><span style="color: #B338FF">(</span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, smallerValue</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Produces 2, 1, 0, -1, -2, -3, .... for smallerValue</span>
<span style="color: #5B5B5B">GreaterThan</span><span style="color: #B338FF">(</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, smallerValue</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">GreaterThan</span><span style="color: #B338FF">(</span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, smallerValue</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">GreaterThan</span><span style="color: #B338FF">(</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, smallerValue</span><span style="color: #B338FF">)</span></code></pre>
<p>Once <code>smallerValue</code> receives a value in <code>GreaterThan(3, _)</code> the next evaluations of <code>GreaterThan</code> test for that value. If it doesn't satisfy them, the inference engine backtracks until a value for <code>smallerValue</code> is found that satisfies all the members (i.e. in this case <code>1</code>, which is smaller than all the members).</p>
<p>As you may notice this is a highly inefficient way to calculate this! Consider the case where <code>list = [3, 2, 4, -1000000]</code>, it would require more than one million backtracking attempts to find the first satisfying result <code>-1000001</code>!</p>
<p>A more efficient way would be to to define an overload based on a <code>relation function</code> that quickly finds the minimum of the list and yields all the values smaller than it:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">relation</span><span style="color: #5B5B5B"> AllMembersGreaterThan</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> list: List</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">out</span><span style="color: #5B5B5B"> smallerValue: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">list.minimum</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">..</span><span style="color: #B338FF">(</span><span style="color: #000000">-</span><span style="color: #0057E6">infinity</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">list, i</span><span style="color: #B338FF">)</span></code></pre>
<p>Note that to ensure that the <code>(in, out)</code> case is never processed by the slower, backtracking-based overload, its <code>smallerValue</code> parameter can be marked as <code>in</code>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">relation</span><span style="color: #5B5B5B"> AllMembersGreaterThan</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">rule</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> list: List</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> smallerValue: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	....</span></code></pre>
<p>In the next section we'll show a purely rule-based way to efficiently implement the <code>AllMembersGreaterThan</code> relation, which makes use of the <code>reduce</code> higher-order relation.</p>
<h2 id="higher-order-relations"><a class="header-anchor" href="#higher-order-relations">ยง</a>Higher-order relations</h2>
<p>Just like functions can accept other functions as arguments, we can define relations that accept other relations as arguments:</p>
<p>Here's an implementation of the <code>map</code> function, generalized to a relation:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">relation</span><span style="color: #5B5B5B"> Mapped</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">E, R</span><span style="color: #000000">&gt;</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">type</span><span style="color: #5B5B5B"> MappingRelation </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">relation</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">value: E, resultValue: R</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">fact</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">[], [], _</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">rule</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">[head, ...tail]: List</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">E</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">, [resultHead,...resultTail]: List</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">R</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> mappingRelation: MappingRelation</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		mappingRelation</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">head, resultHead</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		Mapped</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">tail, resultTail</span><span style="color: #B338FF">)</span></code></pre>
<p>Here's an example that represents a mapping between one list to a second list containing its members' preceding values:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">relation</span><span style="color: #5B5B5B"> Successor</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">predicate</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> x: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> y: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> x: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">out</span><span style="color: #5B5B5B"> y: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">x, y </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">out</span><span style="color: #5B5B5B"> x: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> y: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">y </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, y</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> l1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">]</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> l2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">]</span>
<span style="color: #5B5B5B">Mapped</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">l1, l2, Successor</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">.exists </span><span style="color: #A1A1A1">// returns true</span>
<span style="color: #5B5B5B">Mapped</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">l1, _, Successor</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">.first </span><span style="color: #A1A1A1">// returns ([2, 3, 4, 5], [1, 2, 3, 4], Successor)</span>
<span style="color: #5B5B5B">Mapped</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">l1, _, Successor</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">.first?[</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// returns [1, 2, 3, 4]</span>
<span style="color: #5B5B5B">Mapped</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">_, l2, Successor</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">.first?[</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// returns [2, 3, 4, 5]</span>
<span style="color: #5B5B5B">Mapped</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">_, l1, Successor</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">.first?[</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// returns [3, 4, 5, 6]</span></code></pre>
<p>Here's <code>reduce</code> expressed as a higher order relation:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">relation</span><span style="color: #5B5B5B"> Reduced</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">E, R</span><span style="color: #000000">&gt;</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">type</span><span style="color: #5B5B5B"> ReducingRelation </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">relation</span><span style="color: #B338FF">(</span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> element: E, </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> currentResult: R, newResult: R</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">fact</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">[], _, _, </span><span style="color: #0057E6">nothing</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">rule</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> [head, ...tail]: List</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">E</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> reducer: ReducingRelation, </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> initialResult: R, result: R</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		reducer</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">head, initialResult, </span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> newResult</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">		</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> Equals</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">tail, []</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">			Equals</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">result, newResult</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">otherwise</span>
<span style="color: #5B5B5B">			Reduced</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">tail, reducer, newResult, result</span><span style="color: #B338FF">)</span></code></pre>
<p>Using the <code>reduced</code> relation we now can provide a more efficient rule-based implementation for <code>AllMembersGreaterThan</code>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">relation</span><span style="color: #5B5B5B"> MinimumOf2</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">val1: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, val2: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, minimum: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> SmallerOrEqual</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">val1, val2</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		Equals</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">minimum, val1</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">otherwise</span>
<span style="color: #5B5B5B">		Equals</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">minimum, val2</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">relation</span><span style="color: #5B5B5B"> SmallestValue</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">fact</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">[], </span><span style="color: #0057E6">nothing</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">rule</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> values: List</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">, smallestValue: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		Reduced</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">values, MinimumOf2, </span><span style="color: #0057E6">infinity</span><span style="color: #5B5B5B">, smallestValue</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">relation</span><span style="color: #5B5B5B"> AllMembersGreaterThan</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">rule</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> values: List</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">, smallerValue: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		SmallestValue</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">list, </span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> smallestValue</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		SmallerThan</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">smallestValue, smallerValue</span><span style="color: #B338FF">)</span></code></pre>
<h2 id="immutability-and-determinism-in-the-logic-programming-subsystem"><a class="header-anchor" href="#immutability-and-determinism-in-the-logic-programming-subsystem">ยง</a>Immutability and determinism in the logic programming subsystem</h2>
<p>The logic programming subsystem is fully compliant with the immutability constraint. A rule's arguments can be either assigned (meaning they are bound to a concrete value) or unassigned. If they are assigned they cannot accept a new value (there's simply no mechanism to do that) and if they are unassigned they can only be assigned once by a subgoal.</p>
<p>Determinism (which is related to the property of referential transparency), means that an invocation of a relation with the same arguments would always yield the same results, and in the same order. Determinism is preserved since:</p>
<ul>
<li>There is no <code>action relation</code>. Relations do not have any side-effects.</li>
<li>Objects containing relations cannot be modified in-place. Facts cannot be added or removed from a relation unless the object is copied first (as is done with the <code>with</code> operator).</li>
<li>The inference engine is designed to always perform the search in the same order (even if the search is parallelized), so given the same clauses and fact database, it would always produce identical results (note it is meant that it would produce the same results <strong>for a given runtime session</strong>, changes in the ordering of declarations or files, or different versions of the compiler, might cause variations in the ordering).</li>
</ul>
<h1 id="patterns-and-parsers"><a class="header-anchor" href="#patterns-and-parsers">ยง</a>Patterns and parsers</h1>
<h2 id="pattern-methods"><a class="header-anchor" href="#pattern-methods">ยง</a>Pattern methods</h2>
<p>We've previously introduced a syntax for list, tuple and object patterns, which can be used for pattern matching in conditional statements and expressions, such as:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> myList</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> []</span>
<span style="color: #5B5B5B">		....</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> [</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> head </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, ...]</span>
<span style="color: #5B5B5B">		....</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">25</span><span style="color: #5B5B5B">, ..., </span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> last]</span>
<span style="color: #5B5B5B">		....</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> [_ </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> ...tail]</span>
<span style="color: #5B5B5B">		....</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> [</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> first </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> second </span><span style="color: #000000">!=</span><span style="color: #5B5B5B"> first, </span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> ...rest]</span>
<span style="color: #5B5B5B">		....</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> [..., </span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> v </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, ...]</span>
<span style="color: #5B5B5B">		....</span></code></pre>
<p><strong>Pattern methods</strong> generalize over this feature, and allow to define arbitrary pattern recognizers via special-purpose subroutine-like helpers.</p>
<p>Pattern methods can also be used as a full replacement for string regular expressions.</p>
<p>For instance, we'll look at a regular expression that captures a phone number pattern. Conventionally we'll define something like:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> PhoneNumberRegExp </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #000000">/</span><span style="color: #5B5B5B">^[\</span><span style="color: #000000">+</span><span style="color: #5B5B5B">]?[ ]?</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">[</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">][</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">]?[</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">]?</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">[ ]?\</span><span style="color: #B338FF">((</span><span style="color: #5B5B5B">[</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">][</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">][</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">]</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">\</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">[ ]?</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">[</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">][</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">][</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">]</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">\</span><span style="color: #000000">-</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">[</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">][</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">][</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">][</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">]</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">$</span><span style="color: #000000">/</span>

<span style="color: #A1A1A1">// Example matching string: "+1 (534) 953-6345"</span>

<span style="color: #0057E6">match</span><span style="color: #5B5B5B"> str</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> PhoneNumberRegExp </span><span style="color: #0057E6">of</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">1</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">800</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, _, </span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> lineNumber</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		....</span></code></pre>
<p>With a pattern method, we could instead write:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> str</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> PhoneNumberPattern </span><span style="color: #0057E6">of</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">1</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">800</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, _, </span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> lineNumber</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		....</span></code></pre>
<p>Where <code>PhoneNumberPattern</code> would be a pattern method defined as:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">pattern</span><span style="color: #5B5B5B"> PhoneNumberPattern</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">of</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">countryCode, areaCode, areaCode, prefix, lineNumber</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">optional</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">+</span><span style="color: #5B5B5B">'</span>
<span style="color: #5B5B5B">	countryCode </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> Repeated</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Digit, </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">optional</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631"> </span><span style="color: #5B5B5B">'</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">(</span><span style="color: #5B5B5B">'</span>
<span style="color: #5B5B5B">	areaCode </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> Repeated</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Digit, </span><span style="color: #E65C00">3</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">)</span><span style="color: #5B5B5B">'</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">optional</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631"> </span><span style="color: #5B5B5B">'</span>
<span style="color: #5B5B5B">	prefix </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> Repeated</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Digit, </span><span style="color: #E65C00">3</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">-</span><span style="color: #5B5B5B">'</span>
<span style="color: #5B5B5B">	lineNumber </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> Repeated</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Digit, </span><span style="color: #E65C00">4</span><span style="color: #B338FF">)</span></code></pre>
<p>A pattern method is written similarly to a standard method only it employs the <code>accept</code> keyword which implicitly &quot;advances&quot; the recognizer whenever a pattern is matched:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #5B5B5B">.... </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> .... </span><span style="color: #A1A1A1">// Require the next member of the stream to match the given pattern and return it</span>
<span style="color: #5B5B5B">.... </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">optional</span><span style="color: #5B5B5B"> ....  </span><span style="color: #A1A1A1">// Try to match the given pattern and return it, or skip if failed</span></code></pre>
<p>In the above example, <code>Repeated</code> and <code>Digit</code> are references to secondary pattern methods.</p>
<p><code>Digit</code> can be defined as:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">pattern</span><span style="color: #5B5B5B"> Digit</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">of</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">value</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	value </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">if</span><span style="color: #5B5B5B"> _ </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">{</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">0</span><span style="color: #5B5B5B">'</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">1</span><span style="color: #5B5B5B">'</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">2</span><span style="color: #5B5B5B">'</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">3</span><span style="color: #5B5B5B">'</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">4</span><span style="color: #5B5B5B">'</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">5</span><span style="color: #5B5B5B">'</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">6</span><span style="color: #5B5B5B">'</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">7</span><span style="color: #5B5B5B">'</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">8</span><span style="color: #5B5B5B">'</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">9</span><span style="color: #5B5B5B">'</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">}</span></code></pre>
<p><code>accept if ....</code> will accept only if the given condition is satisfied. The <code>_</code> has semantics similar to how its used in pattern matching, i.e. analogous to what it would mean in a pattern like <code>[_ &gt;= 10, ...]</code> where it contextually matches the corresponding element of a list.</p>
<p><code>Repeated</code> is a more complex, higher-order pattern method parameterized over any underlying pattern, as well as for any stream type (which includes strings):</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">pattern</span><span style="color: #5B5B5B"> Repeated</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T, R</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">p: Pattern</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T, R</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">, minTimes: </span><span style="color: #0057E6">integer</span><span style="color: #5B5B5B">, maxTimes: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">of</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">results: List</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">R</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> []</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> Stream</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T</span><span style="color: #000000">&gt;</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">if</span><span style="color: #5B5B5B"> minTimes </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> _ </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..minTimes</span>
<span style="color: #5B5B5B">			results </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> p</span>
<span style="color: #5B5B5B">			</span><span style="color: #A1A1A1">// `results` acts similarly to a named return variable</span>
<span style="color: #5B5B5B">			</span><span style="color: #A1A1A1">// It can be incrementally updated,</span>
<span style="color: #5B5B5B">			</span><span style="color: #A1A1A1">// However, it can only be read when assigned back to itself</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> _ </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> minTimes..maxTimes</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">try</span>
<span style="color: #5B5B5B">			results </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> p</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">else</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">break</span>

<span style="color: #0057E6">pattern</span><span style="color: #5B5B5B"> Repeated</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T, R</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">p: Pattern</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T, R</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">, times: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">of</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">results: List</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">R</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> []</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	results </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> Repeated</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T, R</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">p, times, times</span><span style="color: #B338FF">)</span></code></pre>
<p><code>try</code>... <code>otherwise</code> enables a limited form of <strong>transactional execution</strong> where multiple branches are attempted in turn until one of them succeeds (or otherwise the pattern is entirely rejected). Whenever a failure occurs within a branch, its assignments are rolled back.</p>
<p>Here's an second illustrative example which will recognize and parse a date with any one of <code>'/'</code>, <code>'-'</code> or <code>'.'</code> as separator characters:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">pattern</span><span style="color: #5B5B5B"> Date</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">of</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">day, month, year</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Will recognize a date like "21/5/1999" or "13-7-2020"</span>
<span style="color: #5B5B5B">	day </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> IntegerNumber</span><span style="color: #B338FF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">31</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">try</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">/</span><span style="color: #5B5B5B">'</span>
<span style="color: #5B5B5B">		month </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> IntegerNumber</span><span style="color: #B338FF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">12</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">/</span><span style="color: #5B5B5B">'</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">else</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">try</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">-</span><span style="color: #5B5B5B">'</span>
<span style="color: #5B5B5B">		month </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> IntegerNumber</span><span style="color: #B338FF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">12</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">-</span><span style="color: #5B5B5B">'</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">else</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">try</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">.</span><span style="color: #5B5B5B">'</span>
<span style="color: #5B5B5B">		month </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> IntegerNumber</span><span style="color: #B338FF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">12</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">.</span><span style="color: #5B5B5B">'</span>

<span style="color: #5B5B5B">	year </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> IntegerNumber</span>

<span style="color: #0057E6">match</span><span style="color: #5B5B5B"> str</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Date </span><span style="color: #0057E6">of</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">12</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> year </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2005</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		....</span></code></pre>
<p>Pattern methods can recognize and parse patterns that go well beyond the constraints of regular languages.</p>
<p>We could rewrite the previous example such that the pattern method would be parameterized by an arbitrary set of separator characters:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">pattern</span><span style="color: #5B5B5B"> Date</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">seperatorCharacterSet: Set</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">string</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">of</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">day, month, year</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	day </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> IntegerNumber</span><span style="color: #B338FF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">31</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> seperator </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">if</span><span style="color: #5B5B5B"> _ </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> seperatorCharacterSet</span>
<span style="color: #5B5B5B">	month </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> IntegerNumber</span><span style="color: #B338FF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">12</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> separator </span><span style="color: #A1A1A1">// The accepted character must be the same as the one previously captured</span>

<span style="color: #5B5B5B">	year </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> IntegerNumber</span>

<span style="color: #0057E6">match</span><span style="color: #5B5B5B"> str</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> Date</span><span style="color: #B338FF">({</span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">/</span><span style="color: #5B5B5B">'</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">-</span><span style="color: #5B5B5B">'</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">.</span><span style="color: #5B5B5B">'</span><span style="color: #B338FF">})</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">of</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">12</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> year </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2005</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">		....</span></code></pre>
<p>Pattern methods can be used for arbitrary streams. Here it is used to recognize patterns in sequences of integers.</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #A1A1A1">// Recognizes three primes p1, p2, p3</span>
<span style="color: #0057E6">pattern</span><span style="color: #5B5B5B"> ThreePrimes</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> Stream</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">predicate</span><span style="color: #5B5B5B"> isPrime</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">num</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> ....</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> _ </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">3</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">if</span><span style="color: #5B5B5B"> isPrime</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">_</span><span style="color: #B338FF">)</span>

<span style="color: #A1A1A1">// Recognizes 1, 2, 3, 4, 5, ....</span>
<span style="color: #0057E6">pattern</span><span style="color: #5B5B5B"> NaturalNumberSeries</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> Stream</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">if</span><span style="color: #5B5B5B"> _ </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> i</span></code></pre>
<p>XML Recognizer and parser:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">pattern</span><span style="color: #5B5B5B"> XMLAttributeStringLiteral </span><span style="color: #0057E6">of</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">content</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">"</span><span style="color: #5B5B5B">'</span>
<span style="color: #5B5B5B">	content </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> AnythingUntil</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">"</span><span style="color: #5B5B5B">'</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">"</span><span style="color: #5B5B5B">'</span>

<span style="color: #0057E6">pattern</span><span style="color: #5B5B5B"> XMLAttribute</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">of</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">identifier, value</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	identifier </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> Identifier</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">try</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">=</span><span style="color: #5B5B5B">'</span>
<span style="color: #5B5B5B">		value </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> XMLAttributeStringLiteral</span>

<span style="color: #0057E6">pattern</span><span style="color: #5B5B5B"> XMLOpeningTag</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">of</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">tagName, attributes: List</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">Attribute</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> []</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">&lt;</span><span style="color: #5B5B5B">'</span>
<span style="color: #5B5B5B">	tagName </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> Identifier</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">forever</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">try</span>
<span style="color: #5B5B5B">			attributes </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> XMLAttribute</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">else</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">break</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">&gt;</span><span style="color: #5B5B5B">'</span>

<span style="color: #0057E6">pattern</span><span style="color: #5B5B5B"> XMLClosingTag</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">of</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">tagName</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">&lt;/</span><span style="color: #5B5B5B">'</span>
<span style="color: #5B5B5B">	tagName </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> Identifier</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">&gt;</span><span style="color: #5B5B5B">'</span>

<span style="color: #0057E6">pattern</span><span style="color: #5B5B5B"> XMLEmptyTag</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">of</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">tagName</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">&lt;</span><span style="color: #5B5B5B">'</span>
<span style="color: #5B5B5B">	tagName </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> Identifier</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631"> /&gt;</span><span style="color: #5B5B5B">'</span>

<span style="color: #0057E6">pattern</span><span style="color: #5B5B5B"> XMLComment</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">of</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">commentBody</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">&lt;!--</span><span style="color: #5B5B5B">'</span>
<span style="color: #5B5B5B">	commentBody </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> AnythingUntil</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">--&gt;</span><span style="color: #5B5B5B">'</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">--&gt;</span><span style="color: #5B5B5B">'</span>

<span style="color: #0057E6">pattern</span><span style="color: #5B5B5B"> XMLElement</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> XMLOpeningTag </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> XMLClosingTag </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> XMLEmptyTag </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> XMLComment</span>

<span style="color: #0057E6">pattern</span><span style="color: #5B5B5B"> XMLText</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> AnythingUntil</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">'</span><span style="color: #AA6631">&lt;</span><span style="color: #5B5B5B">'</span><span style="color: #B338FF">)</span>

<span style="color: #0057E6">pattern</span><span style="color: #5B5B5B"> XMLDocument</span><span style="color: #B338FF">()</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">string</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">forever</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">try</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> XMLElement</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">else</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">try</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> XMLText</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">else</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">break</span>

<span style="color: #0057E6">pattern</span><span style="color: #5B5B5B"> AnythingUntil</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">StopPattern: Pattern</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">of</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">results: List</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T</span><span style="color: #000000">&gt;</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> Stream</span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B">T</span><span style="color: #000000">&gt;</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">forever</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">try</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">accept</span><span style="color: #5B5B5B"> StopPattern</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">reject</span><span style="color: #5B5B5B"> </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">break</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Roll back if stop pattern encountered and break out of the loop</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">else</span>
<span style="color: #5B5B5B">			results </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">accept</span></code></pre>
<h2 id="unpacking-through-a-pattern-method"><a class="header-anchor" href="#unpacking-through-a-pattern-method">ยง</a>Unpacking through a pattern method</h2>
<p>Since pattern methods may reject some inputs, it is not possible to directly unpack via a pattern, say, with this kind of hypothetical syntax:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> str </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">5/11/1972</span><span style="color: #5B5B5B">"</span>

<span style="color: #5B5B5B">Date </span><span style="color: #0057E6">of</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">day, month, year</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> str </span><span style="color: #A1A1A1">// What would be assigned if the string is rejected?</span></code></pre>
<p>Instead, the <code>matches</code> operator, introduced in a previous chapter, allows to conditionally &quot;unpack&quot; through the pattern, as well as safely handle the case where the input is rejected:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> str </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">5/11/1972</span><span style="color: #5B5B5B">"</span>

<span style="color: #0057E6">if</span><span style="color: #5B5B5B"> str </span><span style="color: #0057E6">matches</span><span style="color: #5B5B5B"> Date </span><span style="color: #0057E6">of</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">day, month, year</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	....</span>
<span style="color: #0057E6">else</span>
<span style="color: #5B5B5B">	....</span></code></pre>
<h1 id="symbolic-data-structures"><a class="header-anchor" href="#symbolic-data-structures">ยง</a>Symbolic data structures</h1>
<h2 id="symbolic-structures"><a class="header-anchor" href="#symbolic-structures">ยง</a>Symbolic structures</h2>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">symbolic</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">atom</span><span style="color: #5B5B5B"> Term</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0057E6">integer</span>
<span style="color: #0057E6">symbolic</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> Plus</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: Term, b: Term</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: Term</span>
<span style="color: #0057E6">symbolic</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> Minus</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: Term, b: Term</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: Term</span>
<span style="color: #0057E6">symbolic</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> Expression</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: Term, b: Term</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: Term</span>
<span style="color: #0057E6">symbolic</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> Sqrt</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: Term</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: Term</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Sqrt</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Minus</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Plus</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">Term</span><span style="color: #B338FF">(</span><span style="color: #E65C00">5</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">, Term</span><span style="color: #B338FF">(</span><span style="color: #E65C00">10</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B">, Term</span><span style="color: #B338FF">(</span><span style="color: #E65C00">4</span><span style="color: #B338FF">)))</span>

<span style="color: #0057E6">unique</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">type</span><span style="color: #5B5B5B"> Expression </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Plus: </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: Expression, b: Expression</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">or</span>
<span style="color: #5B5B5B">					  Minus: </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: Expression, b: Expression</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">or</span>
<span style="color: #5B5B5B">					  Literal: </span><span style="color: #0057E6">integer</span></code></pre>
<p>Symbolic operators:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">symbolic</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">atom</span><span style="color: #5B5B5B"> Term: </span><span style="color: #0057E6">integer</span>
<span style="color: #0057E6">symbolic</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">operator</span><span style="color: #5B5B5B"> </span><span style="color: #000000">+</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: Term, b: Term</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: Term</span>
<span style="color: #0057E6">symbolic</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">operator</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: Term, b: Term</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: Term</span>
<span style="color: #0057E6">symbolic</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> Sqrt</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">a: Term</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: Term</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Sqrt</span><span style="color: #B338FF">((</span><span style="color: #5B5B5B">Term</span><span style="color: #B338FF">(</span><span style="color: #E65C00">5</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> Term</span><span style="color: #B338FF">(</span><span style="color: #E65C00">10</span><span style="color: #B338FF">))</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> Term</span><span style="color: #B338FF">(</span><span style="color: #E65C00">4</span><span style="color: #B338FF">))</span></code></pre>
<h1 id="misc.-topics"><a class="header-anchor" href="#misc.-topics">ยง</a>Misc. topics</h1>
<h2 id="lists-and-streams-as-indices-for-array-slicing"><a class="header-anchor" href="#lists-and-streams-as-indices-for-array-slicing">ยง</a>Lists and streams as indices for array slicing</h2>
<p>A list can be sliced using secondary list to specify the indices to copy:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> nums </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">20</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">30</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">40</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">50</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">60</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">70</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">80</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">90</span><span style="color: #5B5B5B">]</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> indexes </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">7</span><span style="color: #5B5B5B">]</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> nums[indexes] </span><span style="color: #A1A1A1">// result = [50, 30, 70]</span></code></pre>
<p>In general, the same effect can be achieved using any stream of integers:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> nums </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">20</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">30</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">40</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">50</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">60</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">70</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">80</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">90</span><span style="color: #5B5B5B">]</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> indexStream </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> i % </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> i</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> nums[indexStream] </span><span style="color: #A1A1A1">// result = [90, 60, 30]</span></code></pre>
<p>And for modifying an existing list:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> nums </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">20</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">30</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">40</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">50</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">60</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">70</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">80</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">90</span><span style="color: #5B5B5B">]</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> indexStream </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #0057E6">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0057E6">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">where</span><span style="color: #5B5B5B"> i % </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> i</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> modifiedNums </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> nums </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> [indexStream] </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">900</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">600</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">300</span><span style="color: #5B5B5B">]</span>
<span style="color: #A1A1A1">// modifiedNums = [10, 20, 300, 40, 50, 600, 70, 80, 900]</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> indicesToRemove </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">7</span><span style="color: #5B5B5B">]</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> modifiedNums2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> modifiedNums </span><span style="color: #0057E6">with</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">no</span><span style="color: #5B5B5B"> [indicesToRemove]</span>
<span style="color: #A1A1A1">// modifiedNums2 = [10, 20, 300, 600, 80, 900]</span></code></pre>
<h2 id="recursion-sugar-and-the-param-modifier"><a class="header-anchor" href="#recursion-sugar-and-the-param-modifier">ยง</a>Recursion sugar and the <code>param</code> modifier</h2>
<p>So far, we've tried to design convenient loops and comprehensions that abstract over recursive iteration patterns. We can also take some of those ideas back on the other direction - to make plain recursions simpler and more convenient to use.</p>
<p>The <code>recurse</code> keyword acts a lot like <code>continue</code> by allowing to only state the alterations needed for a recursive call, relative to the method's received argument set. In this example the return value is a named tuple, who's members double as parameters by being declared with the <code>param</code> keyword:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> repeatAandB</span><span style="color: #B338FF">(</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> count: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B338FF">(</span><span style="color: #0057E6">param</span><span style="color: #5B5B5B"> r1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">""</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">param</span><span style="color: #5B5B5B"> r2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">""</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">return</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">recurse</span><span style="color: #5B5B5B"> count </span><span style="color: #000000">-=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, r1 </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">a</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, r2 </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">b</span><span style="color: #5B5B5B">"</span>

<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">r1, r2</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> repeatAandB</span><span style="color: #B338FF">(</span><span style="color: #E65C00">4</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// r1 = "aaaa", r2 = "bbbb"</span></code></pre>
<p><em>(Technical note: for convenience <code>return</code> can be used both as a statement and expression in a <code>case</code> and <code>when</code> clause body)</em></p>
<p>Note that by modifying the returned tuple members with the <code>param</code> keyword, they act like any other parameter and can be passed arguments when the method is called:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">r1, r2</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> repeatAandB</span><span style="color: #B338FF">(</span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, r1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hello </span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, r2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">World </span><span style="color: #5B5B5B">"</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// r1 = "Hello aaaa", r2 = "World bbbb"</span></code></pre>
<p>With these features, combined with named return values, we can further simplify the recursive binary search code from a previous chapter:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> binarySearch</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">values: List</span><span style="color: #000000">&lt;</span><span style="color: #0057E6">integer</span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B">, target: </span><span style="color: #0057E6">integer</span><span style="color: #B338FF">)</span>
<span style="color: #5B5B5B">	</span><span style="color: #0057E6">function</span><span style="color: #5B5B5B"> iterate</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">low </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, high </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> values.length</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">mid </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> low </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> high </span><span style="color: #000000">/</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B">?</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">when</span><span style="color: #5B5B5B"> low </span><span style="color: #000000">&gt;</span><span style="color: #5B5B5B"> high</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">nothing</span>
<span style="color: #5B5B5B">		</span><span style="color: #0057E6">otherwise</span>
<span style="color: #5B5B5B">			</span><span style="color: #0057E6">match</span><span style="color: #5B5B5B"> values[mid]</span>
<span style="color: #5B5B5B">				</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> target </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">return</span>
<span style="color: #5B5B5B">				</span><span style="color: #0057E6">case</span><span style="color: #5B5B5B"> _ </span><span style="color: #000000">&lt;</span><span style="color: #5B5B5B"> target </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">recurse</span><span style="color: #5B5B5B"> low </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> mid </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>
<span style="color: #5B5B5B">				</span><span style="color: #0057E6">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=&gt;</span><span style="color: #5B5B5B"> </span><span style="color: #0057E6">recurse</span><span style="color: #5B5B5B"> high </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> mid </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span>

<span style="color: #5B5B5B">	</span><span style="color: #0057E6">return</span><span style="color: #5B5B5B"> iterate</span><span style="color: #B338FF">()</span></code></pre>
<h2 id="deep-comparison"><a class="header-anchor" href="#deep-comparison">ยง</a>Deep comparison</h2>
<p>Comparisons are always done by value and traverse deep structural hierarchies:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span style="color: #0057E6">let</span><span style="color: #5B5B5B"> t1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hi</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">true</span><span style="color: #5B5B5B">, [</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">]</span><span style="color: #B338FF">)</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> t2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hi</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">true</span><span style="color: #5B5B5B">, [</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">]</span><span style="color: #B338FF">)</span>
<span style="color: #0057E6">let</span><span style="color: #5B5B5B"> t3 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B338FF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">"</span><span style="color: #AA6631">Hi</span><span style="color: #5B5B5B">"</span><span style="color: #5B5B5B">, </span><span style="color: #0057E6">true</span><span style="color: #5B5B5B">, [</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">]</span><span style="color: #B338FF">)</span>

<span style="color: #5B5B5B">print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">t1 </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> t2</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints true</span>
<span style="color: #5B5B5B">print</span><span style="color: #B338FF">(</span><span style="color: #5B5B5B">t2 </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> t3</span><span style="color: #B338FF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints false</span></code></pre>
<h1 id="todo"><a class="header-anchor" href="#todo">ยง</a>TODO</h1>
<h2 id="namespaces"><a class="header-anchor" href="#namespaces">ยง</a>Namespaces</h2>
<h2 id="modules"><a class="header-anchor" href="#modules">ยง</a>Modules</h2>
<h2 id="attributes"><a class="header-anchor" href="#attributes">ยง</a>Attributes</h2>
<h2 id="infix-functions"><a class="header-anchor" href="#infix-functions">ยง</a>Infix functions</h2>
<h2 id="reflection"><a class="header-anchor" href="#reflection">ยง</a>Reflection</h2>
<h2 id="memoization"><a class="header-anchor" href="#memoization">ยง</a>Memoization</h2>
<h2 id="compile-time-execution"><a class="header-anchor" href="#compile-time-execution">ยง</a>Compile-time execution</h2>
<h1 id="closing-chapter"><a class="header-anchor" href="#closing-chapter">ยง</a>Closing chapter</h1>
<h2 id="influences"><a class="header-anchor" href="#influences">ยง</a>Influences</h2>
<p>This work would not have been possible without ideas adapted from other languages: in particular C#, Python, JavaScript, TypeScript, Haskell, F#, Quorum, Swift, Scala, Prolog, Java, Oz and Pascal.</p>
<h2 id="who-wrote-this%3F"><a class="header-anchor" href="#who-wrote-this%3F">ยง</a>Who wrote this?</h2>
<p>Hi, I'm a self-taught software developer who loves designing programming languages.</p>
<h2 id="feedback-for-this-document"><a class="header-anchor" href="#feedback-for-this-document">ยง</a>Feedback for this document</h2>
<p>The repository is located at <a href="https://github.com/island-lang/island-lang.github.io">github.com/island-lang/island-lang.github.io</a></p>
<h2 id="copyrights"><a class="header-anchor" href="#copyrights">ยง</a>Copyrights</h2>
<p>Copyright ยฉ Rotem Dan<br />
2017 - 2021</p>

</body>
</html>
